import{_ as j,r,s as w,b,d as g,e as s,B as N,g as S,h as c,i as C,A as k,t as U,u as z,q as A,F as x,k as I,G as D,D as F}from"./index-CIq-GS8G.js";import{I as B}from"./InputBase-DvbbbSUy.js";import{B as M}from"./BaseButton-XI85Ug5x.js";import{A as _}from"./AppIcons-D7cLThmm.js";import{N as R}from"./NotificationToast-CqpsuEjc.js";const E={class:"login-page"},L={class:"login-card"},O={class:"login-header"},$={class:"login-title"},G={class:"password-row"},P=["aria-label","title"],W={class:"actions-row"},Y={class:"login-footer"},H={__name:"Login",setup(J){const n=r(""),o=r(""),v=r(""),t=r(""),l=r(""),p=r(!1),u=r(!1),i=r({mensaje:"",tipo:""});let y=null;const h=r(null);function d(a){i.value.mensaje!==a&&(i.value={mensaje:a,tipo:"error"}),y&&clearTimeout(y),y=setTimeout(()=>i.value={mensaje:"",tipo:""},2500)}async function m(a=!0){await F();const e=h.value?.$el?.querySelector?.(".base-field");if(e&&(e.focus(),a))try{e.select()}catch{}}w(n,()=>{t.value&&(t.value="")}),w(o,()=>{l.value&&(l.value="")});const T=z(),V=A(),q=async()=>{try{if(v.value="",t.value="",l.value="",p.value=!0,!n.value||!o.value){n.value||(t.value="Ingresa tu usuario"),o.value||(l.value="Ingresa tu contraseña");const e=!n.value&&!o.value?"Debes ingresar usuario y contraseña":"Completa los campos requeridos";d(e),m();return}const a=await D.login(n.value,o.value);if(a&&a.token){const e=V.query.redirect||"/dashboard";T.push(e)}else{const e="Usuario y contraseña están equivocados";v.value=e,t.value="",l.value=e,d(e),o.value="",m()}}catch(a){if(console.error(a),a?.message?.includes("Failed to fetch")){const e="No se pudo conectar con el servidor. Inténtalo nuevamente.";v.value=e,t.value="",l.value=e,d(e),m(!1)}else if(String(a?.message||"").startsWith("401")){const e="Usuario y contraseña están equivocados";v.value=e,t.value="",l.value=e,d(e),o.value="",m()}else{const e="Ocurrió un error al iniciar sesión";v.value=e,t.value="",l.value=e,d(e),m(!1)}}finally{p.value=!1}};return(a,e)=>(g(),b("div",E,[s("div",L,[s("header",O,[s("div",$,[c(_,{name:"users",size:22}),e[4]||(e[4]=s("h1",null,"Ingreso al Sistema",-1))]),e[5]||(e[5]=s("p",{class:"login-subtitle"},"Autentícate con tu usuario y contraseña",-1))]),s("form",{class:"login-form",onSubmit:C(q,["prevent"])},[c(B,{ref_key:"usernameInputRef",ref:h,modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=f=>n.value=f),label:"Usuario",placeholder:"Tu usuario",required:"","external-error":t.value},null,8,["modelValue","external-error"]),s("div",G,[c(B,{modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=f=>o.value=f),type:u.value?"text":"password",label:"Contraseña",placeholder:"Tu contraseña",required:"","external-error":l.value},{append:k(()=>[s("button",{type:"button",class:"append-btn","aria-label":u.value?"Ocultar contraseña":"Mostrar contraseña",title:u.value?"Ocultar":"Mostrar",onClick:e[1]||(e[1]=f=>u.value=!u.value)},[c(_,{name:u.value?"eye-off":"eye",size:18},null,8,["name"])],8,P)]),_:1},8,["modelValue","type","external-error"])]),s("div",W,[c(M,{disabled:p.value,type:"submit",variant:"primary",size:"lg",block:""},{default:k(()=>[p.value?(g(),b(x,{key:1},[I(" Procesando... ")],64)):(g(),b(x,{key:0},[c(_,{name:"check",size:18}),e[6]||(e[6]=I(" Ingresar ",-1))],64))]),_:1},8,["disabled"])])],32),s("footer",Y,[s("small",null,"© "+U(new Date().getFullYear())+" Guias y Scouts Biobío",1)]),i.value.mensaje?(g(),N(R,{key:0,message:i.value.mensaje,onClose:e[3]||(e[3]=f=>i.value.mensaje="")},null,8,["message"])):S("",!0)])]))}},ae=j(H,[["__scopeId","data-v-be25f122"]]);export{ae as default};
