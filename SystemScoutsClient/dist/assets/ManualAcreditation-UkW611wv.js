import{a as k,D as M}from"./DataTable-CUKlULW1.js";import{B as A}from"./BaseButton-DbILRF5R.js";import{B as w}from"./BaseAlert-B4eZmxUy.js";import{N as _}from"./NotificationToast-DLWa24oL.js";import{A as B}from"./AppIcons-qhiaqEg8.js";import{a as b,_ as T,b as S,d as n,e as t,l as f,g as c,w as z,h as d,q as N,m as P,p as o,k as g,t as u,n as y}from"./index-DF_ZuZfT.js";const x=[{nombre:"Juan P√©rez",rut:"12345678-9",curso:"Curso B√°sico de Formaci√≥n",acreditado:!1,pagado:!0,per_id:1},{nombre:"Mar√≠a Gonz√°lez",rut:"98765432-1",curso:"T√©cnicas de Campamento",acreditado:!0,pagado:!0,per_id:2},{nombre:"Pedro Silva",rut:"11223344-5",curso:"Liderazgo Scout",acreditado:!1,pagado:!1,per_id:3},{nombre:"Ana Mart√≠nez",rut:"55667788-9",curso:"Curso B√°sico de Formaci√≥n",acreditado:!1,pagado:!0,per_id:4}];function E(a){if(!a||!a.found)return null;const e=a.persona||{},s=a.curso||null;return{name:e.nombre||"Sin nombre",rut:e.rut||"",currentCourse:s?.descripcion||s?.codigo||"‚Äî",paymentStatus:a.paymentStatus||"Confirmado",acreditationStatus:a.acreditado?"Acreditado":"Pendiente",paymentConfirmed:(a.paymentStatus||"Confirmado")==="Confirmado",per_id:e.per_id,raw:a}}const v={async buscar(a){try{const e=await b("personas/acreditacion/manual/search",{method:"POST",body:JSON.stringify({term:a})});return E(e)}catch(e){console.warn("B√∫squeda falla, usando mock:",e);const s=x.find(l=>l.rut.includes(a)||l.nombre.toLowerCase().includes(a.toLowerCase()));return s?{name:s.nombre,rut:s.rut,currentCourse:s.curso,paymentStatus:s.pagado?"Confirmado":"Pendiente",acreditationStatus:s.acreditado?"Acreditado":"Pendiente",paymentConfirmed:s.pagado,per_id:s.per_id,raw:s}:null}},async acreditar({rut:a,per_id:e}){try{const s=await b("personas/acreditacion/manual/acreditar",{method:"POST",body:JSON.stringify({rut:a,per_id:e})});return s&&s.ok===!0}catch(s){return console.warn("Acreditaci√≥n falla, simulando √©xito:",s),!0}}},R={name:"ManualAcreditation",components:{DataCard:M,DataTable:k,BaseButton:A,BaseAlert:w,NotificationToast:_,AppIcons:B},data(){return{searchTerm:"",selectedParticipant:null,acreditationSuccess:!1,isMobile:window.innerWidth<=768,paymentSuccess:!1,paymentSuccessMessage:"",acreditationSuccessMessage:""}},computed:{canAcredit(){return this.selectedParticipant&&this.selectedParticipant.paymentStatus==="Confirmado"&&this.selectedParticipant.acreditationStatus==="Pendiente"},statusMessage(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"‚úÖ Este usuario ya fue acreditado":this.selectedParticipant.paymentStatus!=="Confirmado"?"‚ùå Pendiente de pago - No se puede acreditar":"‚úÖ Listo para acreditar":""},statusMessageClass(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"status-message-success":this.selectedParticipant.paymentStatus!=="Confirmado"?"status-message-error":"status-message-info":""},paymentStatusClass(){return this.selectedParticipant?.paymentStatus==="Confirmado"?"status-confirmado":"status-pendiente"},acreditationStatusClass(){return this.selectedParticipant?.acreditationStatus==="Acreditado"?"status-acreditado":"status-pendiente"}},mounted(){window.addEventListener("resize",this.checkMobile)},beforeUnmount(){window.removeEventListener("resize",this.checkMobile)},methods:{checkMobile(){this.isMobile=window.innerWidth<=768},handleSearch(){const a=this.searchTerm.trim();if(!a){this.selectedParticipant=null;return}v.buscar(a).then(e=>{e?this.selectedParticipant=e:(this.selectedParticipant=null,this.acreditationSuccess=!1,this.paymentSuccess=!1)}).catch(e=>{console.error("Error buscando participante:",e),this.selectedParticipant=null})},acreditarParticipante(){if(!this.canAcredit||!this.selectedParticipant)return;const{rut:a,per_id:e}=this.selectedParticipant;v.acreditar({rut:a,per_id:e}).then(s=>{if(s){this.selectedParticipant.acreditationStatus="Acreditado";const l=`${this.selectedParticipant.name} acreditado correctamente`;this.acreditationSuccessMessage=l,this.acreditationSuccess=!0,setTimeout(()=>{this.acreditationSuccess=!1,this.acreditationSuccessMessage=""},3500)}else console.warn("No se pudo acreditar (respuesta no ok)")}).catch(s=>console.error("Error acreditando:",s))},handlePagar(){this.selectedParticipant.paymentStatus="Confirmado",this.selectedParticipant.paymentConfirmed=!0;const a=`‚úÖ ${this.selectedParticipant.name} marcado como pagado. Ahora puede ser acreditado.`;console.log(a),this.paymentSuccessMessage=a,this.paymentSuccess=!0,setTimeout(()=>{this.paymentSuccess=!1,this.paymentSuccessMessage=""},3500)},showQR(){alert(`üì± Mostrando QR de ${this.selectedParticipant.name}`)}}},D={class:"manual-acreditation"},I={class:"search-section"},L={class:"search-box"},O={key:2,class:"participant-info"},U={class:"info-grid"},V={class:"info-section"},q={class:"info-item"},Q={class:"info-item"},J={class:"info-item"},F={class:"info-section"},W={class:"info-item"},G={class:"info-item"},K={class:"action-buttons"},j={key:2,class:"already-acredited"};function H(a,e,s,l,i,r){const m=g("AppIcons"),h=g("BaseButton"),C=g("NotificationToast");return n(),S("div",D,[e[18]||(e[18]=t("div",{class:"acreditation-header"},[t("h1",null,"Acreditaci√≥n Manual")],-1)),t("div",I,[t("div",L,[z(t("input",{"onUpdate:modelValue":e[0]||(e[0]=p=>i.searchTerm=p),type:"text",placeholder:"Buscar por RUT o nombre completo...",class:"search-input",onInput:e[1]||(e[1]=(...p)=>r.handleSearch&&r.handleSearch(...p)),"aria-label":"Buscar por RUT o nombre completo"},null,544),[[N,i.searchTerm]]),d(h,{onClick:r.handleSearch,variant:"primary",size:"md"},{default:P(()=>[d(m,{name:"search",size:16,style:{"margin-right":"8px"}}),e[4]||(e[4]=o(" Buscar ",-1))]),_:1},8,["onClick"])])]),i.acreditationSuccess?(n(),f(C,{key:0,message:i.acreditationSuccessMessage,onClose:e[2]||(e[2]=p=>i.acreditationSuccess=!1)},null,8,["message"])):c("",!0),i.paymentSuccess?(n(),f(C,{key:1,message:i.paymentSuccessMessage,onClose:e[3]||(e[3]=p=>i.paymentSuccess=!1)},null,8,["message"])):c("",!0),i.selectedParticipant?(n(),S("div",O,[e[17]||(e[17]=t("div",{class:"status-header"},[t("h2",null,"Informaci√≥n del Participante")],-1)),t("div",U,[t("div",V,[e[8]||(e[8]=t("h3",null,"Datos Personales",-1)),t("div",q,[e[5]||(e[5]=t("strong",null,"Nombre:",-1)),o(" "+u(i.selectedParticipant.name),1)]),t("div",Q,[e[6]||(e[6]=t("strong",null,"RUT:",-1)),o(" "+u(i.selectedParticipant.rut),1)]),t("div",J,[e[7]||(e[7]=t("strong",null,"Curso:",-1)),o(" "+u(i.selectedParticipant.currentCourse),1)])]),t("div",F,[e[11]||(e[11]=t("h3",null,"Estado",-1)),t("div",W,[e[9]||(e[9]=t("strong",null,"Pago:",-1)),t("span",{class:y(r.paymentStatusClass)},u(i.selectedParticipant.paymentStatus),3)]),t("div",G,[e[10]||(e[10]=t("strong",null,"Acreditaci√≥n:",-1)),t("span",{class:y(r.acreditationStatusClass)},u(i.selectedParticipant.acreditationStatus),3)]),r.statusMessage?(n(),S("div",{key:0,class:y(["status-message",r.statusMessageClass])},u(r.statusMessage),3)):c("",!0)])]),t("div",K,[r.canAcredit?(n(),f(h,{key:0,onClick:r.acreditarParticipante,variant:"primary",size:"lg",class:"btn-acreditar"},{default:P(()=>[d(m,{name:"check",size:18}),e[12]||(e[12]=o(" Acreditar Participante ",-1))]),_:1},8,["onClick"])):i.selectedParticipant.paymentConfirmed?i.selectedParticipant.acreditationStatus==="Acreditado"?(n(),S("div",j,[d(m,{name:"check",size:18}),e[14]||(e[14]=o()),e[15]||(e[15]=t("span",null,"Usuario ya acreditado",-1))])):c("",!0):(n(),f(h,{key:1,onClick:r.handlePagar,variant:"secondary",size:"lg",class:"btn-pagar"},{default:P(()=>[d(m,{name:"credit-card",size:18}),e[13]||(e[13]=o(" Marcar como Pagado ",-1))]),_:1},8,["onClick"])),i.isMobile&&i.selectedParticipant.acreditationStatus==="Acreditado"?(n(),f(h,{key:3,onClick:r.showQR,variant:"secondary",size:"md",class:"btn-qr"},{default:P(()=>[d(m,{name:"qrcode",size:16}),e[16]||(e[16]=o(" Ver QR ",-1))]),_:1},8,["onClick"])):c("",!0)])])):c("",!0)])}const ae=T(R,[["render",H],["__scopeId","data-v-b5e8e125"]]);export{ae as default};
