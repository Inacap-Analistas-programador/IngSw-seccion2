import{a as V,_ as so,s as N,r as d,c as k,o as no,b as f,d as v,e,g as A,x as n,A as c,y as to,F as q,f as M,t as r,j as p,n as ro}from"./index-BKYQARX_.js";import{I as S}from"./InputBase-C5gIDdj6.js";import{B as m}from"./BaseButton-DWDg8t2r.js";import{B as g}from"./BaseSelect-CC_1HIWH.js";import{p as uo}from"./personasService-2XjK7U9-.js";const j="cursos/cursos";function z(u){return{id:u.CUR_ID||u.id,codigo:u.CUR_CODIGO||"",nombre:u.CUR_DESCRIPCION||"",estado:u.CUR_ESTADO,raw:u}}const io={async listar(){const u=await V(j);return Array.isArray(u)?u.map(z):[]},async obtener(u){const i=await V(`${j}/${u}`);return z(i)},async listarCuotas(){try{return await V("cursos/curso_cuota")}catch{try{return await V("cursos/cuotas")}catch{return[]}}}},co={class:"crud-cursos container"},po={class:"card cursos-card"},mo={class:"card-body"},Co={class:"title-row"},fo={class:"filtros"},vo={class:"filtros-left"},bo={class:"filtros-right"},go={class:"courses-table"},Io={class:"actions-cell"},Ro={key:0},Uo={key:0,class:"pagination"},Do={key:1,class:"create-card"},So={class:"form-grid"},_o={class:"form-group"},Vo={class:"form-group"},yo={class:"form-group"},Oo={class:"form-group"},Eo={class:"form-group"},Po={class:"form-group"},ho={class:"form-group"},No={class:"form-group"},ko={class:"form-group"},Ao={class:"hierarchy-section"},wo={class:"coordinador-form"},Fo={key:0,class:"coordinador-table"},To={key:1,class:"no-coordinadores"},Bo={class:"actions-row"},xo={__name:"CRUDcursos",setup(u){const i=N([]),U=d([]),a=N({nombre:"",codigo:"",fechaInicio:"",fechaFin:"",responsable:null,tipoCurso:null,comuna:null,modalidad:null,coordinadores:[]}),w=d([{value:1,label:"B√°sico"},{value:2,label:"Especialidad"}]),H=d([{value:1,label:"Comuna 1"},{value:2,label:"Comuna 2"}]),K=d([{value:1,label:"Presencial"},{value:2,label:"Mixta"}]),F=d([{value:1,label:"Coordinador"},{value:2,label:"Asistente"}]),C=N({persona:null,cargo:null});function J(){!C.persona||!C.cargo||(a.coordinadores.push({PER_ID:C.persona,CAR_ID:C.cargo}),C.persona=null,C.cargo=null)}function Q(s){a.coordinadores.splice(s,1)}function T(s){return U.value.find(l=>l.value===s)?.label||"-"}function W(s){return F.value.find(l=>l.value===s)?.label||"-"}const y=d(""),b=d(1),O=d(10),B=k(()=>{const s=y.value.toLowerCase().trim();return s?i.filter(o=>(o.CUR_DESCRIPCION||"").toLowerCase().includes(s)||(o.CUR_CODIGO||"").toLowerCase().includes(s)):i}),_=k(()=>Math.max(1,Math.ceil(B.value.length/O.value))),x=k(()=>{const s=(b.value-1)*O.value;return B.value.slice(s,s+O.value)});function L(s){s<1||s>_.value||(b.value=s)}function E(){b.value=1}const D=d(!1),I=d(!1),R=d(-1);async function X(){if(!a.nombre||!a.codigo||!a.responsable){alert("Por favor completa nombre, c√≥digo y responsable");return}const s={CURS_ID:I.value&&R.value>=0?i[R.value].CURS_ID:Date.now(),CUR_DESCRIPCION:a.nombre,CUR_CODIGO:a.codigo,CUR_TIPO_CURSO:a.tipoCurso,fechaInicio:a.fechaInicio,fechaTermino:a.fechaFin,responsableNombre:T(a.responsable),CUR_ESTADO:1,habilitado:!0,PER_ID_RESPONSABLE:a.responsable||null};I.value&&R.value>=0?Object.assign(i[R.value],s):i.push(s),E(),$()}function Y(s){const o=i[s];a.nombre=o.CUR_DESCRIPCION||"",a.codigo=o.CUR_CODIGO||"",o.CUR_FECHA_SOLICITUD?a.fechaInicio=new Date(o.CUR_FECHA_SOLICITUD).toISOString().split("T")[0]:a.fechaInicio="",a.fechaFin="",a.responsable=o.PER_ID_RESPONSABLE||null,a.coordinadores=[],I.value=!0,R.value=s,D.value=!0}function Z(s){i[s].habilitado=!i[s].habilitado}function oo(){$()}function $(){a.nombre="",a.codigo="",a.fechaInicio="",a.fechaFin="",a.responsable=null,a.tipoCurso=null,a.comuna=null,a.modalidad=null,a.coordinadores=[],D.value=!1,I.value=!1,R.value=-1}function eo(s,o){return!s&&!o?"-":s&&o?`${P(s)} - ${P(o)}`:P(s||o)}function P(s){return s?new Date(s).toLocaleDateString("es-CL",{day:"2-digit",month:"short",year:"numeric"}):""}no(async()=>{try{const o=(await io.listar()||[]).map(t=>({CURS_ID:t.id,CUR_DESCRIPCION:t.nombre||t.codigo||"Curso",CUR_CODIGO:t.codigo||"-",CUR_TIPO_CURSO:null,fechaInicio:null,fechaTermino:null,responsableNombre:"-",CUR_ESTADO:t.estado??1,habilitado:t.estado===1}));i.splice(0,i.length,...o);const l=await uo.listarBasic();U.value=(l||[]).map(t=>({value:t.id,label:t.nombre}))}catch(s){console.warn("No se pudieron cargar cursos/personas desde API",s)}});function lo(s){return w.value.find(l=>l.value===(Number(s)||s))?.label||"‚Äî"}function G(s){const o=Number(s);return o===1?{class:"badge-success",text:"Vigente"}:o===0?{class:"badge-secondary",text:"Inactivo"}:{class:"badge-info",text:"Desconocido"}}function ao(s){console.log("Gestionar participantes para curso",s)}return(s,o)=>(v(),f("div",co,[o[38]||(o[38]=e("header",{class:"page-header"},[e("h3",null,"Gesti√≥n de Cursos")],-1)),e("section",po,[e("div",mo,[e("div",Co,[o[16]||(o[16]=e("h4",null,"Gesti√≥n de Cursos",-1)),n(m,{class:"btn-success",onClick:o[0]||(o[0]=l=>D.value=!D.value)},{default:c(()=>[...o[15]||(o[15]=[p("+ Nuevo Curso",-1)])]),_:1})]),e("div",fo,[e("div",vo,[n(S,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=l=>y.value=l),placeholder:"Buscar por nombre o c√≥digo...",onKeydown:to(E,["enter"])},null,8,["modelValue"])]),e("div",bo,[n(m,{class:"btn-search",variant:"primary",onClick:E},{default:c(()=>[...o[17]||(o[17]=[p("üîé Buscar",-1)])]),_:1})])]),e("table",go,[o[21]||(o[21]=e("thead",null,[e("tr",null,[e("th",null,"Nombre del Curso"),e("th",null,"C√≥digo"),e("th",null,"Tipo"),e("th",null,"Fechas del Curso"),e("th",null,"Responsable"),e("th",null,"Estado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(v(!0),f(q,null,M(x.value,(l,t)=>(v(),f("tr",{key:l.CURS_ID},[e("td",null,r(l.CUR_DESCRIPCION),1),e("td",null,r(l.CUR_CODIGO),1),e("td",null,r(lo(l.CUR_TIPO_CURSO)),1),e("td",null,r(eo(l.fechaInicio,l.fechaTermino)),1),e("td",null,r(l.responsableNombre),1),e("td",null,[e("span",{class:ro(["badge",G(l.CUR_ESTADO).class])},r(G(l.CUR_ESTADO).text),3)]),e("td",Io,[n(m,{class:"btn-info",small:"",onClick:h=>ao(l.CURS_ID)},{default:c(()=>[...o[18]||(o[18]=[p("Participantes",-1)])]),_:1},8,["onClick"]),n(m,{class:"btn-warning",small:"",onClick:h=>Y(t)},{default:c(()=>[...o[19]||(o[19]=[p("Editar",-1)])]),_:1},8,["onClick"]),n(m,{class:"btn-secondary",small:"",onClick:h=>Z(t)},{default:c(()=>[p(r(l.habilitado?"Deshabilitar":"Habilitar"),1)]),_:2},1032,["onClick"])])]))),128)),x.value.length===0?(v(),f("tr",Ro,[...o[20]||(o[20]=[e("td",{colspan:"7",class:"no-results"},"No se encontraron cursos.",-1)])])):A("",!0)])]),_.value>1?(v(),f("div",Uo,[n(m,{onClick:o[2]||(o[2]=l=>L(b.value-1)),disabled:b.value===1},{default:c(()=>[...o[22]||(o[22]=[p("Anterior",-1)])]),_:1},8,["disabled"]),e("span",null,"P√°gina "+r(b.value)+" de "+r(_.value),1),n(m,{onClick:o[3]||(o[3]=l=>L(b.value+1)),disabled:b.value===_.value},{default:c(()=>[...o[23]||(o[23]=[p("Siguiente",-1)])]),_:1},8,["disabled"])])):A("",!0),D.value?(v(),f("div",Do,[e("h5",null,r(I.value?"Editar Curso":"Crear Nuevo Curso"),1),e("div",So,[e("div",_o,[o[24]||(o[24]=e("label",null,"Nombre del Curso:",-1)),n(S,{type:"text",placeholder:"Ej: Formaci√≥n de Dirigentes",modelValue:a.nombre,"onUpdate:modelValue":o[4]||(o[4]=l=>a.nombre=l)},null,8,["modelValue"])]),e("div",Vo,[o[25]||(o[25]=e("label",null,"C√≥digo:",-1)),n(S,{type:"text",placeholder:"Ej: FD-001",modelValue:a.codigo,"onUpdate:modelValue":o[5]||(o[5]=l=>a.codigo=l)},null,8,["modelValue"])]),e("div",yo,[o[26]||(o[26]=e("label",null,"Fecha Inicio:",-1)),n(S,{type:"date",modelValue:a.fechaInicio,"onUpdate:modelValue":o[6]||(o[6]=l=>a.fechaInicio=l)},null,8,["modelValue"])]),e("div",Oo,[o[27]||(o[27]=e("label",null,"Fecha Fin:",-1)),n(S,{type:"date",modelValue:a.fechaFin,"onUpdate:modelValue":o[7]||(o[7]=l=>a.fechaFin=l)},null,8,["modelValue"])]),e("div",Eo,[o[28]||(o[28]=e("label",null,"Responsable:",-1)),n(g,{modelValue:a.responsable,"onUpdate:modelValue":o[8]||(o[8]=l=>a.responsable=l),options:U.value,placeholder:"Seleccione un responsable"},null,8,["modelValue","options"])]),e("div",Po,[o[29]||(o[29]=e("label",null,"Tipo de Curso:",-1)),n(g,{modelValue:a.tipoCurso,"onUpdate:modelValue":o[9]||(o[9]=l=>a.tipoCurso=l),options:w.value,placeholder:"Seleccione un tipo"},null,8,["modelValue","options"])]),e("div",ho,[o[30]||(o[30]=e("label",null,"Comuna (Lugar):",-1)),n(g,{modelValue:a.comuna,"onUpdate:modelValue":o[10]||(o[10]=l=>a.comuna=l),options:H.value,placeholder:"Seleccione una comuna"},null,8,["modelValue","options"])]),e("div",No,[o[31]||(o[31]=e("label",null,"Modalidad:",-1)),n(g,{modelValue:a.modalidad,"onUpdate:modelValue":o[11]||(o[11]=l=>a.modalidad=l),options:K.value,placeholder:"Seleccione modalidad"},null,8,["modelValue","options"])])]),e("div",ko,[o[32]||(o[32]=e("label",null,"Responsable:",-1)),n(g,{modelValue:a.responsable,"onUpdate:modelValue":o[12]||(o[12]=l=>a.responsable=l),options:U.value,placeholder:"Selecciona un responsable"},null,8,["modelValue","options"])]),e("div",Ao,[o[36]||(o[36]=e("label",null,"Equipo del Curso (Jerarqu√≠as):",-1)),e("div",wo,[n(g,{modelValue:C.persona,"onUpdate:modelValue":o[13]||(o[13]=l=>C.persona=l),options:U.value,placeholder:"Seleccionar Persona",class:"select-persona"},null,8,["modelValue","options"]),n(g,{modelValue:C.cargo,"onUpdate:modelValue":o[14]||(o[14]=l=>C.cargo=l),options:F.value,placeholder:"Seleccionar Cargo",class:"select-cargo"},null,8,["modelValue","options"]),n(m,{onClick:J,class:"btn-success"},{default:c(()=>[...o[33]||(o[33]=[p("A√±adir al Equipo",-1)])]),_:1})]),a.coordinadores.length>0?(v(),f("table",Fo,[o[35]||(o[35]=e("thead",null,[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Cargo"),e("th",null,"Acci√≥n")])],-1)),e("tbody",null,[(v(!0),f(q,null,M(a.coordinadores,(l,t)=>(v(),f("tr",{key:t},[e("td",null,r(T(l.PER_ID)),1),e("td",null,r(W(l.CAR_ID)),1),e("td",null,[n(m,{onClick:h=>Q(t),class:"btn-danger",small:""},{default:c(()=>[...o[34]||(o[34]=[p("Eliminar",-1)])]),_:1},8,["onClick"])])]))),128))])])):(v(),f("p",To,"A√∫n no se han a√±adido miembros al equipo."))]),e("div",Bo,[n(m,{class:"btn-primary",onClick:X},{default:c(()=>[p(r(I.value?"Actualizar":"Crear Curso"),1)]),_:1}),n(m,{class:"btn-secondary",onClick:oo},{default:c(()=>[...o[37]||(o[37]=[p("Cancelar",-1)])]),_:1})])])):A("",!0)])])]))}},jo=so(xo,[["__scopeId","data-v-f8a13f26"]]);export{jo as default};
