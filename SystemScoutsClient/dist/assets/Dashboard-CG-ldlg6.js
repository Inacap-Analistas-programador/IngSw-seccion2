import{_ as W,r as p,c as f,o as X,a as z,b as n,d as r,e as s,F as P,f as S,g as R,w as Y,v as ss,n as l,h as g,t as a,i as ts,u as es,j as B}from"./index-BPA1--Y9.js";import{p as os}from"./personasService-IigZgjN-.js";import{A as y}from"./AppIcons-CRrJo_Hq.js";const as={class:"layout-root"},is={class:"toast-container"},ns={class:"alert-toast-icon"},rs={class:"alert-toast-content"},ls={class:"alert-toast-title"},ds={class:"alert-toast-message"},cs=["onClick"],us={class:"layout-content"},vs={class:"main"},ps={class:"control-panel"},ms={class:"tab-content"},hs={class:"semaforo-grid"},_s={class:"semaforo-data"},fs={class:"semaforo-value"},Cs={class:"semaforo-data"},gs={class:"semaforo-value"},ys={class:"semaforo-data"},bs={class:"semaforo-value"},ws={class:"modal-header"},ks={class:"modal-body"},xs={class:"cursos-list"},As=["onClick"],Ps={class:"curso-item-info"},Ss={class:"curso-item-title"},Ms={class:"curso-item-details"},Ns={class:"data-section"},Is={class:"directivos-grid"},Rs={class:"directivo-header"},Ds={class:"directivo-title-group"},Es={class:"directivo-stats"},Os={class:"directivo-stat"},Us={class:"directivo-stat-value"},zs={class:"directivo-stat"},Bs={class:"directivo-stat-value"},Ts={class:"directivo-bar"},$s={key:0,class:"directivo-message"},Ls={key:1,class:"directivo-message warning"},Fs={key:2,class:"directivo-message success"},Vs={class:"data-section"},js={class:"table-container"},Hs={class:"data-table"},Gs={style:{width:"25%"}},qs={class:"curso-name-wrapper"},Ks={class:"curso-name"},Zs={class:"text-center",style:{width:"auto"}},Js={class:"inscritos-badge"},Qs={class:"text-right",style:{width:"auto"}},Ws={class:"amount paid"},Xs={class:"text-right",style:{width:"auto"}},Ys={class:"amount expected"},st={class:"text-right",style:{width:"auto"}},tt={class:"amount pending"},et={class:"text-center",style:{width:"auto"}},ot={class:"progress-cell"},at={class:"mini-progress-bar"},it={class:"progress-percent"},nt={class:"text-center",style:{width:"10%"}},rt={key:0,class:"empty-row"},lt=68,dt={__name:"Dashboard",setup(ct){const D=es(),T=p("resumen"),b=p(!1),w=p([]),M=p(0),$=[{id:1,title:"Curso Básico de Formación",inscritos:28,capacidad:30,valor:25e3,estado:"Vigente"},{id:2,title:"Técnicas de Campamento",inscritos:15,capacidad:25,valor:3e4,estado:"Vigente"},{id:3,title:"Liderazgo Scout",inscritos:12,capacidad:20,valor:35e3,estado:"Vigente"},{id:4,title:"Primeros Auxilios Avanzado",inscritos:8,capacidad:15,valor:28e3,estado:"Vigente"},{id:5,title:"Orientación y Navegación",inscritos:5,capacidad:20,valor:22e3,estado:"Vigente"}],m=f(()=>[...w.value].sort((o,t)=>(o.title||"").localeCompare(t.title||"","es",{sensitivity:"base"})));function L(o,t){return o==="full"?`El curso "${t}" ha alcanzado su capacidad máxima.`:o==="near"?`El curso "${t}" está cerca de completar su capacidad.`:o==="bajo"?`El curso "${t}" tiene baja inscripción.`:""}function C(o){if(o==="inscritos"){const t=v.value.totalInscritos/(m.value.reduce((e,i)=>e+i.capacidad,0)||1);return t>=.85?"ok":t>=.5?"near":"full"}if(o==="pagos"){const t=v.value.ingresosPagados/(v.value.ingresosProyectados||1);return t>=.8?"ok":t>=.5?"near":"full"}return o==="cursos"?v.value.totalCursos>=3?"ok":"near":o==="alertas"?x.value.length===0?"ok":x.value.length<=2?"near":"full":"ok"}const F=p({}),V=p({}),E=p({1:4,2:7,3:0,4:1}),O=f(()=>m.value.map(o=>{const t=Number(o.valor||0),e=Math.max(0,Math.round((Number(o.inscritos)||0)*t)),i=F.value[o.id]||0,d=(V.value[o.id]||0)*t,c=i||d||0,u=Math.max(0,e-c),Q=e>0?Math.max(0,Math.min(100,Math.round(c/e*100))):0;return{id:o.id,title:o.title,inscritos:o.inscritos,expected:e,paid:c,unpaid:u,percentPaid:Q}})),U=f(()=>O.value.filter(o=>o.unpaid>0).sort((o,t)=>t.unpaid-o.unpaid));function N(o){try{return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(Number(o||0))}catch{return`$${Number(o||0).toLocaleString("es-CL")}`}}const v=f(()=>{const o=m.value.length,t=Number(M.value||0),e=m.value.reduce((c,u)=>c+(Number(u.inscritos)||0)*(Number(u.valor)||0),0),i=O.value.reduce((c,u)=>c+(Number(u.paid)||0),0),d=Math.max(0,e-i);return{totalCursos:o,totalInscritos:t,ingresosProyectados:e,ingresosPagados:i,ingresosPendientes:d}});f(()=>v.value.ingresosProyectados===0?0:Math.round(v.value.ingresosPagados/v.value.ingresosProyectados*100));const x=f(()=>{const o=[];return m.value.forEach(t=>{const e=Number(t.capacidad)||0,i=Number(t.inscritos)||0;if(!e)return;const d=i/e;d>=1?o.push({id:`${t.id}-full`,title:t.title,type:"full",label:"Completo"}):d>=.85?o.push({id:`${t.id}-near`,title:t.title,type:"near",label:"Casi lleno"}):d<=.25&&o.push({id:`${t.id}-bajo`,title:t.title,type:"bajo",label:"Baja inscripción"})}),o.slice(0,6)}),I=p([]),j=f(()=>x.value.filter(o=>!I.value.includes(o.id)));function H(o){I.value.push(o)}function G(){D.push("/gestionpersonas")}function q(o){D.push({path:"/cursos-capacitaciones",query:{edit:o}})}function K(){I.value=[]}function h(o){return E.value[o.id]!==void 0?E.value[o.id]:0}function _(o){return Math.max(2,Math.ceil(o.inscritos/10))}function Z(o){const t=h(o),e=_(o);return Math.min(100,t/e*100)}function k(o){const t=h(o),e=_(o);return t>=e?"ok":t>=e*.5?"near":"danger"}function A(o){const t=o.expected>0?o.paid/o.expected*100:0;return t>=80?"ok":t>=50?"near":"full"}function J(o){const t=A(o);return t==="ok"?"Al día":t==="near"?"Pendiente":"Crítico"}return X(()=>{(async()=>{try{const o=await z("cursos/cursos");Array.isArray(o)&&(w.value=o.map(t=>({id:t.CURS_ID||t.CUR_ID||t.id||t.ID,title:t.CUR_DESCRIPCION||t.CUR_CODIGO||t.CURS_ID||"Curso",inscritos:parseInt(t._inscritos_count||t.INSCRITOS||0)||0,capacidad:parseInt(t.CUR_COTA_CON_ALMUERZO||t.CUR_COTA_SIN_ALMUERZO||t.CUR_CANT_PARTICIPANTE||t.CAPACIDAD||0)||0,valor:0,estado:t.CUR_ESTADO||t.ESTADO||"Vigente"})))}catch(o){console.warn("Cursos no disponibles, usando datos mock:",o),w.value=$}try{const o=await z("cursos/cuotas");if(Array.isArray(o)){const t={};o.forEach(e=>{const i=e.CUR_ID||e.curso_id||e.cur_id||null;if(!i)return;const d=Number(e.CUU_VALOR||e.valor||0),c=e.CUU_FECHA||"",u=t[i];(!u||d>u.val||c&&u.date&&c>u.date)&&(t[i]={val:d,date:c})}),w.value=w.value.map(e=>({...e,valor:t[e.id]?.val||e.valor||0}))}}catch(o){console.warn("Cuotas no disponibles:",o)}try{const o=await os.listarBasic();M.value=Array.isArray(o)?o.length:0}catch(o){console.warn("Personas no disponibles, usando datos mock:",o),M.value=lt}})()}),(o,t)=>(r(),n("div",as,[s("div",is,[(r(!0),n(P,null,S(j.value,(e,i)=>(r(),n("div",{key:e.id,class:"alert-toast"},[s("div",ns,[g(y,{name:"alert-circle",size:20})]),s("div",rs,[s("div",ls,a(e.title),1),s("div",ds,a(L(e.type,e.title)),1)]),s("button",{class:"alert-toast-close",onClick:d=>H(e.id)},[g(y,{name:"x",size:16})],8,cs)]))),128))]),s("div",us,[s("main",vs,[s("div",ps,[t[19]||(t[19]=s("header",{class:"control-header"},[s("h1",null,"Centro de Control"),s("p",{class:"control-subtitle"},"Sistema de Gestión de Cursos Scout")],-1)),R("",!0),Y(s("div",ms,[s("div",hs,[s("div",{class:l(["semaforo-card",C("inscritos")]),onClick:G},[g(y,{name:"users",size:32,class:"semaforo-icon"}),s("div",_s,[s("div",fs,a(v.value.totalInscritos),1),t[4]||(t[4]=s("div",{class:"semaforo-label"},"Pre inscritos totales",-1))]),s("div",{class:l(["semaforo-indicator",C("inscritos")])},null,2)],2),s("div",{class:l(["semaforo-card",C("cursos")]),onClick:t[0]||(t[0]=e=>b.value=!b.value)},[g(y,{name:"book",size:32,class:"semaforo-icon"}),s("div",Cs,[s("div",gs,a(v.value.totalCursos),1),t[5]||(t[5]=s("div",{class:"semaforo-label"},"Cursos activos",-1))]),s("div",{class:l(["semaforo-indicator",C("cursos")])},null,2)],2),s("div",{class:l(["semaforo-card",C("alertas")]),onClick:K},[g(y,{name:"alert-circle",size:32,class:"semaforo-icon"}),s("div",ys,[s("div",bs,a(x.value.length),1),t[6]||(t[6]=s("div",{class:"semaforo-label"},"Alertas activas",-1))]),s("div",{class:l(["semaforo-indicator",C("alertas")])},null,2)],2)]),b.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=e=>b.value=!1)},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=ts(()=>{},["stop"]))},[s("div",ws,[t[7]||(t[7]=s("h3",null,"Cursos Activos",-1)),s("button",{class:"modal-close",onClick:t[1]||(t[1]=e=>b.value=!1)},[g(y,{name:"x",size:20})])]),s("div",ks,[s("div",xs,[(r(!0),n(P,null,S(m.value,e=>(r(),n("div",{key:e.id,class:"curso-item",onClick:i=>q(e.id)},[t[8]||(t[8]=s("div",{class:"curso-item-icon"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})])],-1)),s("div",Ps,[s("div",Ss,a(e.title),1),s("div",Ms,a(e.inscritos)+"/"+a(e.capacidad)+" pre inscritos",1)]),t[9]||(t[9]=s("div",{class:"curso-item-arrow"},"→",-1))],8,As))),128))])])])])):R("",!0),s("div",Ns,[t[14]||(t[14]=s("div",{class:"section-header"},[s("div",null,[s("h2",{class:"section-title"},"Formadores por Curso"),s("p",{class:"section-description"},"Se requiere 1 formador por cada 10 pre inscritos (mínimo 2 formadores)")])],-1)),s("div",Is,[(r(!0),n(P,null,S(m.value,e=>(r(),n("div",{key:e.id,class:l(["directivo-card",k(e)])},[s("div",Rs,[s("div",Ds,[t[10]||(t[10]=s("svg",{class:"directivo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),s("circle",{cx:"9",cy:"7",r:"4"}),s("path",{d:"M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"})],-1)),s("h3",null,a(e.title),1)]),s("span",{class:l(["directivo-badge",k(e)])},a(h(e))+"/"+a(_(e)),3)]),s("div",Es,[s("span",Os,[s("span",Us,a(h(e)),1),t[11]||(t[11]=s("span",{class:"directivo-stat-label"},"Actuales",-1))]),t[13]||(t[13]=s("span",{class:"directivo-stat-divider"},"→",-1)),s("span",zs,[s("span",Bs,a(_(e)),1),t[12]||(t[12]=s("span",{class:"directivo-stat-label"},"Requeridos",-1))])]),s("div",Ts,[s("div",{class:l(["directivo-fill",k(e)]),style:B({width:Z(e)+"%"})},null,6)]),k(e)==="danger"?(r(),n("div",$s," ⚠️ Faltan "+a(_(e)-h(e))+" formadores ",1)):k(e)==="near"?(r(),n("div",Ls," Necesita "+a(_(e)-h(e))+" formador"+a(_(e)-h(e)>1?"es":"")+" más ",1)):(r(),n("div",Fs," ✓ Personal completo "))],2))),128))])]),s("div",Vs,[t[18]||(t[18]=s("div",{class:"section-header"},[s("div",null,[s("h2",{class:"section-title"},"Cursos con Pagos Pendientes"),s("p",{class:"section-description"},"Resumen de recaudación y montos pendientes por curso")])],-1)),s("div",js,[s("table",Hs,[t[17]||(t[17]=s("thead",null,[s("tr",null,[s("th",{style:{width:"auto"}},"Curso"),s("th",{class:"text-center",style:{width:"auto"}},"PreInscritos"),s("th",{class:"text-center",style:{width:"auto"}},"Recaudado"),s("th",{class:"text-center",style:{width:"auto"}},"Esperado"),s("th",{class:"text-center",style:{width:"auto"}},"Pendiente"),s("th",{class:"text-center",style:{width:"auto"}},"Progreso"),s("th",{class:"text-center",style:{width:"auto"}},"Estado")])],-1)),s("tbody",null,[(r(!0),n(P,null,S(U.value,e=>(r(),n("tr",{key:e.title,class:l("row-"+A(e))},[s("td",Gs,[s("div",qs,[t[15]||(t[15]=s("svg",{class:"curso-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})],-1)),s("span",Ks,a(e.title),1)])]),s("td",Zs,[s("span",Js,a(e.inscritos),1)]),s("td",Qs,[s("span",Ws,a(N(e.paid)),1)]),s("td",Xs,[s("span",Ys,a(N(e.expected)),1)]),s("td",st,[s("span",tt,a(N(e.unpaid)),1)]),s("td",et,[s("div",ot,[s("div",at,[s("div",{class:l(["mini-progress-fill",A(e)]),style:B({width:e.percentPaid+"%"})},null,6)]),s("span",it,a(e.percentPaid)+"%",1)])]),s("td",nt,[s("span",{class:l(["status-badge",A(e)])},a(J(e)),3)])],2))),128)),U.value.length===0?(r(),n("tr",rt,[...t[16]||(t[16]=[s("td",{colspan:"7",class:"text-center"},[s("div",{class:"empty-state"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",null,"¡Excelente! No hay pagos pendientes")])],-1)])])):R("",!0)])])])])],512),[[ss,T.value==="resumen"]])])])])]))}},mt=W(dt,[["__scopeId","data-v-125a2230"]]);export{mt as default};
