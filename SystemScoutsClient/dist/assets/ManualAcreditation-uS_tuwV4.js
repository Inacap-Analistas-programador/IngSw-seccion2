import{_ as v,b as d,d as r,g as c,e,C as _,t as o,a as P,B as m,w as b,x as k,k as M,A as f,z as y,j as l,n as S}from"./index-BKYQARX_.js";import{N as w,D as A}from"./NotificationToast-CggCdyQ8.js";import{B}from"./BaseButton-DWDg8t2r.js";import{B as T}from"./BaseAlert-B5bQXRsS.js";const N={name:"DataCard",props:{title:{type:String,required:!0},value:{type:[String,Number],required:!0},description:{type:String,default:""}}},x=["aria-label"],z={key:0,class:"icon","aria-hidden":"true"},D={class:"content"},E={class:"value"},R={class:"title"},U={key:0,class:"description"};function V(s,t,i,h,a,n){return r(),d("div",{class:"datacard",role:"region","aria-label":`Indicador: ${i.title}`,tabindex:"0"},[s.$slots.icon?(r(),d("div",z,[_(s.$slots,"icon",{},void 0,!0)])):c("",!0),e("div",D,[e("span",E,o(i.value),1),e("span",R,o(i.title),1),i.description?(r(),d("p",U,o(i.description),1)):c("",!0)])],8,x)}const I=v(N,[["render",V],["__scopeId","data-v-3043ebdf"]]);function q(s){if(!s||!s.found)return null;const t=s.persona||{},i=s.curso||null;return{name:t.nombre||"Sin nombre",rut:t.rut||"",currentCourse:i?.descripcion||i?.codigo||"—",paymentStatus:s.paymentStatus||"Confirmado",acreditationStatus:s.acreditado?"Acreditado":"Pendiente",paymentConfirmed:(s.paymentStatus||"Confirmado")==="Confirmado",per_id:t.per_id,raw:s}}const C={async buscar(s){const t=await P("personas/acreditacion/manual/search",{method:"POST",body:JSON.stringify({term:s})});return q(t)},async acreditar({rut:s,per_id:t}){const i=await P("personas/acreditacion/manual/acreditar",{method:"POST",body:JSON.stringify({rut:s,per_id:t})});return i&&i.ok===!0}},L={name:"ManualAcreditation",components:{DataCard:I,DataTable:A,BaseButton:B,BaseAlert:T,NotificationToast:w},data(){return{searchTerm:"",selectedParticipant:null,acreditationSuccess:!1,isMobile:window.innerWidth<=768,paymentSuccess:!1,paymentSuccessMessage:"",acreditationSuccessMessage:""}},computed:{canAcredit(){return this.selectedParticipant&&this.selectedParticipant.paymentStatus==="Confirmado"&&this.selectedParticipant.acreditationStatus==="Pendiente"},statusMessage(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"✅ Este usuario ya fue acreditado":this.selectedParticipant.paymentStatus!=="Confirmado"?"❌ Pendiente de pago - No se puede acreditar":"✅ Listo para acreditar":""},statusMessageClass(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"status-message-success":this.selectedParticipant.paymentStatus!=="Confirmado"?"status-message-error":"status-message-info":""},paymentStatusClass(){return this.selectedParticipant?.paymentStatus==="Confirmado"?"status-confirmado":"status-pendiente"},acreditationStatusClass(){return this.selectedParticipant?.acreditationStatus==="Acreditado"?"status-acreditado":"status-pendiente"}},mounted(){window.addEventListener("resize",this.checkMobile)},beforeUnmount(){window.removeEventListener("resize",this.checkMobile)},methods:{checkMobile(){this.isMobile=window.innerWidth<=768},handleSearch(){const s=this.searchTerm.trim();if(!s){this.selectedParticipant=null;return}C.buscar(s).then(t=>{t?this.selectedParticipant=t:(this.selectedParticipant=null,this.acreditationSuccess=!1,this.paymentSuccess=!1)}).catch(t=>{console.error("Error buscando participante:",t),this.selectedParticipant=null})},acreditarParticipante(){if(!this.canAcredit||!this.selectedParticipant)return;const{rut:s,per_id:t}=this.selectedParticipant;C.acreditar({rut:s,per_id:t}).then(i=>{if(i){this.selectedParticipant.acreditationStatus="Acreditado";const h=`${this.selectedParticipant.name} acreditado correctamente`;this.acreditationSuccessMessage=h,this.acreditationSuccess=!0,setTimeout(()=>{this.acreditationSuccess=!1,this.acreditationSuccessMessage=""},3500)}else console.warn("No se pudo acreditar (respuesta no ok)")}).catch(i=>console.error("Error acreditando:",i))},handlePagar(){this.selectedParticipant.paymentStatus="Confirmado",this.selectedParticipant.paymentConfirmed=!0;const s=`✅ ${this.selectedParticipant.name} marcado como pagado. Ahora puede ser acreditado.`;console.log(s),this.paymentSuccessMessage=s,this.paymentSuccess=!0,setTimeout(()=>{this.paymentSuccess=!1,this.paymentSuccessMessage=""},3500)},showQR(){alert(`📱 Mostrando QR de ${this.selectedParticipant.name}`)}}},O={class:"manual-acreditation"},Q={class:"search-section"},J={class:"search-box"},W={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",style:{"margin-right":"8px"},"aria-hidden":"true"},j={key:2,class:"participant-info"},Z={class:"info-grid"},F={class:"info-section"},G={class:"info-item"},H={class:"info-item"},K={class:"info-item"},X={class:"info-section"},Y={class:"info-item"},$={class:"info-item"},tt={class:"action-buttons"},et={key:2,class:"already-acredited"};function st(s,t,i,h,a,n){const p=y("BaseButton"),g=y("NotificationToast");return r(),d("div",O,[t[18]||(t[18]=e("div",{class:"acreditation-header"},[e("h1",null,"Acreditación Manual")],-1)),e("div",Q,[e("div",J,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>a.searchTerm=u),type:"text",placeholder:"Buscar por RUT o nombre completo...",class:"search-input",onInput:t[1]||(t[1]=(...u)=>n.handleSearch&&n.handleSearch(...u)),"aria-label":"Buscar por RUT o nombre completo"},null,544),[[M,a.searchTerm]]),k(p,{onClick:n.handleSearch,variant:"primary",size:"md"},{default:f(()=>[(r(),d("svg",W,[...t[4]||(t[4]=[e("path",{d:"M14 14L11.1 11.1M12.6667 7.33333C12.6667 10.2789 10.2789 12.6667 7.33333 12.6667C4.38781 12.6667 2 10.2789 2 7.33333C2 4.38781 4.38781 2 7.33333 2C10.2789 2 12.6667 4.38781 12.6667 7.33333Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"},null,-1)])])),t[5]||(t[5]=l(" Buscar ",-1))]),_:1},8,["onClick"])])]),a.acreditationSuccess?(r(),m(g,{key:0,message:a.acreditationSuccessMessage,onClose:t[2]||(t[2]=u=>a.acreditationSuccess=!1)},null,8,["message"])):c("",!0),a.paymentSuccess?(r(),m(g,{key:1,message:a.paymentSuccessMessage,onClose:t[3]||(t[3]=u=>a.paymentSuccess=!1)},null,8,["message"])):c("",!0),a.selectedParticipant?(r(),d("div",j,[t[17]||(t[17]=e("div",{class:"status-header"},[e("h2",null,"Información del Participante")],-1)),e("div",Z,[e("div",F,[t[9]||(t[9]=e("h3",null,"Datos Personales",-1)),e("div",G,[t[6]||(t[6]=e("strong",null,"Nombre:",-1)),l(" "+o(a.selectedParticipant.name),1)]),e("div",H,[t[7]||(t[7]=e("strong",null,"RUT:",-1)),l(" "+o(a.selectedParticipant.rut),1)]),e("div",K,[t[8]||(t[8]=e("strong",null,"Curso:",-1)),l(" "+o(a.selectedParticipant.currentCourse),1)])]),e("div",X,[t[12]||(t[12]=e("h3",null,"Estado",-1)),e("div",Y,[t[10]||(t[10]=e("strong",null,"Pago:",-1)),e("span",{class:S(n.paymentStatusClass)},o(a.selectedParticipant.paymentStatus),3)]),e("div",$,[t[11]||(t[11]=e("strong",null,"Acreditación:",-1)),e("span",{class:S(n.acreditationStatusClass)},o(a.selectedParticipant.acreditationStatus),3)]),n.statusMessage?(r(),d("div",{key:0,class:S(["status-message",n.statusMessageClass])},o(n.statusMessage),3)):c("",!0)])]),e("div",tt,[n.canAcredit?(r(),m(p,{key:0,onClick:n.acreditarParticipante,variant:"primary",size:"lg",class:"btn-acreditar"},{default:f(()=>[...t[13]||(t[13]=[l(" ✅ Acreditar Participante ",-1)])]),_:1},8,["onClick"])):a.selectedParticipant.paymentConfirmed?a.selectedParticipant.acreditationStatus==="Acreditado"?(r(),d("div",et,[...t[15]||(t[15]=[e("span",null,"✅ Usuario ya acreditado",-1)])])):c("",!0):(r(),m(p,{key:1,onClick:n.handlePagar,variant:"secondary",size:"lg",class:"btn-pagar"},{default:f(()=>[...t[14]||(t[14]=[l(" 💳 Marcar como Pagado ",-1)])]),_:1},8,["onClick"])),a.isMobile&&a.selectedParticipant.acreditationStatus==="Acreditado"?(r(),m(p,{key:3,onClick:n.showQR,variant:"secondary",size:"md",class:"btn-qr"},{default:f(()=>[...t[16]||(t[16]=[l(" 📱 Ver QR ",-1)])]),_:1},8,["onClick"])):c("",!0)])])):c("",!0)])}const ot=v(L,[["render",st],["__scopeId","data-v-4f1d624b"]]);export{ot as default};
