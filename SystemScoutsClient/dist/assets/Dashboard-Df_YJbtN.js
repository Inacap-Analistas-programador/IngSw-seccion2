import{_ as J,r as g,c as C,o as K,a as d,b as c,d as t,F as M,e as N,f as D,w as Q,v as W,n as p,t as r,g as X,u as Y,h as T}from"./index-AxCKe8US.js";const tt={class:"layout-root"},st={class:"toast-container"},et={class:"alert-toast-content"},ot={class:"alert-toast-title"},it={class:"alert-toast-message"},at=["onClick"],rt={class:"layout-content"},nt={class:"main"},lt={class:"control-panel"},dt={class:"tab-content"},ct={class:"semaforo-grid"},ut={class:"semaforo-data"},vt={class:"semaforo-value"},pt={class:"semaforo-data"},ht={class:"semaforo-value"},mt={class:"semaforo-data"},ft={class:"semaforo-value"},_t={class:"modal-header"},gt={class:"modal-body"},Ct={class:"cursos-list"},yt=["onClick"],wt={class:"curso-item-info"},bt={class:"curso-item-title"},kt={class:"curso-item-details"},xt={class:"data-section"},Pt={class:"directivos-grid"},At={class:"directivo-header"},Mt={class:"directivo-title-group"},Nt={class:"directivo-stats"},It={class:"directivo-stat"},St={class:"directivo-stat-value"},Dt={class:"directivo-stat"},Rt={class:"directivo-stat-value"},Et={class:"directivo-bar"},Ut={key:0,class:"directivo-message"},Bt={key:1,class:"directivo-message warning"},Ot={key:2,class:"directivo-message success"},Lt={class:"data-section"},Tt={class:"table-container"},$t={class:"data-table"},zt={style:{width:"25%"}},Ft={class:"curso-name-wrapper"},Vt={class:"curso-name"},Ht={class:"text-center",style:{width:"11%"}},jt={class:"inscritos-badge"},Gt={class:"text-right",style:{width:"13%"}},Zt={class:"amount paid"},qt={class:"text-right",style:{width:"13%"}},Jt={class:"amount expected"},Kt={class:"text-right",style:{width:"13%"}},Qt={class:"amount pending"},Wt={class:"text-center",style:{width:"12%"}},Xt={class:"progress-cell"},Yt={class:"mini-progress-bar"},ts={class:"progress-percent"},ss={class:"text-center",style:{width:"10%"}},es={key:0,class:"empty-row"},os={__name:"Dashboard",setup(is){const R=Y(),$=g("resumen"),b=g(!1),x=g([{id:1,title:"Curso Básico Scout",inscritos:28,capacidad:30,valor:25e3,estado:"Vigente"},{id:2,title:"Curso de Especialidades",inscritos:10,capacidad:20,valor:35e3,estado:"Vigente"},{id:3,title:"Formación de Dirigentes",inscritos:22,capacidad:25,valor:4e4,estado:"Vigente"},{id:4,title:"Capacitación de Liderazgo",inscritos:15,capacidad:20,valor:3e4,estado:"Vigente"}]),m=C(()=>[...x.value].sort((o,s)=>(o.title||"").localeCompare(s.title||"","es",{sensitivity:"base"})));function z(o,s){return o==="full"?`El curso "${s}" ha alcanzado su capacidad máxima.`:o==="near"?`El curso "${s}" está cerca de completar su capacidad.`:o==="bajo"?`El curso "${s}" tiene baja inscripción.`:""}function y(o){if(o==="inscritos"){const s=h.value.totalInscritos/(m.value.reduce((e,u)=>e+u.capacidad,0)||1);return s>=.85?"ok":s>=.5?"near":"full"}if(o==="pagos"){const s=h.value.ingresosPagados/(h.value.ingresosProyectados||1);return s>=.8?"ok":s>=.5?"near":"full"}return o==="cursos"?h.value.totalCursos>=3?"ok":"near":o==="alertas"?P.value.length===0?"ok":P.value.length<=2?"near":"full":"ok"}const E=g({1:45e4,2:28e4,3:52e4,4:15e4}),U=g({}),B=g({1:4,2:7,3:0,4:1}),O=C(()=>m.value.map(o=>{const s=Number(o.valor||0),e=Math.max(0,Math.round((Number(o.inscritos)||0)*s)),u=E.value[o.id]||0,i=(U.value[o.id]||0)*s,a=u||i||0,n=Math.max(0,e-a),l=e>0?Math.max(0,Math.min(100,Math.round(a/e*100))):0;return{id:o.id,title:o.title,inscritos:o.inscritos,expected:e,paid:a,unpaid:n,percentPaid:l}})),L=C(()=>O.value.filter(o=>o.unpaid>0).sort((o,s)=>s.unpaid-o.unpaid));function I(o){try{return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(Number(o||0))}catch{return`$${Number(o||0).toLocaleString("es-CL")}`}}const h=C(()=>{const o=m.value.length,s=m.value.reduce((a,n)=>a+(Number(n.inscritos)||0),0),e=m.value.reduce((a,n)=>a+(Number(n.inscritos)||0)*(Number(n.valor)||0),0),u=O.value.reduce((a,n)=>a+(Number(n.paid)||0),0),i=Math.max(0,e-u);return{totalCursos:o,totalInscritos:s,ingresosProyectados:e,ingresosPagados:u,ingresosPendientes:i}});C(()=>h.value.ingresosProyectados===0?0:Math.round(h.value.ingresosPagados/h.value.ingresosProyectados*100));const P=C(()=>{const o=[];return m.value.forEach(s=>{const e=Number(s.capacidad)||0,u=Number(s.inscritos)||0;if(!e)return;const i=u/e;i>=1?o.push({id:`${s.id}-full`,title:s.title,type:"full",label:"Completo"}):i>=.85?o.push({id:`${s.id}-near`,title:s.title,type:"near",label:"Casi lleno"}):i<=.25&&o.push({id:`${s.id}-bajo`,title:s.title,type:"bajo",label:"Baja inscripción"})}),o.slice(0,6)}),S=g([]),F=C(()=>P.value.filter(o=>!S.value.includes(o.id)));function V(o){S.value.push(o)}function H(){R.push("/gestionpersonas")}function j(o){R.push({path:"/cursos-capacitaciones",query:{edit:o}})}function G(){S.value=[]}function f(o){return B.value[o.id]!==void 0?B.value[o.id]:0}function _(o){return Math.max(2,Math.ceil(o.inscritos/10))}function Z(o){const s=f(o),e=_(o);return Math.min(100,s/e*100)}function k(o){const s=f(o),e=_(o);return s>=e?"ok":s>=e*.5?"near":"danger"}function A(o){const s=o.expected>0?o.paid/o.expected*100:0;return s>=80?"ok":s>=50?"near":"full"}function q(o){const s=A(o);return s==="ok"?"Al día":s==="near"?"Pendiente":"Crítico"}return K(()=>{async function o(s){try{const e=await fetch(s);if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){return console.warn("Failed to fetch",s,e),null}}(async()=>{const s=await o("/api/cursos/cursos/");Array.isArray(s)&&(x.value=s.map(i=>({id:i.CURS_ID||i.CUR_ID||i.id||i.ID,title:i.CUR_DESCRIPCION||i.CUR_CODIGO||i.CURS_ID||"Curso",inscritos:parseInt(i._inscritos_count||i.INSCRITOS||0)||0,capacidad:parseInt(i.CUR_COTA_CON_ALMUERZO||i.CUR_COTA_SIN_ALMUERZO||i.CUR_CANT_PARTICIPANTE||i.CAPACIDAD||0)||0,valor:0,estado:i.CUR_ESTADO||i.ESTADO||"Vigente"})));const e=await o("/api/cursos/cuotas/");if(Array.isArray(e)){const i={};e.forEach(a=>{const n=a.CUR_ID||a.curso_id||a.cur_id||null;if(!n)return;const l=Number(a.CUU_VALOR||a.valor||0),v=a.CUU_FECHA||"",w=i[n];(!w||l>w.val||v&&w.date&&v>w.date)&&(i[n]={val:l,date:v})}),x.value=x.value.map(a=>({...a,valor:i[a.id]?.val||a.valor||0}))}const u=await o("/api/pagos/pago-persona/");if(Array.isArray(u)){const i={},a={},n=l=>{const v=Number((l??"").toString().replace(/[^0-9.-]/g,""));return isNaN(v)?0:v};u.forEach(l=>{const v=l.CUR_ID||l.CURS_ID||l.curso_id||l.cur_id||null;if(!v)return;const w=n(l.PAP_VALOR||l.valor||l.MONTO);i[v]=(i[v]||0)+w,a[v]=(a[v]||0)+1}),E.value=i,U.value=a}})()}),(o,s)=>(c(),d("div",tt,[t("div",st,[(c(!0),d(M,null,N(F.value,(e,u)=>(c(),d("div",{key:e.id,class:"alert-toast"},[s[4]||(s[4]=t("div",{class:"alert-toast-icon"},"⚠️",-1)),t("div",et,[t("div",ot,r(e.title),1),t("div",it,r(z(e.type,e.title)),1)]),t("button",{class:"alert-toast-close",onClick:i=>V(e.id)},"✕",8,at)]))),128))]),t("div",rt,[t("main",nt,[t("div",lt,[s[23]||(s[23]=t("header",{class:"control-header"},[t("h1",null,"Centro de Control"),t("p",{class:"control-subtitle"},"Sistema de Gestión de Cursos Scout")],-1)),D("",!0),Q(t("div",dt,[t("div",ct,[t("div",{class:p(["semaforo-card",y("inscritos")]),onClick:H},[s[6]||(s[6]=t("svg",{class:"semaforo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),t("circle",{cx:"9",cy:"7",r:"4"}),t("path",{d:"M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"})],-1)),t("div",ut,[t("div",vt,r(h.value.totalInscritos),1),s[5]||(s[5]=t("div",{class:"semaforo-label"},"Pre inscritos totales",-1))]),t("div",{class:p(["semaforo-indicator",y("inscritos")])},null,2)],2),t("div",{class:p(["semaforo-card",y("cursos")]),onClick:s[0]||(s[0]=e=>b.value=!b.value)},[s[8]||(s[8]=t("svg",{class:"semaforo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),t("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})],-1)),t("div",pt,[t("div",ht,r(h.value.totalCursos),1),s[7]||(s[7]=t("div",{class:"semaforo-label"},"Cursos activos",-1))]),t("div",{class:p(["semaforo-indicator",y("cursos")])},null,2)],2),t("div",{class:p(["semaforo-card",y("alertas")]),onClick:G},[s[10]||(s[10]=t("svg",{class:"semaforo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),t("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),t("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})],-1)),t("div",mt,[t("div",ft,r(P.value.length),1),s[9]||(s[9]=t("div",{class:"semaforo-label"},"Alertas activas",-1))]),t("div",{class:p(["semaforo-indicator",y("alertas")])},null,2)],2)]),b.value?(c(),d("div",{key:0,class:"modal-overlay",onClick:s[3]||(s[3]=e=>b.value=!1)},[t("div",{class:"modal-content",onClick:s[2]||(s[2]=X(()=>{},["stop"]))},[t("div",_t,[s[11]||(s[11]=t("h3",null,"Cursos Activos",-1)),t("button",{class:"modal-close",onClick:s[1]||(s[1]=e=>b.value=!1)},"✕")]),t("div",gt,[t("div",Ct,[(c(!0),d(M,null,N(m.value,e=>(c(),d("div",{key:e.id,class:"curso-item",onClick:u=>j(e.id)},[s[12]||(s[12]=t("div",{class:"curso-item-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),t("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})])],-1)),t("div",wt,[t("div",bt,r(e.title),1),t("div",kt,r(e.inscritos)+"/"+r(e.capacidad)+" pre inscritos",1)]),s[13]||(s[13]=t("div",{class:"curso-item-arrow"},"→",-1))],8,yt))),128))])])])])):D("",!0),t("div",xt,[s[18]||(s[18]=t("div",{class:"section-header"},[t("div",null,[t("h2",{class:"section-title"},"Formadores por Curso"),t("p",{class:"section-description"},"Se requiere 1 formador por cada 10 pre inscritos (mínimo 2 formadores)")])],-1)),t("div",Pt,[(c(!0),d(M,null,N(m.value,e=>(c(),d("div",{key:e.id,class:p(["directivo-card",k(e)])},[t("div",At,[t("div",Mt,[s[14]||(s[14]=t("svg",{class:"directivo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),t("circle",{cx:"9",cy:"7",r:"4"}),t("path",{d:"M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"})],-1)),t("h3",null,r(e.title),1)]),t("span",{class:p(["directivo-badge",k(e)])},r(f(e))+"/"+r(_(e)),3)]),t("div",Nt,[t("span",It,[t("span",St,r(f(e)),1),s[15]||(s[15]=t("span",{class:"directivo-stat-label"},"Actuales",-1))]),s[17]||(s[17]=t("span",{class:"directivo-stat-divider"},"→",-1)),t("span",Dt,[t("span",Rt,r(_(e)),1),s[16]||(s[16]=t("span",{class:"directivo-stat-label"},"Requeridos",-1))])]),t("div",Et,[t("div",{class:p(["directivo-fill",k(e)]),style:T({width:Z(e)+"%"})},null,6)]),k(e)==="danger"?(c(),d("div",Ut," ⚠️ Faltan "+r(_(e)-f(e))+" formadores ",1)):k(e)==="near"?(c(),d("div",Bt," ⚡ Necesita "+r(_(e)-f(e))+" formador"+r(_(e)-f(e)>1?"es":"")+" más ",1)):(c(),d("div",Ot," ✓ Personal completo "))],2))),128))])]),t("div",Lt,[s[22]||(s[22]=t("div",{class:"section-header"},[t("div",null,[t("h2",{class:"section-title"},"Cursos con Pagos Pendientes"),t("p",{class:"section-description"},"Resumen de recaudación y montos pendientes por curso")])],-1)),t("div",Tt,[t("table",$t,[s[21]||(s[21]=t("thead",null,[t("tr",null,[t("th",{style:{width:"25%"}},"Curso"),t("th",{class:"text-center",style:{width:"11%"}},"Pre inscritos"),t("th",{class:"text-right",style:{width:"13%"}},"Recaudado"),t("th",{class:"text-right",style:{width:"13%"}},"Esperado"),t("th",{class:"text-right",style:{width:"13%"}},"Pendiente"),t("th",{class:"text-center",style:{width:"12%"}},"Progreso"),t("th",{class:"text-center",style:{width:"10%"}},"Estado")])],-1)),t("tbody",null,[(c(!0),d(M,null,N(L.value,e=>(c(),d("tr",{key:e.title,class:p("row-"+A(e))},[t("td",zt,[t("div",Ft,[s[19]||(s[19]=t("svg",{class:"curso-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),t("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})],-1)),t("span",Vt,r(e.title),1)])]),t("td",Ht,[t("span",jt,r(e.inscritos),1)]),t("td",Gt,[t("span",Zt,r(I(e.paid)),1)]),t("td",qt,[t("span",Jt,r(I(e.expected)),1)]),t("td",Kt,[t("span",Qt,r(I(e.unpaid)),1)]),t("td",Wt,[t("div",Xt,[t("div",Yt,[t("div",{class:p(["mini-progress-fill",A(e)]),style:T({width:e.percentPaid+"%"})},null,6)]),t("span",ts,r(e.percentPaid)+"%",1)])]),t("td",ss,[t("span",{class:p(["status-badge",A(e)])},r(q(e)),3)])],2))),128)),L.value.length===0?(c(),d("tr",es,[...s[20]||(s[20]=[t("td",{colspan:"7",class:"text-center"},[t("div",{class:"empty-state"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("p",null,"¡Excelente! No hay pagos pendientes")])],-1)])])):D("",!0)])])])])],512),[[W,$.value==="resumen"]])])])])]))}},rs=J(os,[["__scopeId","data-v-fc01ff68"]]);export{rs as default};
