import{a as I,_ as to,s as w,r as p,c as T,o as ro,b as f,d as v,e,g as F,x as t,A as d,y as io,F as z,f as H,t as u,j as c,n as uo}from"./index-AGwqymnc.js";import{I as _}from"./InputBase-Q2e5gDpP.js";import{B as m}from"./BaseButton-CLv0xIhn.js";import{B as R}from"./BaseSelect-DwMOC7Aj.js";import{p as co}from"./personasService-DL7bEFiV.js";const S="cursos/cursos";function P(r){return{id:r.CUR_ID||r.id,codigo:r.CUR_CODIGO||"",nombre:r.CUR_DESCRIPCION||"",estado:r.CUR_ESTADO,raw:r}}const N={async listar(){const r=await I(S);return Array.isArray(r)?r.map(P):[]},async obtener(r){const i=await I(`${S}/${r}`);return P(i)},async crear(r){const i=await I(S,{method:"POST",body:JSON.stringify(r)});return P(i)},async actualizar(r,i){const g=await I(`${S}/${r}`,{method:"PATCH",body:JSON.stringify(i)});return P(g)},async eliminar(r){return await I(`${S}/${r}`,{method:"DELETE"}),!0},async listarCuotas(){try{return await I("cursos/curso_cuota")}catch{try{return await I("cursos/cuotas")}catch{return[]}}}},mo={class:"crud-cursos container"},po={class:"card cursos-card"},Co={class:"card-body"},fo={class:"title-row"},vo={class:"filtros"},bo={class:"filtros-left"},go={class:"filtros-right"},Io={class:"courses-table"},Ro={class:"actions-cell"},Uo={key:0},Do={key:0,class:"pagination"},_o={key:1,class:"create-card"},So={class:"form-grid"},yo={class:"form-group"},Oo={class:"form-group"},Eo={class:"form-group"},Vo={class:"form-group"},Po={class:"form-group"},No={class:"form-group"},ho={class:"form-group"},Ao={class:"form-group"},ko={class:"form-group"},wo={class:"hierarchy-section"},To={class:"coordinador-form"},Fo={key:0,class:"coordinador-table"},$o={key:1,class:"no-coordinadores"},Bo={class:"actions-row"},Lo={__name:"CRUDcursos",setup(r){const i=w([]),g=p([]),a=w({nombre:"",codigo:"",fechaInicio:"",fechaFin:"",responsable:null,tipoCurso:null,comuna:null,modalidad:null,coordinadores:[]}),$=p([{value:1,label:"BÃ¡sico"},{value:2,label:"Especialidad"}]),j=p([{value:1,label:"Comuna 1"},{value:2,label:"Comuna 2"}]),J=p([{value:1,label:"Presencial"},{value:2,label:"Mixta"}]),B=p([{value:1,label:"Coordinador"},{value:2,label:"Asistente"}]),C=w({persona:null,cargo:null});function K(){!C.persona||!C.cargo||(a.coordinadores.push({PER_ID:C.persona,CAR_ID:C.cargo}),C.persona=null,C.cargo=null)}function Q(s){a.coordinadores.splice(s,1)}function W(s){return g.value.find(l=>l.value===s)?.label||"-"}function X(s){return B.value.find(l=>l.value===s)?.label||"-"}const h=p(""),b=p(1),A=p(10),L=T(()=>{const s=h.value.toLowerCase().trim();return s?i.filter(o=>(o.CUR_DESCRIPCION||"").toLowerCase().includes(s)||(o.CUR_CODIGO||"").toLowerCase().includes(s)):i}),y=T(()=>Math.max(1,Math.ceil(L.value.length/A.value))),G=T(()=>{const s=(b.value-1)*A.value;return L.value.slice(s,s+A.value)});function x(s){s<1||s>y.value||(b.value=s)}function O(){b.value=1}const U=p(!1),D=p(!1),E=p(-1);async function Y(){if(!a.nombre||!a.codigo||!a.responsable){alert("Por favor completa nombre, cÃ³digo y responsable");return}try{if(D.value&&E.value>=0){const s=i[E.value],o={CUR_DESCRIPCION:a.nombre,CUR_CODIGO:a.codigo,...a.responsable?{PER_ID_RESPONSABLE:a.responsable}:{},...a.tipoCurso?{CUR_TIPO_CURSO:a.tipoCurso}:{},...a.modalidad?{CUR_MODALIDAD:a.modalidad}:{},...a.comuna?{COM_ID_LUGAR:a.comuna}:{}};await N.actualizar(s.CURS_ID||s.id,o);const l=await N.listar();i.splice(0,i.length,...(l||[]).map(n=>({CURS_ID:n.id,CUR_DESCRIPCION:n.nombre||n.codigo||"Curso",CUR_CODIGO:n.codigo||"-",CUR_TIPO_CURSO:null,fechaInicio:null,fechaTermino:null,responsableNombre:"-",CUR_ESTADO:n.estado??1,habilitado:n.estado===1}))),O(),q()}else alert("La creaciÃ³n de cursos en el servidor requiere campos adicionales (usuario, tipo, comuna, modalidad, administraciÃ³n, cuotas, lugar, etc.). Agrega esos campos al formulario para habilitar el POST.")}catch(s){console.error("Error guardando curso:",s),alert("No se pudo guardar el curso. Revisa los datos e intÃ©ntalo nuevamente.")}}function Z(s){const o=i[s];a.nombre=o.CUR_DESCRIPCION||"",a.codigo=o.CUR_CODIGO||"",o.CUR_FECHA_SOLICITUD?a.fechaInicio=new Date(o.CUR_FECHA_SOLICITUD).toISOString().split("T")[0]:a.fechaInicio="",a.fechaFin="",a.responsable=o.PER_ID_RESPONSABLE||null,a.coordinadores=[],D.value=!0,E.value=s,U.value=!0}function oo(s){i[s].habilitado=!i[s].habilitado}function eo(){q()}function q(){a.nombre="",a.codigo="",a.fechaInicio="",a.fechaFin="",a.responsable=null,a.tipoCurso=null,a.comuna=null,a.modalidad=null,a.coordinadores=[],U.value=!1,D.value=!1,E.value=-1}async function lo(s){const o=i[s];if(!(!o||!confirm(`Â¿Eliminar el curso "${o.CUR_DESCRIPCION||o.CUR_CODIGO}"?`)))try{await N.eliminar(o.CURS_ID||o.id),i.splice(s,1),O()}catch(n){console.error("Error eliminando curso:",n),alert("No se pudo eliminar el curso.")}}function ao(s,o){return!s&&!o?"-":s&&o?`${k(s)} - ${k(o)}`:k(s||o)}function k(s){return s?new Date(s).toLocaleDateString("es-CL",{day:"2-digit",month:"short",year:"numeric"}):""}ro(async()=>{try{const o=(await N.listar()||[]).map(n=>({CURS_ID:n.id,CUR_DESCRIPCION:n.nombre||n.codigo||"Curso",CUR_CODIGO:n.codigo||"-",CUR_TIPO_CURSO:null,fechaInicio:null,fechaTermino:null,responsableNombre:"-",CUR_ESTADO:n.estado??1,habilitado:n.estado===1}));i.splice(0,i.length,...o);const l=await co.listarBasic();g.value=(l||[]).map(n=>({value:n.id,label:n.nombre}))}catch(s){console.warn("No se pudieron cargar cursos/personas desde API",s)}});function so(s){return $.value.find(l=>l.value===(Number(s)||s))?.label||"â€”"}function M(s){const o=Number(s);return o===1?{class:"badge-success",text:"Vigente"}:o===0?{class:"badge-secondary",text:"Inactivo"}:{class:"badge-info",text:"Desconocido"}}function no(s){console.log("Gestionar participantes para curso",s)}return(s,o)=>(v(),f("div",mo,[o[39]||(o[39]=e("header",{class:"page-header"},[e("h3",null,"GestiÃ³n de Cursos")],-1)),e("section",po,[e("div",Co,[e("div",fo,[o[16]||(o[16]=e("h4",null,"GestiÃ³n de Cursos",-1)),t(m,{class:"btn-success",onClick:o[0]||(o[0]=l=>U.value=!U.value)},{default:d(()=>[...o[15]||(o[15]=[c("+ Nuevo Curso",-1)])]),_:1})]),e("div",vo,[e("div",bo,[t(_,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=l=>h.value=l),placeholder:"Buscar por nombre o cÃ³digo...",onKeydown:io(O,["enter"])},null,8,["modelValue"])]),e("div",go,[t(m,{class:"btn-search",variant:"primary",onClick:O},{default:d(()=>[...o[17]||(o[17]=[c("ðŸ”Ž Buscar",-1)])]),_:1})])]),e("table",Io,[o[22]||(o[22]=e("thead",null,[e("tr",null,[e("th",null,"Nombre del Curso"),e("th",null,"CÃ³digo"),e("th",null,"Tipo"),e("th",null,"Fechas del Curso"),e("th",null,"Responsable"),e("th",null,"Estado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(v(!0),f(z,null,H(G.value,(l,n)=>(v(),f("tr",{key:l.CURS_ID},[e("td",null,u(l.CUR_DESCRIPCION),1),e("td",null,u(l.CUR_CODIGO),1),e("td",null,u(so(l.CUR_TIPO_CURSO)),1),e("td",null,u(ao(l.fechaInicio,l.fechaTermino)),1),e("td",null,u(l.responsableNombre),1),e("td",null,[e("span",{class:uo(["badge",M(l.CUR_ESTADO).class])},u(M(l.CUR_ESTADO).text),3)]),e("td",Ro,[t(m,{class:"btn-info",small:"",onClick:V=>no(l.CURS_ID)},{default:d(()=>[...o[18]||(o[18]=[c("Participantes",-1)])]),_:1},8,["onClick"]),t(m,{class:"btn-warning",small:"",onClick:V=>Z(n)},{default:d(()=>[...o[19]||(o[19]=[c("Editar",-1)])]),_:1},8,["onClick"]),t(m,{class:"btn-secondary",small:"",onClick:V=>oo(n)},{default:d(()=>[c(u(l.habilitado?"Deshabilitar":"Habilitar"),1)]),_:2},1032,["onClick"]),t(m,{class:"btn-danger",small:"",onClick:V=>lo(n)},{default:d(()=>[...o[20]||(o[20]=[c("Eliminar",-1)])]),_:1},8,["onClick"])])]))),128)),G.value.length===0?(v(),f("tr",Uo,[...o[21]||(o[21]=[e("td",{colspan:"7",class:"no-results"},"No se encontraron cursos.",-1)])])):F("",!0)])]),y.value>1?(v(),f("div",Do,[t(m,{onClick:o[2]||(o[2]=l=>x(b.value-1)),disabled:b.value===1},{default:d(()=>[...o[23]||(o[23]=[c("Anterior",-1)])]),_:1},8,["disabled"]),e("span",null,"PÃ¡gina "+u(b.value)+" de "+u(y.value),1),t(m,{onClick:o[3]||(o[3]=l=>x(b.value+1)),disabled:b.value===y.value},{default:d(()=>[...o[24]||(o[24]=[c("Siguiente",-1)])]),_:1},8,["disabled"])])):F("",!0),U.value?(v(),f("div",_o,[e("h5",null,u(D.value?"Editar Curso":"Crear Nuevo Curso"),1),e("div",So,[e("div",yo,[o[25]||(o[25]=e("label",null,"Nombre del Curso:",-1)),t(_,{type:"text",placeholder:"Ej: FormaciÃ³n de Dirigentes",modelValue:a.nombre,"onUpdate:modelValue":o[4]||(o[4]=l=>a.nombre=l)},null,8,["modelValue"])]),e("div",Oo,[o[26]||(o[26]=e("label",null,"CÃ³digo:",-1)),t(_,{type:"text",placeholder:"Ej: FD-001",modelValue:a.codigo,"onUpdate:modelValue":o[5]||(o[5]=l=>a.codigo=l)},null,8,["modelValue"])]),e("div",Eo,[o[27]||(o[27]=e("label",null,"Fecha Inicio:",-1)),t(_,{type:"date",modelValue:a.fechaInicio,"onUpdate:modelValue":o[6]||(o[6]=l=>a.fechaInicio=l)},null,8,["modelValue"])]),e("div",Vo,[o[28]||(o[28]=e("label",null,"Fecha Fin:",-1)),t(_,{type:"date",modelValue:a.fechaFin,"onUpdate:modelValue":o[7]||(o[7]=l=>a.fechaFin=l)},null,8,["modelValue"])]),e("div",Po,[o[29]||(o[29]=e("label",null,"Responsable:",-1)),t(R,{modelValue:a.responsable,"onUpdate:modelValue":o[8]||(o[8]=l=>a.responsable=l),options:g.value,placeholder:"Seleccione un responsable"},null,8,["modelValue","options"])]),e("div",No,[o[30]||(o[30]=e("label",null,"Tipo de Curso:",-1)),t(R,{modelValue:a.tipoCurso,"onUpdate:modelValue":o[9]||(o[9]=l=>a.tipoCurso=l),options:$.value,placeholder:"Seleccione un tipo"},null,8,["modelValue","options"])]),e("div",ho,[o[31]||(o[31]=e("label",null,"Comuna (Lugar):",-1)),t(R,{modelValue:a.comuna,"onUpdate:modelValue":o[10]||(o[10]=l=>a.comuna=l),options:j.value,placeholder:"Seleccione una comuna"},null,8,["modelValue","options"])]),e("div",Ao,[o[32]||(o[32]=e("label",null,"Modalidad:",-1)),t(R,{modelValue:a.modalidad,"onUpdate:modelValue":o[11]||(o[11]=l=>a.modalidad=l),options:J.value,placeholder:"Seleccione modalidad"},null,8,["modelValue","options"])])]),e("div",ko,[o[33]||(o[33]=e("label",null,"Responsable:",-1)),t(R,{modelValue:a.responsable,"onUpdate:modelValue":o[12]||(o[12]=l=>a.responsable=l),options:g.value,placeholder:"Selecciona un responsable"},null,8,["modelValue","options"])]),e("div",wo,[o[37]||(o[37]=e("label",null,"Equipo del Curso (JerarquÃ­as):",-1)),e("div",To,[t(R,{modelValue:C.persona,"onUpdate:modelValue":o[13]||(o[13]=l=>C.persona=l),options:g.value,placeholder:"Seleccionar Persona",class:"select-persona"},null,8,["modelValue","options"]),t(R,{modelValue:C.cargo,"onUpdate:modelValue":o[14]||(o[14]=l=>C.cargo=l),options:B.value,placeholder:"Seleccionar Cargo",class:"select-cargo"},null,8,["modelValue","options"]),t(m,{onClick:K,class:"btn-success"},{default:d(()=>[...o[34]||(o[34]=[c("AÃ±adir al Equipo",-1)])]),_:1})]),a.coordinadores.length>0?(v(),f("table",Fo,[o[36]||(o[36]=e("thead",null,[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Cargo"),e("th",null,"AcciÃ³n")])],-1)),e("tbody",null,[(v(!0),f(z,null,H(a.coordinadores,(l,n)=>(v(),f("tr",{key:n},[e("td",null,u(W(l.PER_ID)),1),e("td",null,u(X(l.CAR_ID)),1),e("td",null,[t(m,{onClick:V=>Q(n),class:"btn-danger",small:""},{default:d(()=>[...o[35]||(o[35]=[c("Eliminar",-1)])]),_:1},8,["onClick"])])]))),128))])])):(v(),f("p",$o,"AÃºn no se han aÃ±adido miembros al equipo."))]),e("div",Bo,[t(m,{class:"btn-primary",onClick:Y},{default:d(()=>[c(u(D.value?"Actualizar":"Crear Curso"),1)]),_:1}),t(m,{class:"btn-secondary",onClick:eo},{default:d(()=>[...o[38]||(o[38]=[c("Cancelar",-1)])]),_:1})])])):F("",!0)])])]))}},Ho=to(Lo,[["__scopeId","data-v-19c304c9"]]);export{Ho as default};
