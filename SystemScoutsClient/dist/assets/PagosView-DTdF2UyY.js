import{_ as U,r as l,o as D,c as h,a as R,b as P,d as a,f as y,A as S,n as B,i as m,s as q,w as C,j as F,x as G,g as z,k as V}from"./index-AxCKe8US.js";import{D as J,N as K}from"./NotificationToast-Cb0gFXXe.js";import{B as H}from"./BaseModal-Cmh2x84d.js";const W="http://localhost:8000/api".replace(/\/$/,"");async function f(e,s={}){const t=String(e).replace(/^\//,""),v=!/\?(.*)$/.test(t)&&!t.endsWith("/"),g=`${W}/${t}${v?"/":""}`,p=!s.method||s.method.toUpperCase()==="GET",i={...s.headers||{}};!p&&!("Content-Type"in i)&&(i["Content-Type"]="application/json");const u=await fetch(g,{headers:i,...s});if(!u.ok){const b=await u.text();throw new Error(`${u.status} ${u.statusText}: ${b}`)}return u.status===204?null:u.json()}function Q(e){return{id:e.PER_ID,nombre:[e.PER_NOMBRES,e.PER_APELPTA,e.PER_APELMAT].filter(Boolean).join(" "),rut:e.PER_RUN&&e.PER_DV?`${e.PER_RUN}-${e.PER_DV}`:e.PER_RUN||"",email:e.PER_MAIL,direccion:e.PER_DIRECCION,telefono:e.PER_FONO,fecha_nac:e.PER_FECHA_NAC,otros:e.PER_OTROS||"",raw:e}}const w={async obtenerPagos(){const e=await f("Persona");return Array.isArray(e)?e.map(Q):[]},async agregarPago(e){return f("Persona",{method:"POST",body:JSON.stringify(e)})},async createPersona(e){return f("create-persona/",{method:"POST",body:JSON.stringify(e)})},async eliminarPago(e){return f(`Persona/${e}`,{method:"DELETE"})},async anularPago(e){const s=await f(`Persona/${e}`);if(!s)throw new Error("Objeto no encontrado");const t={...s,PER_VIGENTE:!1};return f(`Persona/${e}`,{method:"PUT",body:JSON.stringify(t)})},async registrarDevolucion(e,s){return console.log("registrarDevolucion:",e,s),Promise.resolve({ok:!0})},registrarAuditoria(e,s){console.log("auditoria:",e,s)}},X={class:"pago-view"},Y={class:"navegacion-vistas"},Z={key:0,class:"vista-buscar"},oo={class:"header-acciones"},ao={class:"filtros"},eo={key:1,class:"vista-registrar"},ro={class:"card-registro"},so={class:"card-registro"},to={class:"form-group"},no={class:"form-group"},lo={class:"form-group"},io={__name:"PagosView",setup(e){const s=l([{name:"nombre",label:"Nombre",field:"nombre",sortable:!0,align:"left"},{name:"rut",label:"RUT",field:"rut",align:"left"},{name:"curso",label:"Curso",field:"curso",sortable:!0},{name:"valor_pagado",label:"Valor",field:"valor_pagado",align:"right"},{name:"tipo_pago",label:"Tipo Pago",field:"tipo_pago"},{name:"fecha_pago",label:"Fecha Pago",field:"fecha_pago"},{name:"actions",label:"Acciones",field:"actions",align:"center"}]),t=l([]),v=l({mensaje:"",tipo:""}),g=l(""),p=l(""),i=l("buscar"),u=r=>{i.value=r},b=l(!1),_=l(!1),E=l(null),M=r=>{E.value=r?{...r}:null,b.value=!0},A=()=>{b.value=!1},k=r=>{E.value=r,_.value=!0};D(T);async function T(){try{const r=await w.obtenerPagos();t.value=Array.isArray(r)?r:[]}catch(r){console.error("Error detallado al cargar pagos:",r),c("Error al cargar los pagos. Revisa la consola.","error"),t.value=[]}}const N=()=>{p.value=g.value},x=()=>{g.value="",p.value=""},$=h(()=>{if(!p.value)return t.value;const r=p.value.toLowerCase();return Array.isArray(t.value)?t.value.filter(o=>o.nombre.toLowerCase().includes(r)||o.rut.toLowerCase().includes(r)):[]});async function j(r){try{r.id?(await w.actualizarPago(r.id,r),c("Pago actualizado correctamente","exito")):(await w.crearPago(r),c("Pago registrado correctamente","exito")),T(),A()}catch{c("Error al guardar el pago","error")}}function c(r,o){v.value={mensaje:r,tipo:o},setTimeout(()=>{v.value={mensaje:"",tipo:""}},3e3)}const n=l({grupo:"",curso:"",file:null}),O=r=>{n.value.file=r.target.files[0]},I=async()=>{if(!n.value.grupo||!n.value.curso||!n.value.file){c("Complete todos los campos del formulario masivo","error");return}try{console.log("Registrando pago masivo:",n.value),c("Lógica de pago masivo aún no implementada","info"),n.value={grupo:"",curso:"",file:null},document.getElementById("comprobanteMasivo").value=null}catch{c("Error en el registro masivo","error")}},L=()=>{console.log("Exportando CSV..."),c("Función de exportar CSV ejecutada","info")};return(r,o)=>(P(),R("div",X,[a("div",Y,[a("button",{onClick:o[0]||(o[0]=d=>u("buscar")),class:B({active:i.value==="buscar"})},[...o[6]||(o[6]=[a("i",{class:"fas fa-search"},null,-1),m(" Buscar Inscripciones ",-1)])],2),a("button",{onClick:o[1]||(o[1]=d=>u("registrar")),class:B({active:i.value==="registrar"})},[...o[7]||(o[7]=[a("i",{class:"fas fa-plus"},null,-1),m(" Registrar Pagos ",-1)])],2)]),i.value==="buscar"?(P(),R("div",Z,[a("div",oo,[o[10]||(o[10]=a("h2",null,"Listado de Pagos",-1)),a("div",ao,[C(a("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=d=>g.value=d),placeholder:"Buscar por Nombre o RUT...",class:"input-busqueda",onKeyup:G(N,["enter"])},null,544),[[F,g.value]]),a("button",{onClick:N,class:"btn btn-primario"},[...o[8]||(o[8]=[a("i",{class:"fas fa-search"},null,-1),m(" Buscar ",-1)])]),a("button",{onClick:x,class:"btn btn-secundario"}," Limpiar "),a("button",{onClick:L,class:"btn btn-secundario"},[...o[9]||(o[9]=[a("i",{class:"fas fa-file-csv"},null,-1),m(" Exportar ",-1)])])])]),q(J,{rows:$.value,columns:s.value,onEditar:M,onAnular:k},null,8,["rows","columns"])])):y("",!0),i.value==="registrar"?(P(),R("div",eo,[a("div",ro,[o[11]||(o[11]=a("h3",null,[a("i",{class:"fas fa-user"}),m(" Registro Individual")],-1)),o[12]||(o[12]=a("p",null,"Registra un nuevo pago para un participante específico. Esto abrirá el formulario de inscripción individual.",-1)),a("button",{onClick:o[3]||(o[3]=d=>M(null)),class:"btn btn-primario"}," Registrar Pago Individual ")]),a("div",so,[o[19]||(o[19]=a("h3",null,[a("i",{class:"fas fa-users"}),m(" Registro Masivo")],-1)),o[20]||(o[20]=a("p",null,"Registra un pago grupal (ej. depósito de grupo) y asígnalo a múltiples participantes del mismo grupo y curso.",-1)),a("form",{onSubmit:z(I,["prevent"]),class:"form-masivo"},[a("div",to,[o[14]||(o[14]=a("label",{for:"grupoMasivo"},"Grupo",-1)),C(a("select",{id:"grupoMasivo","onUpdate:modelValue":o[4]||(o[4]=d=>n.value.grupo=d),required:""},[...o[13]||(o[13]=[a("option",{value:""},"Seleccione un grupo",-1),a("option",{value:"Ñuble"},"Ñuble",-1),a("option",{value:"Biobío"},"Biobío",-1)])],512),[[V,n.value.grupo]])]),a("div",no,[o[16]||(o[16]=a("label",{for:"cursoMasivo"},"Curso",-1)),C(a("select",{id:"cursoMasivo","onUpdate:modelValue":o[5]||(o[5]=d=>n.value.curso=d),required:""},[...o[15]||(o[15]=[a("option",{value:""},"Seleccione un curso",-1),a("option",{value:"Formación de Dirigentes"},"Formación de Dirigentes",-1)])],512),[[V,n.value.curso]])]),a("div",lo,[o[17]||(o[17]=a("label",{for:"comprobanteMasivo"},"Comprobante Grupal",-1)),a("input",{type:"file",id:"comprobanteMasivo",onChange:O,required:""},null,32)]),o[18]||(o[18]=a("button",{type:"submit",class:"btn btn-primario"},"Registrar Pago Masivo",-1))],32)])])):y("",!0),b.value?(P(),S(H,{key:2,pago:E.value,onCerrar:A,onGuardar:j},null,8,["pago"])):y("",!0),v.value.mensaje?(P(),S(K,{key:3,mensaje:v.value.mensaje,tipo:v.value.tipo},null,8,["mensaje","tipo"])):y("",!0)]))}},go=U(io,[["__scopeId","data-v-41359dad"]]);export{go as default};
