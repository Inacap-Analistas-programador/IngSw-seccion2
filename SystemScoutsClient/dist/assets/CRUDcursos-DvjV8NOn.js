import{_ as q,q as N,r as R,o as G,b as g,d as f,e,g as h,h as a,y as d,k as c,s as M,F as k,f as _,t as i,n as j}from"./index-BPA1--Y9.js";import{I as U}from"./InputBase-BNv6Uapi.js";import{B as m}from"./BaseButton-DZplU3gx.js";import{B as y}from"./BaseSelect-BQgFQTzb.js";import{p as J}from"./personasService-IigZgjN-.js";const H="http://localhost:8000/api".replace(/\/$/,"");async function u(n,t={}){const p=String(n).replace(/^\//,""),l=!/\?(.*)$/.test(p)&&!p.endsWith("/"),S=`${H}/${p}${l?"/":""}`,P=!t.method||t.method.toUpperCase()==="GET",E={...t.headers||{}};!P&&!("Content-Type"in E)&&(E["Content-Type"]="application/json");const C=await fetch(S,{headers:E,...t});if(!C.ok){const b=await C.text();throw new Error(`${C.status} ${C.statusText}: ${b}`)}return C.status===204?null:C.json()}const T={async obtenerCursos(){const n=await u("cursos/curso");return Array.isArray(n)?n:[]},async agregarCurso(n){return u("cursos/curso",{method:"POST",body:JSON.stringify(n)})},async actualizarCurso(n,t){return u(`cursos/curso/${n}`,{method:"PUT",body:JSON.stringify(t)})},async eliminarCurso(n){return u(`cursos/curso/${n}`,{method:"DELETE"})},async obtenerFechas(){return u("cursos/fechas")},async guardarFecha(n){if(n.CUF_ID){const{CUF_ID:t,...p}=n;return u(`cursos/fechas/${t}`,{method:"PUT",body:JSON.stringify(p)})}else return u("cursos/fechas",{method:"POST",body:JSON.stringify(n)})},async obtenerCoordinadores(){return u("cursos/coordinador")},async guardarCoordinador(n){return u("cursos/coordinador",{method:"POST",body:JSON.stringify(n)})},async eliminarCoordinador(n){return u(`cursos/coordinador/${n}`,{method:"DELETE"})},async obtenerInscripciones(){return u("personas/persona_curso")},async inscribirPersona(n){return u("personas/persona_curso",{method:"POST",body:JSON.stringify(n)})},async eliminarInscripcion(n){return u(`personas/persona_curso/${n}`,{method:"DELETE"})}},z={class:"crud-cursos container"},K={class:"card cursos-card"},Z={class:"card-body"},Q={class:"title-row"},W={class:"filtros"},X={class:"filtros-left"},Y={class:"filtros-right"},x={class:"courses-table"},oo={class:"actions-cell"},eo={key:0},so={key:0,class:"pagination"},ro={key:1,class:"create-card"},lo={class:"form-grid"},no={class:"form-group"},ao={class:"form-group"},to={class:"form-group"},io={class:"form-group"},uo={class:"form-group"},co={class:"form-group"},mo={class:"form-group"},po={class:"form-group"},Co={class:"form-group"},go={class:"hierarchy-section"},fo={class:"coordinador-form"},bo={key:0,class:"coordinador-table"},vo={key:1,class:"no-coordinadores"},yo={class:"actions-row"},Eo={__name:"CRUDcursos",setup(n){const t=N([]),p=R([]),l=N({nombre:"",codigo:"",fechaInicio:"",fechaFin:"",responsable:null,jerarquias:[]}),S=R(""),P=R([]);async function E(){try{const[s,o]=await Promise.all([T.obtenerCursos(),J.obtenerPersonas()]);t.splice(0,t.length,...s.map(r=>({...r,responsableNombre:o.find(v=>v.PER_ID===r.PER_ID_RESPONSABLE)?.PER_NOMBRES||"No asignado"}))),p.value=o.map(r=>({value:r.PER_ID,label:`${r.PER_NOMBRES} ${r.PER_APELPTA||""}`.trim()})),C()}catch(s){console.error("Error al cargar datos:",s)}}function C(){const s=S.value.toLowerCase().trim();if(!s){P.value=t;return}P.value=t.filter(o=>o.nombre.toLowerCase().includes(s)||o.codigo.toLowerCase().includes(s))}G(E);const b=R(!1),I=R(!1),D=R(-1);async function F(){if(!l.nombre||!l.codigo||!l.responsable){alert("Por favor completa nombre, código y responsable");return}const s={CUR_DESCRIPCION:l.nombre,CUR_CODIGO:l.codigo,CUR_FECHA_SOLICITUD:new Date().toISOString().split("T")[0],PER_ID_RESPONSABLE:l.responsable,TCU_ID:1,CAR_ID_RESPONSABLE:1,COM_ID_LUGAR:1,CUR_ADMINISTRA:1,CUR_COTA_CON_ALMUERZO:0,CUR_COTA_SIN_ALMUERZO:0,CUR_MODALIDAD:1,CUR_TIPO_CURSO:1,CUR_LUGAR:"Lugar de ejemplo",CUR_ESTADO:1};try{if(I.value){const o=t[D.value].CURS_ID;await T.actualizarCurso(o,s)}else await T.agregarCurso(s);await E(),A()}catch(o){console.error("Error al guardar el curso:",o),alert("Hubo un error al guardar el curso. Revisa la consola para más detalles.")}}function L(s){const o=t[s];l.nombre=o.CUR_DESCRIPCION,l.codigo=o.CUR_CODIGO,o.CUR_FECHA_SOLICITUD?l.fechaInicio=new Date(o.CUR_FECHA_SOLICITUD).toISOString().split("T")[0]:l.fechaInicio="",l.fechaFin="",l.responsable=o.PER_ID_RESPONSABLE,l.jerarquias=[],I.value=!0,D.value=s,b.value=!0}function $(s){t[s].habilitado=!t[s].habilitado}function w(){A()}function A(){l.nombre="",l.codigo="",l.fechaInicio="",l.fechaFin="",l.responsable=null,l.jerarquias=[],b.value=!1,I.value=!1,D.value=-1}function B(s,o){return!s&&!o?"-":s&&o?`${O(s)} - ${O(o)}`:O(s||o)}function O(s){return s?new Date(s).toLocaleDateString("es-CL",{day:"2-digit",month:"short",year:"numeric"}):""}return(s,o)=>(f(),g("div",z,[o[38]||(o[38]=e("header",{class:"page-header"},[e("h3",null,"Gestión de Cursos")],-1)),e("section",K,[e("div",Z,[e("div",Q,[o[16]||(o[16]=e("h4",null,"Gestión de Cursos",-1)),a(m,{class:"btn-success",onClick:o[0]||(o[0]=r=>b.value=!b.value)},{default:d(()=>[...o[15]||(o[15]=[c("+ Nuevo Curso",-1)])]),_:1})]),e("div",W,[e("div",X,[a(U,{modelValue:S.value,"onUpdate:modelValue":o[1]||(o[1]=r=>S.value=r),placeholder:"Buscar por nombre o código...",onKeydown:M(C,["enter"])},null,8,["modelValue"])]),e("div",Y,[a(m,{class:"btn-search",variant:"primary",onClick:C},{default:d(()=>[...o[17]||(o[17]=[c("🔎 Buscar",-1)])]),_:1})])]),e("table",x,[o[21]||(o[21]=e("thead",null,[e("tr",null,[e("th",null,"Nombre del Curso"),e("th",null,"Código"),e("th",null,"Tipo"),e("th",null,"Fechas del Curso"),e("th",null,"Responsable"),e("th",null,"Estado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(f(!0),g(k,null,_(s.paginatedCursos,(r,v)=>(f(),g("tr",{key:r.CURS_ID},[e("td",null,i(r.CUR_DESCRIPCION),1),e("td",null,i(r.CUR_CODIGO),1),e("td",null,i(s.getTipoCursoText(r.CUR_TIPO_CURSO)),1),e("td",null,i(B(r.fechaInicio,r.fechaTermino)),1),e("td",null,i(r.responsableNombre),1),e("td",null,[e("span",{class:j(["badge",s.getEstadoInfo(r.CUR_ESTADO).class])},i(s.getEstadoInfo(r.CUR_ESTADO).text),3)]),e("td",oo,[a(m,{class:"btn-info",small:"",onClick:V=>s.gestionarParticipantes(r.CURS_ID)},{default:d(()=>[...o[18]||(o[18]=[c("Participantes",-1)])]),_:1},8,["onClick"]),a(m,{class:"btn-warning",small:"",onClick:V=>L(v)},{default:d(()=>[...o[19]||(o[19]=[c("Editar",-1)])]),_:1},8,["onClick"]),a(m,{class:"btn-secondary",small:"",onClick:V=>$(v)},{default:d(()=>[c(i(r.habilitado?"Deshabilitar":"Habilitar"),1)]),_:2},1032,["onClick"])])]))),128)),s.paginatedCursos.length===0?(f(),g("tr",eo,[...o[20]||(o[20]=[e("td",{colspan:"7",class:"no-results"},"No se encontraron cursos.",-1)])])):h("",!0)])]),s.totalPages>1?(f(),g("div",so,[a(m,{onClick:o[2]||(o[2]=r=>s.goToPage(s.currentPage-1)),disabled:s.currentPage===1},{default:d(()=>[...o[22]||(o[22]=[c("Anterior",-1)])]),_:1},8,["disabled"]),e("span",null,"Página "+i(s.currentPage)+" de "+i(s.totalPages),1),a(m,{onClick:o[3]||(o[3]=r=>s.goToPage(s.currentPage+1)),disabled:s.currentPage===s.totalPages},{default:d(()=>[...o[23]||(o[23]=[c("Siguiente",-1)])]),_:1},8,["disabled"])])):h("",!0),b.value?(f(),g("div",ro,[e("h5",null,i(I.value?"Editar Curso":"Crear Nuevo Curso"),1),e("div",lo,[e("div",no,[o[24]||(o[24]=e("label",null,"Nombre del Curso:",-1)),a(U,{type:"text",placeholder:"Ej: Formación de Dirigentes",modelValue:l.nombre,"onUpdate:modelValue":o[4]||(o[4]=r=>l.nombre=r)},null,8,["modelValue"])]),e("div",ao,[o[25]||(o[25]=e("label",null,"Código:",-1)),a(U,{type:"text",placeholder:"Ej: FD-001",modelValue:l.codigo,"onUpdate:modelValue":o[5]||(o[5]=r=>l.codigo=r)},null,8,["modelValue"])]),e("div",to,[o[26]||(o[26]=e("label",null,"Fecha Inicio:",-1)),a(U,{type:"date",modelValue:l.fechaInicio,"onUpdate:modelValue":o[6]||(o[6]=r=>l.fechaInicio=r)},null,8,["modelValue"])]),e("div",io,[o[27]||(o[27]=e("label",null,"Fecha Fin:",-1)),a(U,{type:"date",modelValue:l.fechaFin,"onUpdate:modelValue":o[7]||(o[7]=r=>l.fechaFin=r)},null,8,["modelValue"])]),e("div",uo,[o[28]||(o[28]=e("label",null,"Responsable:",-1)),a(y,{modelValue:l.responsable,"onUpdate:modelValue":o[8]||(o[8]=r=>l.responsable=r),options:p.value,placeholder:"Seleccione un responsable"},null,8,["modelValue","options"])]),e("div",co,[o[29]||(o[29]=e("label",null,"Tipo de Curso:",-1)),a(y,{modelValue:l.tipoCurso,"onUpdate:modelValue":o[9]||(o[9]=r=>l.tipoCurso=r),options:s.tiposCurso,placeholder:"Seleccione un tipo"},null,8,["modelValue","options"])]),e("div",mo,[o[30]||(o[30]=e("label",null,"Comuna (Lugar):",-1)),a(y,{modelValue:l.comuna,"onUpdate:modelValue":o[10]||(o[10]=r=>l.comuna=r),options:s.comunas,placeholder:"Seleccione una comuna"},null,8,["modelValue","options"])]),e("div",po,[o[31]||(o[31]=e("label",null,"Modalidad:",-1)),a(y,{modelValue:l.modalidad,"onUpdate:modelValue":o[11]||(o[11]=r=>l.modalidad=r),options:s.modalidadOptions,placeholder:"Seleccione modalidad"},null,8,["modelValue","options"])])]),e("div",Co,[o[32]||(o[32]=e("label",null,"Responsable:",-1)),a(y,{modelValue:l.responsable,"onUpdate:modelValue":o[12]||(o[12]=r=>l.responsable=r),options:p.value,placeholder:"Selecciona un responsable"},null,8,["modelValue","options"])]),e("div",go,[o[36]||(o[36]=e("label",null,"Equipo del Curso (Jerarquías):",-1)),e("div",fo,[a(y,{modelValue:s.nuevoCoordinador.persona,"onUpdate:modelValue":o[13]||(o[13]=r=>s.nuevoCoordinador.persona=r),options:p.value,placeholder:"Seleccionar Persona",class:"select-persona"},null,8,["modelValue","options"]),a(y,{modelValue:s.nuevoCoordinador.cargo,"onUpdate:modelValue":o[14]||(o[14]=r=>s.nuevoCoordinador.cargo=r),options:s.cargos,placeholder:"Seleccionar Cargo",class:"select-cargo"},null,8,["modelValue","options"]),a(m,{onClick:s.agregarCoordinador,class:"btn-success"},{default:d(()=>[...o[33]||(o[33]=[c("Añadir al Equipo",-1)])]),_:1},8,["onClick"])]),l.coordinadores.length>0?(f(),g("table",bo,[o[35]||(o[35]=e("thead",null,[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Cargo"),e("th",null,"Acción")])],-1)),e("tbody",null,[(f(!0),g(k,null,_(l.coordinadores,(r,v)=>(f(),g("tr",{key:v},[e("td",null,i(s.getPersonaNombre(r.PER_ID)),1),e("td",null,i(s.getCargoNombre(r.CAR_ID)),1),e("td",null,[a(m,{onClick:V=>s.eliminarCoordinador(v),class:"btn-danger",small:""},{default:d(()=>[...o[34]||(o[34]=[c("Eliminar",-1)])]),_:1},8,["onClick"])])]))),128))])])):(f(),g("p",vo,"Aún no se han añadido miembros al equipo."))]),e("div",yo,[a(m,{class:"btn-primary",onClick:F},{default:d(()=>[c(i(I.value?"Actualizar":"Crear Curso"),1)]),_:1}),a(m,{class:"btn-secondary",onClick:w},{default:d(()=>[...o[37]||(o[37]=[c("Cancelar",-1)])]),_:1})])])):h("",!0)])])]))}},Do=q(Eo,[["__scopeId","data-v-8de4ac88"]]);export{Do as default};
