import{a as I,_ as ro,x as T,r as p,c as F,o as io,b as f,d as v,e,g as $,h as n,A as d,y as uo,F as H,f as J,t as u,k as c,n as co}from"./index-BpDPJ6tp.js";import{I as _}from"./InputBase-Fm00WdG5.js";import{B as m}from"./BaseButton-Cns34Frs.js";import{B as R}from"./BaseSelect-CiK4LuIM.js";import{p as mo}from"./personasService-p-Mp8mfR.js";import{A as S}from"./AppIcons-BmakeQ3O.js";const y="cursos/cursos";function h(r){return{id:r.CUR_ID||r.id,codigo:r.CUR_CODIGO||"",nombre:r.CUR_DESCRIPCION||"",estado:r.CUR_ESTADO,raw:r}}const N={async listar(){const r=await I(y);return Array.isArray(r)?r.map(h):[]},async obtener(r){const i=await I(`${y}/${r}`);return h(i)},async crear(r){const i=await I(y,{method:"POST",body:JSON.stringify(r)});return h(i)},async actualizar(r,i){const g=await I(`${y}/${r}`,{method:"PATCH",body:JSON.stringify(i)});return h(g)},async eliminar(r){return await I(`${y}/${r}`,{method:"DELETE"}),!0},async listarCuotas(){try{return await I("cursos/curso_cuota")}catch{try{return await I("cursos/cuotas")}catch{return[]}}}},po={class:"crud-cursos container"},Co={class:"card cursos-card"},fo={class:"card-body"},vo={class:"title-row"},bo={class:"filtros"},go={class:"filtros-left"},Io={class:"filtros-right"},Ro={class:"courses-table"},Uo={class:"actions-cell"},Do={key:0},_o={key:0,class:"pagination"},So={key:1,class:"create-card"},yo={class:"form-grid"},Oo={class:"form-group"},Eo={class:"form-group"},Vo={class:"form-group"},Po={class:"form-group"},ho={class:"form-group"},No={class:"form-group"},Ao={class:"form-group"},ko={class:"form-group"},wo={class:"form-group"},To={class:"hierarchy-section"},Fo={class:"coordinador-form"},$o={key:0,class:"coordinador-table"},Bo={key:1,class:"no-coordinadores"},Lo={class:"actions-row"},Go={__name:"CRUDcursos",setup(r){const i=T([]),g=p([]),a=T({nombre:"",codigo:"",fechaInicio:"",fechaFin:"",responsable:null,tipoCurso:null,comuna:null,modalidad:null,coordinadores:[]}),B=p([{value:1,label:"Básico"},{value:2,label:"Especialidad"}]),j=p([{value:1,label:"Comuna 1"},{value:2,label:"Comuna 2"}]),K=p([{value:1,label:"Presencial"},{value:2,label:"Mixta"}]),L=p([{value:1,label:"Coordinador"},{value:2,label:"Asistente"}]),C=T({persona:null,cargo:null});function Q(){!C.persona||!C.cargo||(a.coordinadores.push({PER_ID:C.persona,CAR_ID:C.cargo}),C.persona=null,C.cargo=null)}function W(s){a.coordinadores.splice(s,1)}function X(s){return g.value.find(l=>l.value===s)?.label||"-"}function Y(s){return L.value.find(l=>l.value===s)?.label||"-"}const A=p(""),b=p(1),k=p(10),G=F(()=>{const s=A.value.toLowerCase().trim();return s?i.filter(o=>(o.CUR_DESCRIPCION||"").toLowerCase().includes(s)||(o.CUR_CODIGO||"").toLowerCase().includes(s)):i}),O=F(()=>Math.max(1,Math.ceil(G.value.length/k.value))),x=F(()=>{const s=(b.value-1)*k.value;return G.value.slice(s,s+k.value)});function z(s){s<1||s>O.value||(b.value=s)}function E(){b.value=1}const U=p(!1),D=p(!1),V=p(-1);async function Z(){if(!a.nombre||!a.codigo||!a.responsable){alert("Por favor completa nombre, código y responsable");return}try{if(D.value&&V.value>=0){const s=i[V.value],o={CUR_DESCRIPCION:a.nombre,CUR_CODIGO:a.codigo,...a.responsable?{PER_ID_RESPONSABLE:a.responsable}:{},...a.tipoCurso?{CUR_TIPO_CURSO:a.tipoCurso}:{},...a.modalidad?{CUR_MODALIDAD:a.modalidad}:{},...a.comuna?{COM_ID_LUGAR:a.comuna}:{}};await N.actualizar(s.CURS_ID||s.id,o);const l=await N.listar();i.splice(0,i.length,...(l||[]).map(t=>({CURS_ID:t.id,CUR_DESCRIPCION:t.nombre||t.codigo||"Curso",CUR_CODIGO:t.codigo||"-",CUR_TIPO_CURSO:null,fechaInicio:null,fechaTermino:null,responsableNombre:"-",CUR_ESTADO:t.estado??1,habilitado:t.estado===1}))),E(),q()}else alert("La creación de cursos en el servidor requiere campos adicionales (usuario, tipo, comuna, modalidad, administración, cuotas, lugar, etc.). Agrega esos campos al formulario para habilitar el POST.")}catch(s){console.error("Error guardando curso:",s),alert("No se pudo guardar el curso. Revisa los datos e inténtalo nuevamente.")}}function oo(s){const o=i[s];a.nombre=o.CUR_DESCRIPCION||"",a.codigo=o.CUR_CODIGO||"",o.CUR_FECHA_SOLICITUD?a.fechaInicio=new Date(o.CUR_FECHA_SOLICITUD).toISOString().split("T")[0]:a.fechaInicio="",a.fechaFin="",a.responsable=o.PER_ID_RESPONSABLE||null,a.coordinadores=[],D.value=!0,V.value=s,U.value=!0}function eo(s){i[s].habilitado=!i[s].habilitado}function lo(){q()}function q(){a.nombre="",a.codigo="",a.fechaInicio="",a.fechaFin="",a.responsable=null,a.tipoCurso=null,a.comuna=null,a.modalidad=null,a.coordinadores=[],U.value=!1,D.value=!1,V.value=-1}async function ao(s){const o=i[s];if(!(!o||!confirm(`¿Eliminar el curso "${o.CUR_DESCRIPCION||o.CUR_CODIGO}"?`)))try{await N.eliminar(o.CURS_ID||o.id),i.splice(s,1),E()}catch(t){console.error("Error eliminando curso:",t),alert("No se pudo eliminar el curso.")}}function so(s,o){return!s&&!o?"-":s&&o?`${w(s)} - ${w(o)}`:w(s||o)}function w(s){return s?new Date(s).toLocaleDateString("es-CL",{day:"2-digit",month:"short",year:"numeric"}):""}io(async()=>{try{const o=(await N.listar()||[]).map(t=>({CURS_ID:t.id,CUR_DESCRIPCION:t.nombre||t.codigo||"Curso",CUR_CODIGO:t.codigo||"-",CUR_TIPO_CURSO:null,fechaInicio:null,fechaTermino:null,responsableNombre:"-",CUR_ESTADO:t.estado??1,habilitado:t.estado===1}));i.splice(0,i.length,...o);const l=await mo.listarBasic();g.value=(l||[]).map(t=>({value:t.id,label:t.nombre}))}catch(s){console.warn("No se pudieron cargar cursos/personas desde API",s)}});function no(s){return B.value.find(l=>l.value===(Number(s)||s))?.label||"—"}function M(s){const o=Number(s);return o===1?{class:"badge-success",text:"Vigente"}:o===0?{class:"badge-secondary",text:"Inactivo"}:{class:"badge-info",text:"Desconocido"}}function to(s){console.log("Gestionar participantes para curso",s)}return(s,o)=>(v(),f("div",po,[o[39]||(o[39]=e("header",{class:"page-header"},[e("h3",null,"Gestión de Cursos")],-1)),e("section",Co,[e("div",fo,[e("div",vo,[o[16]||(o[16]=e("h4",null,"Gestión de Cursos",-1)),n(m,{class:"btn-success",onClick:o[0]||(o[0]=l=>U.value=!U.value)},{default:d(()=>[n(S,{name:"plus",size:16}),o[15]||(o[15]=c(" Nuevo Curso",-1))]),_:1})]),e("div",bo,[e("div",go,[n(_,{modelValue:A.value,"onUpdate:modelValue":o[1]||(o[1]=l=>A.value=l),placeholder:"Buscar por nombre o código...",onKeydown:uo(E,["enter"])},null,8,["modelValue"])]),e("div",Io,[n(m,{class:"btn-search",variant:"primary",onClick:E},{default:d(()=>[n(S,{name:"search",size:16}),o[17]||(o[17]=c(" Buscar",-1))]),_:1})])]),e("table",Ro,[o[22]||(o[22]=e("thead",null,[e("tr",null,[e("th",null,"Nombre del Curso"),e("th",null,"Código"),e("th",null,"Tipo"),e("th",null,"Fechas del Curso"),e("th",null,"Responsable"),e("th",null,"Estado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(v(!0),f(H,null,J(x.value,(l,t)=>(v(),f("tr",{key:l.CURS_ID},[e("td",null,u(l.CUR_DESCRIPCION),1),e("td",null,u(l.CUR_CODIGO),1),e("td",null,u(no(l.CUR_TIPO_CURSO)),1),e("td",null,u(so(l.fechaInicio,l.fechaTermino)),1),e("td",null,u(l.responsableNombre),1),e("td",null,[e("span",{class:co(["badge",M(l.CUR_ESTADO).class])},u(M(l.CUR_ESTADO).text),3)]),e("td",Uo,[n(m,{class:"btn-info",small:"",onClick:P=>to(l.CURS_ID)},{default:d(()=>[n(S,{name:"users",size:14}),o[18]||(o[18]=c(" Participantes",-1))]),_:1},8,["onClick"]),n(m,{class:"btn-warning",small:"",onClick:P=>oo(t)},{default:d(()=>[n(S,{name:"edit",size:14}),o[19]||(o[19]=c(" Editar",-1))]),_:1},8,["onClick"]),n(m,{class:"btn-secondary",small:"",onClick:P=>eo(t)},{default:d(()=>[c(u(l.habilitado?"Deshabilitar":"Habilitar"),1)]),_:2},1032,["onClick"]),n(m,{class:"btn-danger",small:"",onClick:P=>ao(t)},{default:d(()=>[n(S,{name:"trash",size:14}),o[20]||(o[20]=c(" Eliminar",-1))]),_:1},8,["onClick"])])]))),128)),x.value.length===0?(v(),f("tr",Do,[...o[21]||(o[21]=[e("td",{colspan:"7",class:"no-results"},"No se encontraron cursos.",-1)])])):$("",!0)])]),O.value>1?(v(),f("div",_o,[n(m,{onClick:o[2]||(o[2]=l=>z(b.value-1)),disabled:b.value===1},{default:d(()=>[...o[23]||(o[23]=[c("Anterior",-1)])]),_:1},8,["disabled"]),e("span",null,"Página "+u(b.value)+" de "+u(O.value),1),n(m,{onClick:o[3]||(o[3]=l=>z(b.value+1)),disabled:b.value===O.value},{default:d(()=>[...o[24]||(o[24]=[c("Siguiente",-1)])]),_:1},8,["disabled"])])):$("",!0),U.value?(v(),f("div",So,[e("h5",null,u(D.value?"Editar Curso":"Crear Nuevo Curso"),1),e("div",yo,[e("div",Oo,[o[25]||(o[25]=e("label",null,"Nombre del Curso:",-1)),n(_,{type:"text",placeholder:"Ej: Formación de Dirigentes",modelValue:a.nombre,"onUpdate:modelValue":o[4]||(o[4]=l=>a.nombre=l)},null,8,["modelValue"])]),e("div",Eo,[o[26]||(o[26]=e("label",null,"Código:",-1)),n(_,{type:"text",placeholder:"Ej: FD-001",modelValue:a.codigo,"onUpdate:modelValue":o[5]||(o[5]=l=>a.codigo=l)},null,8,["modelValue"])]),e("div",Vo,[o[27]||(o[27]=e("label",null,"Fecha Inicio:",-1)),n(_,{type:"date",modelValue:a.fechaInicio,"onUpdate:modelValue":o[6]||(o[6]=l=>a.fechaInicio=l)},null,8,["modelValue"])]),e("div",Po,[o[28]||(o[28]=e("label",null,"Fecha Fin:",-1)),n(_,{type:"date",modelValue:a.fechaFin,"onUpdate:modelValue":o[7]||(o[7]=l=>a.fechaFin=l)},null,8,["modelValue"])]),e("div",ho,[o[29]||(o[29]=e("label",null,"Responsable:",-1)),n(R,{modelValue:a.responsable,"onUpdate:modelValue":o[8]||(o[8]=l=>a.responsable=l),options:g.value,placeholder:"Seleccione un responsable"},null,8,["modelValue","options"])]),e("div",No,[o[30]||(o[30]=e("label",null,"Tipo de Curso:",-1)),n(R,{modelValue:a.tipoCurso,"onUpdate:modelValue":o[9]||(o[9]=l=>a.tipoCurso=l),options:B.value,placeholder:"Seleccione un tipo"},null,8,["modelValue","options"])]),e("div",Ao,[o[31]||(o[31]=e("label",null,"Comuna (Lugar):",-1)),n(R,{modelValue:a.comuna,"onUpdate:modelValue":o[10]||(o[10]=l=>a.comuna=l),options:j.value,placeholder:"Seleccione una comuna"},null,8,["modelValue","options"])]),e("div",ko,[o[32]||(o[32]=e("label",null,"Modalidad:",-1)),n(R,{modelValue:a.modalidad,"onUpdate:modelValue":o[11]||(o[11]=l=>a.modalidad=l),options:K.value,placeholder:"Seleccione modalidad"},null,8,["modelValue","options"])])]),e("div",wo,[o[33]||(o[33]=e("label",null,"Responsable:",-1)),n(R,{modelValue:a.responsable,"onUpdate:modelValue":o[12]||(o[12]=l=>a.responsable=l),options:g.value,placeholder:"Selecciona un responsable"},null,8,["modelValue","options"])]),e("div",To,[o[37]||(o[37]=e("label",null,"Equipo del Curso (Jerarquías):",-1)),e("div",Fo,[n(R,{modelValue:C.persona,"onUpdate:modelValue":o[13]||(o[13]=l=>C.persona=l),options:g.value,placeholder:"Seleccionar Persona",class:"select-persona"},null,8,["modelValue","options"]),n(R,{modelValue:C.cargo,"onUpdate:modelValue":o[14]||(o[14]=l=>C.cargo=l),options:L.value,placeholder:"Seleccionar Cargo",class:"select-cargo"},null,8,["modelValue","options"]),n(m,{onClick:Q,class:"btn-success"},{default:d(()=>[...o[34]||(o[34]=[c("Añadir al Equipo",-1)])]),_:1})]),a.coordinadores.length>0?(v(),f("table",$o,[o[36]||(o[36]=e("thead",null,[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Cargo"),e("th",null,"Acción")])],-1)),e("tbody",null,[(v(!0),f(H,null,J(a.coordinadores,(l,t)=>(v(),f("tr",{key:t},[e("td",null,u(X(l.PER_ID)),1),e("td",null,u(Y(l.CAR_ID)),1),e("td",null,[n(m,{onClick:P=>W(t),class:"btn-danger",small:""},{default:d(()=>[...o[35]||(o[35]=[c("Eliminar",-1)])]),_:1},8,["onClick"])])]))),128))])])):(v(),f("p",Bo,"Aún no se han añadido miembros al equipo."))]),e("div",Lo,[n(m,{class:"btn-primary",onClick:Z},{default:d(()=>[c(u(D.value?"Actualizar":"Crear Curso"),1)]),_:1}),n(m,{class:"btn-secondary",onClick:lo},{default:d(()=>[...o[38]||(o[38]=[c("Cancelar",-1)])]),_:1})])])):$("",!0)])])]))}},jo=ro(Go,[["__scopeId","data-v-778e23b2"]]);export{jo as default};
