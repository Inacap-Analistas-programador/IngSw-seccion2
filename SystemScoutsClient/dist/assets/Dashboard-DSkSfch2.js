import{_ as J,r as p,c as _,o as K,a as B,b as n,d as r,e as s,F as x,f as P,g as N,w as Q,v as W,n as l,t as a,h as X,u as Y,i as U}from"./index-BKYQARX_.js";import{p as ss}from"./personasService-2XjK7U9-.js";const ts={class:"layout-root"},es={class:"toast-container"},os={class:"alert-toast-content"},as={class:"alert-toast-title"},is={class:"alert-toast-message"},ns=["onClick"],rs={class:"layout-content"},ls={class:"main"},ds={class:"control-panel"},cs={class:"tab-content"},us={class:"semaforo-grid"},vs={class:"semaforo-data"},ps={class:"semaforo-value"},hs={class:"semaforo-data"},ms={class:"semaforo-value"},fs={class:"semaforo-data"},_s={class:"semaforo-value"},Cs={class:"modal-header"},gs={class:"modal-body"},ys={class:"cursos-list"},bs=["onClick"],ws={class:"curso-item-info"},ks={class:"curso-item-title"},xs={class:"curso-item-details"},Ps={class:"data-section"},As={class:"directivos-grid"},Ms={class:"directivo-header"},Is={class:"directivo-title-group"},Ns={class:"directivo-stats"},Ss={class:"directivo-stat"},Ds={class:"directivo-stat-value"},Rs={class:"directivo-stat"},Es={class:"directivo-stat-value"},Bs={class:"directivo-bar"},Us={key:0,class:"directivo-message"},$s={key:1,class:"directivo-message warning"},Ls={key:2,class:"directivo-message success"},Os={class:"data-section"},zs={class:"table-container"},Ts={class:"data-table"},Fs={style:{width:"25%"}},Hs={class:"curso-name-wrapper"},js={class:"curso-name"},Vs={class:"text-center",style:{width:"auto"}},Gs={class:"inscritos-badge"},qs={class:"text-right",style:{width:"auto"}},Zs={class:"amount paid"},Js={class:"text-right",style:{width:"auto"}},Ks={class:"amount expected"},Qs={class:"text-right",style:{width:"auto"}},Ws={class:"amount pending"},Xs={class:"text-center",style:{width:"auto"}},Ys={class:"progress-cell"},st={class:"mini-progress-bar"},tt={class:"progress-percent"},et={class:"text-center",style:{width:"10%"}},ot={key:0,class:"empty-row"},at={__name:"Dashboard",setup(it){const S=Y(),$=p("resumen"),g=p(!1),b=p([]),A=p(0),h=_(()=>[...b.value].sort((o,t)=>(o.title||"").localeCompare(t.title||"","es",{sensitivity:"base"})));function L(o,t){return o==="full"?`El curso "${t}" ha alcanzado su capacidad máxima.`:o==="near"?`El curso "${t}" está cerca de completar su capacidad.`:o==="bajo"?`El curso "${t}" tiene baja inscripción.`:""}function C(o){if(o==="inscritos"){const t=v.value.totalInscritos/(h.value.reduce((e,i)=>e+i.capacidad,0)||1);return t>=.85?"ok":t>=.5?"near":"full"}if(o==="pagos"){const t=v.value.ingresosPagados/(v.value.ingresosProyectados||1);return t>=.8?"ok":t>=.5?"near":"full"}return o==="cursos"?v.value.totalCursos>=3?"ok":"near":o==="alertas"?w.value.length===0?"ok":w.value.length<=2?"near":"full":"ok"}const O=p({}),z=p({}),D=p({1:4,2:7,3:0,4:1}),R=_(()=>h.value.map(o=>{const t=Number(o.valor||0),e=Math.max(0,Math.round((Number(o.inscritos)||0)*t)),i=O.value[o.id]||0,d=(z.value[o.id]||0)*t,c=i||d||0,u=Math.max(0,e-c),Z=e>0?Math.max(0,Math.min(100,Math.round(c/e*100))):0;return{id:o.id,title:o.title,inscritos:o.inscritos,expected:e,paid:c,unpaid:u,percentPaid:Z}})),E=_(()=>R.value.filter(o=>o.unpaid>0).sort((o,t)=>t.unpaid-o.unpaid));function M(o){try{return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(Number(o||0))}catch{return`$${Number(o||0).toLocaleString("es-CL")}`}}const v=_(()=>{const o=h.value.length,t=Number(A.value||0),e=h.value.reduce((c,u)=>c+(Number(u.inscritos)||0)*(Number(u.valor)||0),0),i=R.value.reduce((c,u)=>c+(Number(u.paid)||0),0),d=Math.max(0,e-i);return{totalCursos:o,totalInscritos:t,ingresosProyectados:e,ingresosPagados:i,ingresosPendientes:d}});_(()=>v.value.ingresosProyectados===0?0:Math.round(v.value.ingresosPagados/v.value.ingresosProyectados*100));const w=_(()=>{const o=[];return h.value.forEach(t=>{const e=Number(t.capacidad)||0,i=Number(t.inscritos)||0;if(!e)return;const d=i/e;d>=1?o.push({id:`${t.id}-full`,title:t.title,type:"full",label:"Completo"}):d>=.85?o.push({id:`${t.id}-near`,title:t.title,type:"near",label:"Casi lleno"}):d<=.25&&o.push({id:`${t.id}-bajo`,title:t.title,type:"bajo",label:"Baja inscripción"})}),o.slice(0,6)}),I=p([]),T=_(()=>w.value.filter(o=>!I.value.includes(o.id)));function F(o){I.value.push(o)}function H(){S.push("/gestionpersonas")}function j(o){S.push({path:"/cursos-capacitaciones",query:{edit:o}})}function V(){I.value=[]}function m(o){return D.value[o.id]!==void 0?D.value[o.id]:0}function f(o){return Math.max(2,Math.ceil(o.inscritos/10))}function G(o){const t=m(o),e=f(o);return Math.min(100,t/e*100)}function y(o){const t=m(o),e=f(o);return t>=e?"ok":t>=e*.5?"near":"danger"}function k(o){const t=o.expected>0?o.paid/o.expected*100:0;return t>=80?"ok":t>=50?"near":"full"}function q(o){const t=k(o);return t==="ok"?"Al día":t==="near"?"Pendiente":"Crítico"}return K(()=>{(async()=>{try{const o=await B("cursos/cursos");Array.isArray(o)&&(b.value=o.map(t=>({id:t.CURS_ID||t.CUR_ID||t.id||t.ID,title:t.CUR_DESCRIPCION||t.CUR_CODIGO||t.CURS_ID||"Curso",inscritos:parseInt(t._inscritos_count||t.INSCRITOS||0)||0,capacidad:parseInt(t.CUR_COTA_CON_ALMUERZO||t.CUR_COTA_SIN_ALMUERZO||t.CUR_CANT_PARTICIPANTE||t.CAPACIDAD||0)||0,valor:0,estado:t.CUR_ESTADO||t.ESTADO||"Vigente"})))}catch(o){console.warn("Cursos no disponibles:",o)}try{const o=await B("cursos/cuotas");if(Array.isArray(o)){const t={};o.forEach(e=>{const i=e.CUR_ID||e.curso_id||e.cur_id||null;if(!i)return;const d=Number(e.CUU_VALOR||e.valor||0),c=e.CUU_FECHA||"",u=t[i];(!u||d>u.val||c&&u.date&&c>u.date)&&(t[i]={val:d,date:c})}),b.value=b.value.map(e=>({...e,valor:t[e.id]?.val||e.valor||0}))}}catch(o){console.warn("Cuotas no disponibles:",o)}try{const o=await ss.listarBasic();A.value=Array.isArray(o)?o.length:0}catch(o){console.warn("Personas no disponibles:",o),A.value=0}})()}),(o,t)=>(r(),n("div",ts,[s("div",es,[(r(!0),n(x,null,P(T.value,(e,i)=>(r(),n("div",{key:e.id,class:"alert-toast"},[t[4]||(t[4]=s("div",{class:"alert-toast-icon"},"⚠️",-1)),s("div",os,[s("div",as,a(e.title),1),s("div",is,a(L(e.type,e.title)),1)]),s("button",{class:"alert-toast-close",onClick:d=>F(e.id)},"✕",8,ns)]))),128))]),s("div",rs,[s("main",ls,[s("div",ds,[t[23]||(t[23]=s("header",{class:"control-header"},[s("h1",null,"Centro de Control"),s("p",{class:"control-subtitle"},"Sistema de Gestión de Cursos Scout")],-1)),N("",!0),Q(s("div",cs,[s("div",us,[s("div",{class:l(["semaforo-card",C("inscritos")]),onClick:H},[t[6]||(t[6]=s("svg",{class:"semaforo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),s("circle",{cx:"9",cy:"7",r:"4"}),s("path",{d:"M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"})],-1)),s("div",vs,[s("div",ps,a(v.value.totalInscritos),1),t[5]||(t[5]=s("div",{class:"semaforo-label"},"Pre inscritos totales",-1))]),s("div",{class:l(["semaforo-indicator",C("inscritos")])},null,2)],2),s("div",{class:l(["semaforo-card",C("cursos")]),onClick:t[0]||(t[0]=e=>g.value=!g.value)},[t[8]||(t[8]=s("svg",{class:"semaforo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})],-1)),s("div",hs,[s("div",ms,a(v.value.totalCursos),1),t[7]||(t[7]=s("div",{class:"semaforo-label"},"Cursos activos",-1))]),s("div",{class:l(["semaforo-indicator",C("cursos")])},null,2)],2),s("div",{class:l(["semaforo-card",C("alertas")]),onClick:V},[t[10]||(t[10]=s("svg",{class:"semaforo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),s("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),s("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})],-1)),s("div",fs,[s("div",_s,a(w.value.length),1),t[9]||(t[9]=s("div",{class:"semaforo-label"},"Alertas activas",-1))]),s("div",{class:l(["semaforo-indicator",C("alertas")])},null,2)],2)]),g.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=e=>g.value=!1)},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=X(()=>{},["stop"]))},[s("div",Cs,[t[11]||(t[11]=s("h3",null,"Cursos Activos",-1)),s("button",{class:"modal-close",onClick:t[1]||(t[1]=e=>g.value=!1)},"✕")]),s("div",gs,[s("div",ys,[(r(!0),n(x,null,P(h.value,e=>(r(),n("div",{key:e.id,class:"curso-item",onClick:i=>j(e.id)},[t[12]||(t[12]=s("div",{class:"curso-item-icon"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})])],-1)),s("div",ws,[s("div",ks,a(e.title),1),s("div",xs,a(e.inscritos)+"/"+a(e.capacidad)+" pre inscritos",1)]),t[13]||(t[13]=s("div",{class:"curso-item-arrow"},"→",-1))],8,bs))),128))])])])])):N("",!0),s("div",Ps,[t[18]||(t[18]=s("div",{class:"section-header"},[s("div",null,[s("h2",{class:"section-title"},"Formadores por Curso"),s("p",{class:"section-description"},"Se requiere 1 formador por cada 10 pre inscritos (mínimo 2 formadores)")])],-1)),s("div",As,[(r(!0),n(x,null,P(h.value,e=>(r(),n("div",{key:e.id,class:l(["directivo-card",y(e)])},[s("div",Ms,[s("div",Is,[t[14]||(t[14]=s("svg",{class:"directivo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),s("circle",{cx:"9",cy:"7",r:"4"}),s("path",{d:"M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"})],-1)),s("h3",null,a(e.title),1)]),s("span",{class:l(["directivo-badge",y(e)])},a(m(e))+"/"+a(f(e)),3)]),s("div",Ns,[s("span",Ss,[s("span",Ds,a(m(e)),1),t[15]||(t[15]=s("span",{class:"directivo-stat-label"},"Actuales",-1))]),t[17]||(t[17]=s("span",{class:"directivo-stat-divider"},"→",-1)),s("span",Rs,[s("span",Es,a(f(e)),1),t[16]||(t[16]=s("span",{class:"directivo-stat-label"},"Requeridos",-1))])]),s("div",Bs,[s("div",{class:l(["directivo-fill",y(e)]),style:U({width:G(e)+"%"})},null,6)]),y(e)==="danger"?(r(),n("div",Us," ⚠️ Faltan "+a(f(e)-m(e))+" formadores ",1)):y(e)==="near"?(r(),n("div",$s," ⚡ Necesita "+a(f(e)-m(e))+" formador"+a(f(e)-m(e)>1?"es":"")+" más ",1)):(r(),n("div",Ls," ✓ Personal completo "))],2))),128))])]),s("div",Os,[t[22]||(t[22]=s("div",{class:"section-header"},[s("div",null,[s("h2",{class:"section-title"},"Cursos con Pagos Pendientes"),s("p",{class:"section-description"},"Resumen de recaudación y montos pendientes por curso")])],-1)),s("div",zs,[s("table",Ts,[t[21]||(t[21]=s("thead",null,[s("tr",null,[s("th",{style:{width:"auto"}},"Curso"),s("th",{class:"text-center",style:{width:"auto"}},"PreInscritos"),s("th",{class:"text-center",style:{width:"auto"}},"Recaudado"),s("th",{class:"text-center",style:{width:"auto"}},"Esperado"),s("th",{class:"text-center",style:{width:"auto"}},"Pendiente"),s("th",{class:"text-center",style:{width:"auto"}},"Progreso"),s("th",{class:"text-center",style:{width:"auto"}},"Estado")])],-1)),s("tbody",null,[(r(!0),n(x,null,P(E.value,e=>(r(),n("tr",{key:e.title,class:l("row-"+k(e))},[s("td",Fs,[s("div",Hs,[t[19]||(t[19]=s("svg",{class:"curso-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})],-1)),s("span",js,a(e.title),1)])]),s("td",Vs,[s("span",Gs,a(e.inscritos),1)]),s("td",qs,[s("span",Zs,a(M(e.paid)),1)]),s("td",Js,[s("span",Ks,a(M(e.expected)),1)]),s("td",Qs,[s("span",Ws,a(M(e.unpaid)),1)]),s("td",Xs,[s("div",Ys,[s("div",st,[s("div",{class:l(["mini-progress-fill",k(e)]),style:U({width:e.percentPaid+"%"})},null,6)]),s("span",tt,a(e.percentPaid)+"%",1)])]),s("td",et,[s("span",{class:l(["status-badge",k(e)])},a(q(e)),3)])],2))),128)),E.value.length===0?(r(),n("tr",ot,[...t[20]||(t[20]=[s("td",{colspan:"7",class:"text-center"},[s("div",{class:"empty-state"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",null,"¡Excelente! No hay pagos pendientes")])],-1)])])):N("",!0)])])])])],512),[[W,$.value==="resumen"]])])])])]))}},lt=J(at,[["__scopeId","data-v-8f446bac"]]);export{lt as default};
