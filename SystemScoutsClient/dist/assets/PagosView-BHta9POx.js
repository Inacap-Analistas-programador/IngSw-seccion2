import{_ as oe,r as d,o as ae,c as le,b as v,d as n,e as o,g as R,B as $,n as I,k as w,i as F,w as i,l as m,m as V,t as c,F as O,f as _,y as re,A as L,p as te}from"./index-BpDPJ6tp.js";import{p as se}from"./personasService-p-Mp8mfR.js";import{N as ne}from"./NotificationToast-b5XHfFhp.js";import{B as G}from"./BaseModal-BGOhLaHA.js";/* empty css                                                                  */const ie="http://localhost:8000/api".replace(/\/$/,"");async function x(r,s={}){const f=String(r).replace(/^\//,""),P=!/\?(.*)$/.test(f)&&!f.endsWith("/"),A=`${ie}/${f}${P?"/":""}`,E=!s.method||s.method.toUpperCase()==="GET",y={...s.headers||{}};!E&&!("Content-Type"in y)&&(y["Content-Type"]="application/json");const p=await fetch(A,{headers:y,...s});if(!p.ok){const U=await p.text();throw new Error(`${p.status} ${p.statusText}: ${U}`)}return p.status===204?null:p.json()}function ue(r){return{id:r.PER_ID,nombre:[r.PER_NOMBRES,r.PER_APELPTA,r.PER_APELMAT].filter(Boolean).join(" "),rut:r.PER_RUN&&r.PER_DV?`${r.PER_RUN}-${r.PER_DV}`:r.PER_RUN||"",email:r.PER_MAIL,direccion:r.PER_DIRECCION,telefono:r.PER_FONO,fecha_nac:r.PER_FECHA_NAC,otros:r.PER_OTROS||"",raw:r}}const J={async obtenerPagos(){const r=await x("Persona");return Array.isArray(r)?r.map(ue):[]},async agregarPago(r){return x("Persona",{method:"POST",body:JSON.stringify(r)})},async createPersona(r){return x("create-persona/",{method:"POST",body:JSON.stringify(r)})},async eliminarPago(r){return x(`Persona/${r}`,{method:"DELETE"})},async anularPago(r){const s=await x(`Persona/${r}`);if(!s)throw new Error("Objeto no encontrado");const f={...s,PER_VIGENTE:!1};return x(`Persona/${r}`,{method:"PUT",body:JSON.stringify(f)})},async registrarDevolucion(r,s){return console.log("registrarDevolucion:",r,s),Promise.resolve({ok:!0})},registrarAuditoria(r,s){console.log("auditoria:",r,s)}},de={class:"pago-view"},ve={class:"navegacion-vistas"},pe={key:0,class:"vista-registrar"},ge={class:"card-registro"},me={class:"form-group"},ce={class:"form-group"},be={class:"form-group"},fe={class:"form-group"},ye={class:"form-group"},Pe={class:"form-group"},Ee={class:"form-group"},Ce={class:"card-registro"},ke={class:"form-group"},Re={class:"form-group"},we=["disabled"],xe={key:0,class:"fas fa-spinner fa-spin"},Ae={key:1,class:"fas fa-download"},Ue={key:0,class:"lista-usuarios-masivo"},Se=["id","value"],Ve=["for"],Ne={class:"form-group"},Te=["disabled"],Me={key:1,class:"vista-buscar"},Be={class:"header-acciones"},$e={class:"filtros"},qe={class:"tabla-pagos"},De={key:0},je={key:1},Ie=["onClick"],Fe=["onClick"],Oe={class:"modal-editar-pago"},_e={class:"form-group"},Le={class:"form-group"},Ge={class:"form-group"},Je={class:"form-group"},he={class:"form-group"},ze={class:"modal-confirmar"},He={__name:"PagosView",setup(r){const s=d("registro"),f=l=>s.value=l,P=d([]),A=d(!1),E=d({mensaje:"",tipo:""}),y=d(""),p=d(""),U=d(!1),N=d(!1),t=d(null);ae(async()=>{await q()});async function q(){try{A.value=!0,P.value=await J.obtenerPagos()}catch(l){console.error("Error al cargar pagos:",l),g("Error al cargar pagos: "+l.message,"error")}finally{A.value=!1}}const D=()=>{p.value=y.value},h=()=>{y.value="",p.value=""},j=le(()=>{if(!p.value)return P.value;const l=p.value.toLowerCase();return P.value.filter(e=>e.nombre?.toLowerCase().includes(l)||e.rut?.toLowerCase().includes(l))}),z=l=>{t.value={...l},U.value=!0},T=()=>{U.value=!1,t.value=null},H=l=>{t.value=l,N.value=!0},M=()=>{N.value=!1,t.value=null},K=async()=>{try{const l=P.value.findIndex(e=>e.id===t.value.id);l!==-1&&(P.value[l]={...t.value}),g("Pago actualizado correctamente","exito"),T()}catch(l){console.error("Error al guardar pago:",l),g("Error al guardar pago: "+l.message,"error")}},W=async()=>{try{await J.anularPago(t.value.id),g("Pago anulado correctamente","exito"),M(),await q()}catch(l){console.error("Error al anular pago:",l),g("Error al anular pago: "+l.message,"error")}};function g(l,e){E.value={mensaje:l,tipo:e},setTimeout(()=>E.value={mensaje:"",tipo:""},3e3)}const u=d({nombre:"",rut:"",curso:"",valor_pagado:"",fecha_pago:"",grupo:"",file:null}),Q=l=>u.value.file=l.target.files[0],X=async()=>{try{g("Pago individual registrado (pendiente implementación backend)","exito"),u.value={nombre:"",rut:"",curso:"",valor_pagado:"",fecha_pago:"",grupo:"",file:null}}catch(l){console.error("Error al registrar pago:",l),g("Error al registrar pago: "+l.message,"error")}},b=d({grupo:"",curso:"",file:null}),C=d([]),k=d([]),S=d(!1),Y=l=>b.value.file=l.target.files[0],Z=async()=>{try{S.value=!0;const l=await se.listarBasic();C.value=l.map(e=>({id:e.id,nombre:e.nombre,rut:e.rut||"Sin RUT",email:e.email||"Sin email"})),g(`${C.value.length} participantes cargados`,"exito")}catch(l){console.error("Error al cargar participantes:",l),g("Error al cargar participantes: "+l.message,"error")}finally{S.value=!1}},ee=async()=>{try{g(`Pago masivo registrado para ${k.value.length} usuarios (pendiente implementación backend)`,"exito"),k.value=[],C.value=[],b.value={grupo:"",curso:"",file:null}}catch(l){console.error("Error al registrar pago masivo:",l),g("Error al registrar pago masivo: "+l.message,"error")}};return(l,e)=>(n(),v("div",de,[o("div",ve,[o("button",{onClick:e[0]||(e[0]=a=>f("registro")),class:I({active:s.value==="registro"})}," 🧾 Registro / Ingreso ",2),o("button",{onClick:e[1]||(e[1]=a=>f("historico")),class:I({active:s.value==="historico"})}," 📚 Histórico ",2)]),s.value==="registro"?(n(),v("div",pe,[o("div",ge,[e[28]||(e[28]=o("h3",null,[o("i",{class:"fas fa-user"}),w(" Registro Individual")],-1)),e[29]||(e[29]=o("p",null,"Completa el formulario para registrar el pago de un participante.",-1)),o("form",{onSubmit:F(X,["prevent"]),class:"form-registro-individual"},[o("div",me,[e[18]||(e[18]=o("label",null,"Nombre Completo",-1)),i(o("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.nombre=a),type:"text",required:"",placeholder:"Ej: Juan Pérez"},null,512),[[m,u.value.nombre]])]),o("div",ce,[e[19]||(e[19]=o("label",null,"RUT",-1)),i(o("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.rut=a),type:"text",required:"",placeholder:"Ej: 12.345.678-9"},null,512),[[m,u.value.rut]])]),o("div",be,[e[21]||(e[21]=o("label",null,"Curso",-1)),i(o("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.curso=a),required:""},[...e[20]||(e[20]=[o("option",{value:""},"Seleccione un curso",-1),o("option",{value:"Formación de Dirigentes"},"Formación de Dirigentes",-1)])],512),[[V,u.value.curso]])]),o("div",fe,[e[22]||(e[22]=o("label",null,"Valor Pagado",-1)),i(o("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.valor_pagado=a),type:"number",required:"",placeholder:"Ej: 25000"},null,512),[[m,u.value.valor_pagado,void 0,{number:!0}]])]),o("div",ye,[e[23]||(e[23]=o("label",null,"Fecha de Pago",-1)),i(o("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.fecha_pago=a),type:"date",required:""},null,512),[[m,u.value.fecha_pago]])]),o("div",Pe,[e[25]||(e[25]=o("label",null,"Grupo",-1)),i(o("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.grupo=a),required:""},[...e[24]||(e[24]=[o("option",{value:""},"Seleccione un grupo",-1),o("option",{value:"Ñuble"},"Ñuble",-1),o("option",{value:"Biobío"},"Biobío",-1)])],512),[[V,u.value.grupo]])]),o("div",Ee,[e[26]||(e[26]=o("label",null,"Comprobante (opcional)",-1)),o("input",{type:"file",onChange:Q},null,32)]),e[27]||(e[27]=o("button",{type:"submit",class:"btn btn-primario"},"Registrar Pago",-1))],32)]),o("div",Ce,[e[36]||(e[36]=o("h3",null,[o("i",{class:"fas fa-users"}),w(" Registro Masivo")],-1)),e[37]||(e[37]=o("p",null,"Seleccione grupo y curso, cargue participantes y suba comprobante grupal.",-1)),o("form",{onSubmit:F(ee,["prevent"]),class:"form-registro-masivo"},[o("div",ke,[e[31]||(e[31]=o("label",null,"Grupo",-1)),i(o("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>b.value.grupo=a),required:""},[...e[30]||(e[30]=[o("option",{value:""},"Seleccione un grupo",-1),o("option",{value:"Ñuble"},"Ñuble",-1),o("option",{value:"Biobío"},"Biobío",-1)])],512),[[V,b.value.grupo]])]),o("div",Re,[e[33]||(e[33]=o("label",null,"Curso",-1)),i(o("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>b.value.curso=a),required:""},[...e[32]||(e[32]=[o("option",{value:""},"Seleccione un curso",-1),o("option",{value:"Formación de Dirigentes"},"Formación de Dirigentes",-1)])],512),[[V,b.value.curso]])]),o("button",{type:"button",onClick:Z,class:"btn btn-secundario",disabled:!b.value.grupo||!b.value.curso||S.value},[S.value?(n(),v("i",xe)):(n(),v("i",Ae)),e[34]||(e[34]=w(" Cargar Participantes ",-1))],8,we),C.value.length>0?(n(),v("div",Ue,[o("label",null,"Participantes encontrados ("+c(C.value.length)+"):",1),(n(!0),v(O,null,_(C.value,a=>(n(),v("div",{key:a.id,class:"checkbox-item"},[i(o("input",{type:"checkbox",id:"user-"+a.id,value:a,"onUpdate:modelValue":e[10]||(e[10]=B=>k.value=B)},null,8,Se),[[te,k.value]]),o("label",{for:"user-"+a.id},c(a.nombre)+" ("+c(a.rut)+")",9,Ve)]))),128))])):R("",!0),o("div",Ne,[e[35]||(e[35]=o("label",null,"Comprobante Grupal",-1)),o("input",{type:"file",onChange:Y,required:""},null,32)]),o("button",{type:"submit",class:"btn btn-primario",disabled:k.value.length===0||!b.value.file}," Registrar Pago Masivo ("+c(k.value.length)+") ",9,Te)],32)])])):R("",!0),s.value==="historico"?(n(),v("div",Me,[o("div",Be,[e[39]||(e[39]=o("h2",null,"Histórico de Pagos",-1)),o("div",$e,[i(o("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=a=>y.value=a),placeholder:"Buscar por Nombre o RUT...",class:"input-busqueda",onKeyup:re(D,["enter"])},null,544),[[m,y.value]]),o("button",{onClick:D,class:"btn btn-primario"},[...e[38]||(e[38]=[o("i",{class:"fas fa-search"},null,-1),w(" Buscar ",-1)])]),o("button",{onClick:h,class:"btn btn-secundario"}," Limpiar ")])]),o("div",qe,[o("table",null,[e[42]||(e[42]=o("thead",null,[o("tr",null,[o("th",null,"Nombre"),o("th",null,"RUT"),o("th",null,"Email"),o("th",null,"Teléfono"),o("th",null,"Dirección"),o("th",null,"Acciones")])],-1)),o("tbody",null,[A.value?(n(),v("tr",De,[...e[40]||(e[40]=[o("td",{colspan:"6",style:{"text-align":"center"}},"Cargando pagos...",-1)])])):j.value.length===0?(n(),v("tr",je,[...e[41]||(e[41]=[o("td",{colspan:"6",style:{"text-align":"center"}},"No se encontraron pagos",-1)])])):(n(!0),v(O,{key:2},_(j.value,a=>(n(),v("tr",{key:a.id},[o("td",null,c(a.nombre),1),o("td",null,c(a.rut),1),o("td",null,c(a.email||"N/A"),1),o("td",null,c(a.telefono||"N/A"),1),o("td",null,c(a.direccion||"N/A"),1),o("td",null,[o("button",{onClick:B=>z(a),class:"btn-small btn-editar"},"Editar",8,Ie),o("button",{onClick:B=>H(a),class:"btn-small btn-anular"},"Anular",8,Fe)])]))),128))])])])])):R("",!0),U.value?(n(),$(G,{key:2,onClose:T},{default:L(()=>[o("div",Oe,[e[48]||(e[48]=o("h3",null,"Editar Pago",-1)),o("div",_e,[e[43]||(e[43]=o("label",null,"Nombre",-1)),i(o("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>t.value.nombre=a),type:"text",readonly:""},null,512),[[m,t.value.nombre]])]),o("div",Le,[e[44]||(e[44]=o("label",null,"RUT",-1)),i(o("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>t.value.rut=a),type:"text",readonly:""},null,512),[[m,t.value.rut]])]),o("div",Ge,[e[45]||(e[45]=o("label",null,"Email",-1)),i(o("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>t.value.email=a),type:"email"},null,512),[[m,t.value.email]])]),o("div",Je,[e[46]||(e[46]=o("label",null,"Teléfono",-1)),i(o("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>t.value.telefono=a),type:"text"},null,512),[[m,t.value.telefono]])]),o("div",he,[e[47]||(e[47]=o("label",null,"Dirección",-1)),i(o("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>t.value.direccion=a),type:"text"},null,512),[[m,t.value.direccion]])]),o("div",{class:"modal-actions"},[o("button",{onClick:K,class:"btn btn-primario"},"Guardar"),o("button",{onClick:T,class:"btn btn-secundario"},"Cancelar")])])]),_:1})):R("",!0),N.value?(n(),$(G,{key:3,onClose:M},{default:L(()=>[o("div",ze,[e[51]||(e[51]=o("h3",null,"Confirmar Anulación",-1)),o("p",null,[e[49]||(e[49]=w("¿Está seguro de que desea anular el pago de ",-1)),o("strong",null,c(t.value?.nombre),1),e[50]||(e[50]=w("?",-1))]),o("div",{class:"modal-actions"},[o("button",{onClick:W,class:"btn btn-danger"},"Anular"),o("button",{onClick:M,class:"btn btn-secundario"},"Cancelar")])])]),_:1})):R("",!0),E.value.mensaje?(n(),$(ne,{key:4,message:E.value.mensaje,onClose:e[17]||(e[17]=a=>E.value.mensaje="")},null,8,["message"])):R("",!0)]))}},Ze=oe(He,[["__scopeId","data-v-96617af0"]]);export{Ze as default};
