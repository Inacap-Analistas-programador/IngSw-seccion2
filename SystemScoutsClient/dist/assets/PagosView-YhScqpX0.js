import{a as C,_ as Z,r as t,o as h,c as oo,b as m,d as u,e as a,g as R,B as T,n as x,j as b,x as ao,w as d,k as E,y as eo,h as q,l as V,t as M,F as ro,f as so,m as lo}from"./index-BKYQARX_.js";import{D as no,N as to}from"./NotificationToast-CggCdyQ8.js";import{B as io}from"./BaseModal-BRvmYVR7.js";const A="pagos/pago-persona";function O(s){const n=s.persona||{},p=s.curso||{},g=[n.PER_NOMBRES,n.PER_APELPTA,n.PER_APELMAT].filter(Boolean).join(" ").trim(),f=n.PER_RUN&&n.PER_DV?`${n.PER_RUN}-${n.PER_DV}`:n.PER_RUN||"";return{id:s.PAP_ID,persona_id:s.PER_ID,curso_id:s.CUR_ID,usuario_id:s.USU_ID,valor_pagado:s.PAP_VALOR,fecha_pago:s.PAP_FECHA_HORA,observacion:s.PAP_OBSERVACION||"",nombre:g,rut:f,curso:p.CUR_DESCRIPCION||p.CUR_CODIGO||String(s.CUR_ID||""),raw:s}}const uo={async listar(s={}){const n=await C(`${A}`);return Array.isArray(n)?n.map(O):[]},async obtener(s){const n=await C(`${A}/${s}`);return O(n)},async crear(s){return C(`${A}`,{method:"POST",body:JSON.stringify(s)})},async actualizar(s,n){return C(`${A}/${s}`,{method:"PUT",body:JSON.stringify(n)})},async eliminar(s){return C(`${A}/${s}`,{method:"DELETE"})}},po={class:"pago-view"},vo={class:"navegacion-vistas"},co={key:0,class:"vista-buscar"},mo={class:"header-acciones"},go={class:"filtros"},bo={key:1,class:"vista-registrar"},fo={class:"card-registro"},Po={class:"form-group"},yo={class:"form-group"},Co={class:"form-group"},Ro={class:"form-group"},Eo={class:"form-group"},Ao={class:"form-group"},Io={class:"form-group"},Uo={class:"card-registro"},Vo={class:"form-group"},Mo={class:"form-group"},So=["disabled"],Bo={key:0,class:"fas fa-spinner fa-spin"},_o={key:1,class:"fas fa-download"},ko={key:0,class:"lista-usuarios-masivo"},wo=["id","value"],Do=["for"],No={class:"form-group"},Fo=["disabled"],To={__name:"PagosView",setup(s){const n=t([{name:"nombre",label:"Nombre",field:"nombre",sortable:!0,align:"left"},{name:"rut",label:"RUT",field:"rut",align:"left"},{name:"curso",label:"Curso",field:"curso",sortable:!0},{name:"valor_pagado",label:"Valor",field:"valor_pagado",align:"right"},{name:"fecha_pago",label:"Fecha Pago",field:"fecha_pago"},{name:"actions",label:"Acciones",field:"actions",align:"center"}]),p=t([]),g=t({mensaje:"",tipo:""}),f=t(""),I=t(""),P=t("buscar"),_=e=>{P.value=e},S=t(!1),$=t(!1),B=t(null),j=e=>{e&&(B.value={...e},S.value=!0)},k=()=>{S.value=!1},L=e=>{B.value=e,$.value=!0};h(w);async function w(){try{const e=await uo.listar();p.value=Array.isArray(e)?e:[]}catch(e){console.error("Error detallado al cargar pagos:",e),v("Error al cargar los pagos. Revisa la consola.","error"),p.value=[]}}const D=()=>{I.value=f.value},G=()=>{f.value="",I.value=""},z=oo(()=>{if(!I.value)return p.value;const e=I.value.toLowerCase();return Array.isArray(p.value)?p.value.filter(o=>o.nombre&&o.nombre.toLowerCase().includes(e)||o.rut&&o.rut.toLowerCase().includes(e)):[]});async function J(){v("Edición de pago aún no implementada con API","info"),k()}function v(e,o){g.value={mensaje:e,tipo:o},setTimeout(()=>{g.value={mensaje:"",tipo:""}},3e3)}const N=()=>({nombre:"",rut:"",curso:"",valor_pagado:null,tipo_alimentacion:"Estándar",tipo_pago:"Individual",grupo:"",fecha_pago:new Date().toISOString().split("T")[0],file:null,comprobante_url:""}),l=t(N()),H=e=>{l.value.file=e.target.files[0]},K=async()=>{if(!l.value.nombre||!l.value.rut||!l.value.curso||!l.value.valor_pagado){v("Nombre, RUT, Curso y Valor son obligatorios","error");return}v("Registro individual simulado. Integración con API pendiente.","info"),l.value=N();const e=document.getElementById("indComprobante");e&&(e.value=null),await w()},F=()=>({grupo:"",curso:"",file:null}),i=t(F()),y=t([]),c=t([]),U=t(!1),Q=e=>{i.value.file=e.target.files[0]};async function W(){U.value=!0,y.value=[],c.value=[],v("Carga de participantes simulada. Integración con API pendiente.","info"),U.value=!1}const X=async()=>{if(c.value.length===0){v("Debe seleccionar al menos un participante.","error");return}if(!i.value.file){v("Debe adjuntar un comprobante de pago.","error");return}v(`Pago masivo (simulado) para ${c.value.length} usuarios.`,"info"),i.value=F(),y.value=[],c.value=[];const e=document.getElementById("comprobanteMasivo");e&&(e.value=null)};return(e,o)=>(u(),m("div",po,[a("div",vo,[a("button",{onClick:o[0]||(o[0]=r=>_("buscar")),class:x({active:P.value==="buscar"})},[...o[13]||(o[13]=[a("i",{class:"fas fa-search"},null,-1),b(" Buscar Inscripciones ",-1)])],2),a("button",{onClick:o[1]||(o[1]=r=>_("registrar")),class:x({active:P.value==="registrar"})},[...o[14]||(o[14]=[a("i",{class:"fas fa-plus"},null,-1),b(" Registrar Pagos ",-1)])],2)]),P.value==="buscar"?(u(),m("div",co,[a("div",mo,[o[17]||(o[17]=a("h2",null,"Listado de Pagos",-1)),a("div",go,[d(a("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=r=>f.value=r),placeholder:"Buscar por Nombre o RUT...",class:"input-busqueda",onKeyup:eo(D,["enter"])},null,544),[[E,f.value]]),a("button",{onClick:D,class:"btn btn-primario"},[...o[15]||(o[15]=[a("i",{class:"fas fa-search"},null,-1),b(" Buscar",-1)])]),a("button",{onClick:G,class:"btn btn-secundario"},"Limpiar"),a("button",{onClick:o[3]||(o[3]=(...r)=>e.exportarCSV&&e.exportarCSV(...r)),class:"btn btn-secundario"},[...o[16]||(o[16]=[a("i",{class:"fas fa-file-csv"},null,-1),b(" Exportar",-1)])])])]),ao(no,{rows:z.value,columns:n.value,onEditar:j,onAnular:L},null,8,["rows","columns"])])):R("",!0),P.value==="registrar"?(u(),m("div",bo,[a("div",fo,[o[28]||(o[28]=a("h3",null,[a("i",{class:"fas fa-user"}),b(" Registro Individual")],-1)),o[29]||(o[29]=a("p",null,"Completa el formulario para un participante específico. (Pendiente conexión API)",-1)),a("form",{onSubmit:q(K,["prevent"]),class:"form-registro-individual"},[a("div",Po,[o[18]||(o[18]=a("label",{for:"indNombre"},"Nombre Completo",-1)),d(a("input",{id:"indNombre","onUpdate:modelValue":o[4]||(o[4]=r=>l.value.nombre=r),type:"text",required:"",placeholder:"Ej: Juan Pérez González"},null,512),[[E,l.value.nombre]])]),a("div",yo,[o[19]||(o[19]=a("label",{for:"indRUT"},"RUT",-1)),d(a("input",{id:"indRUT","onUpdate:modelValue":o[5]||(o[5]=r=>l.value.rut=r),type:"text",required:"",placeholder:"Ej: 12.345.678-9"},null,512),[[E,l.value.rut]])]),a("div",Co,[o[21]||(o[21]=a("label",{for:"indCurso"},"Curso",-1)),d(a("select",{id:"indCurso","onUpdate:modelValue":o[6]||(o[6]=r=>l.value.curso=r),required:""},[...o[20]||(o[20]=[a("option",{value:""},"Seleccione un curso",-1),a("option",{value:"Formación de Dirigentes"},"Formación de Dirigentes",-1)])],512),[[V,l.value.curso]])]),a("div",Ro,[o[22]||(o[22]=a("label",{for:"indValor"},"Valor Pagado",-1)),d(a("input",{id:"indValor","onUpdate:modelValue":o[7]||(o[7]=r=>l.value.valor_pagado=r),type:"number",required:"",placeholder:"Ej: 25000"},null,512),[[E,l.value.valor_pagado,void 0,{number:!0}]])]),a("div",Eo,[o[23]||(o[23]=a("label",{for:"indFecha"},"Fecha de Pago",-1)),d(a("input",{id:"indFecha","onUpdate:modelValue":o[8]||(o[8]=r=>l.value.fecha_pago=r),type:"date",required:""},null,512),[[E,l.value.fecha_pago]])]),a("div",Ao,[o[25]||(o[25]=a("label",{for:"indGrupo"},"Grupo",-1)),d(a("select",{id:"indGrupo","onUpdate:modelValue":o[9]||(o[9]=r=>l.value.grupo=r),required:""},[...o[24]||(o[24]=[a("option",{value:""},"Seleccione un grupo",-1),a("option",{value:"Ñuble"},"Ñuble",-1),a("option",{value:"Biobío"},"Biobío",-1)])],512),[[V,l.value.grupo]])]),a("div",Io,[o[26]||(o[26]=a("label",{for:"indComprobante"},"Comprobante (Opcional)",-1)),a("input",{type:"file",id:"indComprobante",onChange:H},null,32)]),o[27]||(o[27]=a("button",{type:"submit",class:"btn btn-primario"},"Registrar Pago Individual",-1))],32)]),a("div",Uo,[o[36]||(o[36]=a("h3",null,[a("i",{class:"fas fa-users"}),b(" Registro Masivo")],-1)),o[37]||(o[37]=a("p",null,"1. Filtra por Grupo/Curso. 2. Selecciona participantes. 3. Sube el comprobante. (Pendiente conexión API)",-1)),a("form",{onSubmit:q(X,["prevent"]),class:"form-registro-masivo"},[a("div",Vo,[o[31]||(o[31]=a("label",{for:"grupoMasivo"},"Grupo",-1)),d(a("select",{id:"grupoMasivo","onUpdate:modelValue":o[10]||(o[10]=r=>i.value.grupo=r),required:""},[...o[30]||(o[30]=[a("option",{value:""},"Seleccione un grupo",-1),a("option",{value:"Ñuble"},"Ñuble",-1),a("option",{value:"Biobío"},"Biobío",-1)])],512),[[V,i.value.grupo]])]),a("div",Mo,[o[33]||(o[33]=a("label",{for:"cursoMasivo"},"Curso",-1)),d(a("select",{id:"cursoMasivo","onUpdate:modelValue":o[11]||(o[11]=r=>i.value.curso=r),required:""},[...o[32]||(o[32]=[a("option",{value:""},"Seleccione un curso",-1),a("option",{value:"Formación de Dirigentes"},"Formación de Dirigentes",-1)])],512),[[V,i.value.curso]])]),a("button",{type:"button",onClick:W,disabled:!i.value.grupo||!i.value.curso||U.value,class:"btn btn-secundario"},[U.value?(u(),m("i",Bo)):(u(),m("i",_o)),o[34]||(o[34]=b(" Cargar Participantes ",-1))],8,So),y.value.length>0?(u(),m("div",ko,[a("label",null,"Participantes encontrados ("+M(y.value.length)+"):",1),(u(!0),m(ro,null,so(y.value,r=>(u(),m("div",{key:r.id,class:"checkbox-item"},[d(a("input",{type:"checkbox",id:"user-"+r.id,value:r,"onUpdate:modelValue":o[12]||(o[12]=Y=>c.value=Y)},null,8,wo),[[lo,c.value]]),a("label",{for:"user-"+r.id},M(r.nombre)+" ("+M(r.rut)+")",9,Do)]))),128))])):R("",!0),a("div",No,[o[35]||(o[35]=a("label",{for:"comprobanteMasivo"},"Comprobante Grupal",-1)),a("input",{type:"file",id:"comprobanteMasivo",onChange:Q,required:""},null,32)]),a("button",{type:"submit",class:"btn btn-primario",disabled:c.value.length===0||!i.value.file}," Registrar Pago para ("+M(c.value.length)+") Usuarios ",9,Fo)],32)])])):R("",!0),S.value?(u(),T(io,{key:2,pago:B.value,onCerrar:k,onGuardar:J},null,8,["pago"])):R("",!0),g.value.mensaje?(u(),T(to,{key:3,mensaje:g.value.mensaje,tipo:g.value.tipo},null,8,["mensaje","tipo"])):R("",!0)]))}},$o=Z(To,[["__scopeId","data-v-5bb441c6"]]);export{$o as default};
