import{_ as z,r as k,c as M,s as V,b as l,d as r,e as t,w as D,l as E,F as B,f as T,g as m,t as d,n as A,k as v,C as q,a as N,B as C,h as S,A as P,z as w}from"./index-CIq-GS8G.js";/* empty css                                                                  */import{B as R}from"./BaseButton-XI85Ug5x.js";import{B as U}from"./BaseAlert-KKmSjey8.js";import{N as L}from"./NotificationToast-CqpsuEjc.js";import{A as O}from"./AppIcons-D7cLThmm.js";/* empty css                                                                  */const Q={class:"datatable"},F={class:"datatable-search"},J={class:"datatable-wrapper"},W={class:"datatable-table"},j=["onClick"],K={key:0},G={class:"actions"},H=["onClick"],X=["onClick"],Y=["onClick"],Z=["onClick"],ee=["onClick"],te={key:0},se=["colspan"],ae={class:"datatable-pagination"},ie=["disabled"],ne=["disabled"],re={__name:"DataTable",props:{columns:{type:Array,required:!0},rows:{type:Array,required:!0},pageSize:{type:Number,default:5}},setup(s){const e=s,n=k(""),p=k(null),a=k("asc"),i=k(1),h=M(()=>{let c=[...e.rows];if(n.value){const g=n.value.toLowerCase();c=c.filter(o=>Object.values(o).some(y=>String(y).toLowerCase().includes(g)))}return p.value&&c.sort((g,o)=>{const y=g[p.value],u=o[p.value];return y<u?a.value==="asc"?-1:1:y>u?a.value==="asc"?1:-1:0}),c}),f=M(()=>Math.max(1,Math.ceil(h.value.length/e.pageSize))),b=M(()=>{const c=(i.value-1)*e.pageSize;return h.value.slice(c,c+e.pageSize)});function _(c){p.value===c?a.value=a.value==="asc"?"desc":"asc":(p.value=c,a.value="asc")}function I(){i.value>1&&i.value--}function x(){i.value<f.value&&i.value++}return V([n,h],()=>{i.value=1}),(c,g)=>(r(),l("div",Q,[t("div",F,[D(t("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=o=>n.value=o),placeholder:"Buscar..."},null,512),[[E,n.value]])]),t("div",J,[t("table",W,[t("thead",null,[t("tr",null,[(r(!0),l(B,null,T(e.columns,(o,y)=>(r(),l("th",{key:o.key||y,onClick:u=>o.sortable!==!1&&_(o.key),class:A({sortable:o.sortable!==!1})},[v(d(o.label)+" ",1),p.value===o.key?(r(),l("span",K,d(a.value==="asc"?"▲":"▼"),1)):m("",!0)],10,j))),128)),g[1]||(g[1]=t("th",null,"Acciones",-1))])]),t("tbody",null,[(r(!0),l(B,null,T(b.value,(o,y)=>(r(),l("tr",{key:o.id||y},[(r(!0),l(B,null,T(e.columns,u=>(r(),l("td",{key:u.key},d(o[u.key]),1))),128)),t("td",G,[t("button",{onClick:u=>c.$emit("view",o)},"👁 Ver",8,H),t("button",{onClick:u=>c.$emit("edit",o)},"✏ Editar",8,X),t("button",{onClick:u=>c.$emit("delete",o)},"🗑 Eliminar",8,Y),t("button",{onClick:u=>c.$emit("anular",o)},"⚠️ Anular",8,Z),t("button",{onClick:u=>c.$emit("refund",o)},"💸 Devolver",8,ee)])]))),128)),b.value.length===0?(r(),l("tr",te,[t("td",{colspan:e.columns.length+1,class:"no-data"},"No hay datos",8,se)])):m("",!0)])])]),t("div",ae,[t("button",{disabled:i.value===1,onClick:I},"◀ Anterior",8,ie),t("span",null,"Página "+d(i.value)+" de "+d(f.value),1),t("button",{disabled:i.value===f.value||f.value===0,onClick:x},"Siguiente ▶",8,ne)])]))}},oe=z(re,[["__scopeId","data-v-a13686a4"]]),ce={name:"DataCard",props:{title:{type:String,required:!0},value:{type:[String,Number],required:!0},description:{type:String,default:""}}},le=["aria-label"],de={key:0,class:"icon","aria-hidden":"true"},ue={class:"content"},pe={class:"value"},me={class:"title"},he={key:0,class:"description"};function fe(s,e,n,p,a,i){return r(),l("div",{class:"datacard",role:"region","aria-label":`Indicador: ${n.title}`,tabindex:"0"},[s.$slots.icon?(r(),l("div",de,[q(s.$slots,"icon",{},void 0)])):m("",!0),t("div",ue,[t("span",pe,d(n.value),1),t("span",me,d(n.title),1),n.description?(r(),l("p",he,d(n.description),1)):m("",!0)])],8,le)}const ve=z(ce,[["render",fe],["__scopeId","data-v-3043ebdf"]]);function ge(s){if(!s||!s.found)return null;const e=s.persona||{},n=s.curso||null;return{name:e.nombre||"Sin nombre",rut:e.rut||"",currentCourse:n?.descripcion||n?.codigo||"—",paymentStatus:s.paymentStatus||"Confirmado",acreditationStatus:s.acreditado?"Acreditado":"Pendiente",paymentConfirmed:(s.paymentStatus||"Confirmado")==="Confirmado",per_id:e.per_id,raw:s}}const $={async buscar(s){const e=await N("personas/acreditacion/manual/search",{method:"POST",body:JSON.stringify({term:s})});return ge(e)},async acreditar({rut:s,per_id:e}){const n=await N("personas/acreditacion/manual/acreditar",{method:"POST",body:JSON.stringify({rut:s,per_id:e})});return n&&n.ok===!0}},ye={name:"ManualAcreditation",components:{DataCard:ve,DataTable:oe,BaseButton:R,BaseAlert:U,NotificationToast:L,AppIcons:O},data(){return{searchTerm:"",selectedParticipant:null,acreditationSuccess:!1,isMobile:window.innerWidth<=768,paymentSuccess:!1,paymentSuccessMessage:"",acreditationSuccessMessage:""}},computed:{canAcredit(){return this.selectedParticipant&&this.selectedParticipant.paymentStatus==="Confirmado"&&this.selectedParticipant.acreditationStatus==="Pendiente"},statusMessage(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"✅ Este usuario ya fue acreditado":this.selectedParticipant.paymentStatus!=="Confirmado"?"❌ Pendiente de pago - No se puede acreditar":"✅ Listo para acreditar":""},statusMessageClass(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"status-message-success":this.selectedParticipant.paymentStatus!=="Confirmado"?"status-message-error":"status-message-info":""},paymentStatusClass(){return this.selectedParticipant?.paymentStatus==="Confirmado"?"status-confirmado":"status-pendiente"},acreditationStatusClass(){return this.selectedParticipant?.acreditationStatus==="Acreditado"?"status-acreditado":"status-pendiente"}},mounted(){window.addEventListener("resize",this.checkMobile)},beforeUnmount(){window.removeEventListener("resize",this.checkMobile)},methods:{checkMobile(){this.isMobile=window.innerWidth<=768},handleSearch(){const s=this.searchTerm.trim();if(!s){this.selectedParticipant=null;return}$.buscar(s).then(e=>{e?this.selectedParticipant=e:(this.selectedParticipant=null,this.acreditationSuccess=!1,this.paymentSuccess=!1)}).catch(e=>{console.error("Error buscando participante:",e),this.selectedParticipant=null})},acreditarParticipante(){if(!this.canAcredit||!this.selectedParticipant)return;const{rut:s,per_id:e}=this.selectedParticipant;$.acreditar({rut:s,per_id:e}).then(n=>{if(n){this.selectedParticipant.acreditationStatus="Acreditado";const p=`${this.selectedParticipant.name} acreditado correctamente`;this.acreditationSuccessMessage=p,this.acreditationSuccess=!0,setTimeout(()=>{this.acreditationSuccess=!1,this.acreditationSuccessMessage=""},3500)}else console.warn("No se pudo acreditar (respuesta no ok)")}).catch(n=>console.error("Error acreditando:",n))},handlePagar(){this.selectedParticipant.paymentStatus="Confirmado",this.selectedParticipant.paymentConfirmed=!0;const s=`✅ ${this.selectedParticipant.name} marcado como pagado. Ahora puede ser acreditado.`;console.log(s),this.paymentSuccessMessage=s,this.paymentSuccess=!0,setTimeout(()=>{this.paymentSuccess=!1,this.paymentSuccessMessage=""},3500)},showQR(){alert(`📱 Mostrando QR de ${this.selectedParticipant.name}`)}}},_e={class:"manual-acreditation"},Se={class:"search-section"},be={class:"search-box"},Ce={key:2,class:"participant-info"},ke={class:"info-grid"},Pe={class:"info-section"},Ae={class:"info-item"},Me={class:"info-item"},Be={class:"info-item"},Te={class:"info-section"},we={class:"info-item"},ze={class:"info-item"},Ne={class:"action-buttons"},$e={key:2,class:"already-acredited"};function De(s,e,n,p,a,i){const h=w("AppIcons"),f=w("BaseButton"),b=w("NotificationToast");return r(),l("div",_e,[e[18]||(e[18]=t("div",{class:"acreditation-header"},[t("h1",null,"Acreditación Manual")],-1)),t("div",Se,[t("div",be,[D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=_=>a.searchTerm=_),type:"text",placeholder:"Buscar por RUT o nombre completo...",class:"search-input",onInput:e[1]||(e[1]=(..._)=>i.handleSearch&&i.handleSearch(..._)),"aria-label":"Buscar por RUT o nombre completo"},null,544),[[E,a.searchTerm]]),S(f,{onClick:i.handleSearch,variant:"primary",size:"md"},{default:P(()=>[S(h,{name:"search",size:16,style:{"margin-right":"8px"}}),e[4]||(e[4]=v(" Buscar ",-1))]),_:1},8,["onClick"])])]),a.acreditationSuccess?(r(),C(b,{key:0,message:a.acreditationSuccessMessage,onClose:e[2]||(e[2]=_=>a.acreditationSuccess=!1)},null,8,["message"])):m("",!0),a.paymentSuccess?(r(),C(b,{key:1,message:a.paymentSuccessMessage,onClose:e[3]||(e[3]=_=>a.paymentSuccess=!1)},null,8,["message"])):m("",!0),a.selectedParticipant?(r(),l("div",Ce,[e[17]||(e[17]=t("div",{class:"status-header"},[t("h2",null,"Información del Participante")],-1)),t("div",ke,[t("div",Pe,[e[8]||(e[8]=t("h3",null,"Datos Personales",-1)),t("div",Ae,[e[5]||(e[5]=t("strong",null,"Nombre:",-1)),v(" "+d(a.selectedParticipant.name),1)]),t("div",Me,[e[6]||(e[6]=t("strong",null,"RUT:",-1)),v(" "+d(a.selectedParticipant.rut),1)]),t("div",Be,[e[7]||(e[7]=t("strong",null,"Curso:",-1)),v(" "+d(a.selectedParticipant.currentCourse),1)])]),t("div",Te,[e[11]||(e[11]=t("h3",null,"Estado",-1)),t("div",we,[e[9]||(e[9]=t("strong",null,"Pago:",-1)),t("span",{class:A(i.paymentStatusClass)},d(a.selectedParticipant.paymentStatus),3)]),t("div",ze,[e[10]||(e[10]=t("strong",null,"Acreditación:",-1)),t("span",{class:A(i.acreditationStatusClass)},d(a.selectedParticipant.acreditationStatus),3)]),i.statusMessage?(r(),l("div",{key:0,class:A(["status-message",i.statusMessageClass])},d(i.statusMessage),3)):m("",!0)])]),t("div",Ne,[i.canAcredit?(r(),C(f,{key:0,onClick:i.acreditarParticipante,variant:"primary",size:"lg",class:"btn-acreditar"},{default:P(()=>[S(h,{name:"check",size:18}),e[12]||(e[12]=v(" Acreditar Participante ",-1))]),_:1},8,["onClick"])):a.selectedParticipant.paymentConfirmed?a.selectedParticipant.acreditationStatus==="Acreditado"?(r(),l("div",$e,[S(h,{name:"check",size:18}),e[14]||(e[14]=v()),e[15]||(e[15]=t("span",null,"Usuario ya acreditado",-1))])):m("",!0):(r(),C(f,{key:1,onClick:i.handlePagar,variant:"secondary",size:"lg",class:"btn-pagar"},{default:P(()=>[S(h,{name:"credit-card",size:18}),e[13]||(e[13]=v(" Marcar como Pagado ",-1))]),_:1},8,["onClick"])),a.isMobile&&a.selectedParticipant.acreditationStatus==="Acreditado"?(r(),C(f,{key:3,onClick:i.showQR,variant:"secondary",size:"md",class:"btn-qr"},{default:P(()=>[S(h,{name:"qrcode",size:16}),e[16]||(e[16]=v(" Ver QR ",-1))]),_:1},8,["onClick"])):m("",!0)])])):m("",!0)])}const Le=z(ye,[["render",De],["__scopeId","data-v-b5e8e125"]]);export{Le as default};
