import{_ as ie,y as k,r as m,c as H,o as ue,b as g,d as R,e as o,g as w,h as r,m as b,p as v,z as de,F as K,f as Z,t as c,n as ce}from"./index-DF_ZuZfT.js";import{I as y}from"./InputBase-Bn4M4T7r.js";import{B as f}from"./BaseButton-DbILRF5R.js";/* empty css                                                                     */import{B as U}from"./BaseSelect-Dr3xFzbM.js";import{p as Ce}from"./personasService-IigZgjN-.js";const pe="http://localhost:8000/api".replace(/\/$/,"");async function C(n,t={}){const u=String(n).replace(/^\//,""),_=!/\?(.*)$/.test(u)&&!u.endsWith("/"),p=`${pe}/${u}${_?"/":""}`,S=!t.method||t.method.toUpperCase()==="GET",l={...t.headers||{}};!S&&!("Content-Type"in l)&&(l["Content-Type"]="application/json");const i=await fetch(p,{headers:l,...t});if(!i.ok){const V=await i.text();throw new Error(`${i.status} ${i.statusText}: ${V}`)}return i.status===204?null:i.json()}const z={async obtenerCursos(){const n=await C("cursos/curso");return Array.isArray(n)?n:[]},async agregarCurso(n){return C("cursos/curso",{method:"POST",body:JSON.stringify(n)})},async actualizarCurso(n,t){return C(`cursos/curso/${n}`,{method:"PUT",body:JSON.stringify(t)})},async eliminarCurso(n){return C(`cursos/curso/${n}`,{method:"DELETE"})},async obtenerFechas(){return C("cursos/fechas")},async guardarFecha(n){if(n.CUF_ID){const{CUF_ID:t,...u}=n;return C(`cursos/fechas/${t}`,{method:"PUT",body:JSON.stringify(u)})}else return C("cursos/fechas",{method:"POST",body:JSON.stringify(n)})},async obtenerCoordinadores(){return C("cursos/coordinador")},async guardarCoordinador(n){return C("cursos/coordinador",{method:"POST",body:JSON.stringify(n)})},async eliminarCoordinador(n){return C(`cursos/coordinador/${n}`,{method:"DELETE"})},async obtenerInscripciones(){return C("personas/persona_curso")},async inscribirPersona(n){return C("personas/persona_curso",{method:"POST",body:JSON.stringify(n)})},async eliminarInscripcion(n){return C(`personas/persona_curso/${n}`,{method:"DELETE"})}},me="http://localhost:8000/api".replace(/\/$/,"");async function N(n,t={}){const u=String(n).replace(/^\//,""),_=`${me}/${u}/`,p=await fetch(_,{headers:{"Content-Type":"application/json",...t.headers||{}},...t});if(!p.ok){const S=await p.text();throw new Error(`${p.status} ${p.statusText}: ${S}`)}return p.status===204?null:p.json()}const G={async obtenerCargos(){return N("mantenedores/cargo")},async obtenerTiposCurso(){return N("mantenedores/tipo_curso")},async obtenerComunas(){return N("mantenedores/comuna")},async obtenerRoles(){return N("mantenedores/rol")}},be={class:"crud-cursos container"},ve={class:"card cursos-card"},fe={class:"card-body"},ge={class:"title-row"},Re={class:"filtros"},_e={class:"filtros-left"},Se={class:"filtros-right"},Ie={class:"courses-table"},De={class:"actions-cell"},Ue={key:0},Oe={key:0,class:"pagination"},Ee={key:1,class:"create-card"},Pe={class:"form-grid"},ye={class:"form-group"},he={class:"form-group"},Te={class:"form-group"},Ae={class:"form-group"},Ne={class:"form-group"},Ve={class:"form-group"},Le={class:"form-group"},Fe={class:"form-group"},$e={class:"form-group"},Be={class:"hierarchy-section"},ke={class:"coordinador-form"},we={key:0,class:"coordinador-table"},ze={key:1,class:"no-coordinadores"},Ge={class:"actions-row"},xe={__name:"CRUDcursos",setup(n){const t=k([]),u=m([]),_=m([]),p=m([]),S=m([]),l=k({nombre:"",codigo:"",fechaInicio:"",fechaFin:"",responsable:null,tipoCurso:null,comuna:null,modalidad:null,coordinadores:[]}),i=k({persona:null,cargo:null}),V=[{value:1,label:"Presencial"},{value:2,label:"Virtual"},{value:3,label:"H칤brido"}],L=m(""),h=m([]),I=m(1),F=m(10),x=H(()=>{const s=(I.value-1)*F.value,e=s+F.value;return h.value.slice(s,e)}),T=H(()=>Math.ceil(h.value.length/F.value));function M(s){s>=1&&s<=T.value&&(I.value=s)}async function j(){try{const[s,e,a,D,P]=await Promise.all([z.obtenerCursos(),Ce.listarBasic(),G.obtenerTiposCurso(),G.obtenerComunas(),G.obtenerCargos()]);t.splice(0,t.length,...s.map(d=>({...d,responsableNombre:e.find(te=>te.id===d.PER_ID_RESPONSABLE)?.nombre||"No asignado"}))),u.value=e.map(d=>({value:d.id,label:d.nombre})),_.value=a.map(d=>({value:d.TCU_ID,label:d.TCU_DESCRIPCION})),p.value=D.map(d=>({value:d.COM_ID,label:d.COM_NOMBRE})),S.value=P.map(d=>({value:d.CAR_ID,label:d.CAR_NOMBRE})),A()}catch(s){console.warn("Backend no disponible. Usando datos de prueba:",s),u.value=[{value:1,label:"Juan P칠rez Gonz치lez"},{value:2,label:"Mar칤a Garc칤a Silva"},{value:3,label:"Carlos Rodr칤guez Mu침oz"},{value:4,label:"Ana L칩pez Fern치ndez"},{value:5,label:"Pedro Mart칤nez D칤az"}],_.value=[{value:1,label:"Formaci칩n de Dirigentes"},{value:2,label:"Capacitaci칩n T칠cnica"},{value:3,label:"Desarrollo Personal"},{value:4,label:"Liderazgo"}],p.value=[{value:1,label:"Concepci칩n"},{value:2,label:"Talcahuano"},{value:3,label:"Chiguayante"},{value:4,label:"San Pedro de la Paz"},{value:5,label:"Coronel"}],S.value=[{value:1,label:"Coordinador General"},{value:2,label:"Instructor"},{value:3,label:"Asistente"},{value:4,label:"Evaluador"}];const e=[{CURS_ID:1,CUR_DESCRIPCION:"Formaci칩n B치sica de Dirigentes",CUR_CODIGO:"FBD-2024-01",CUR_TIPO_CURSO:1,fechaInicio:"2024-11-15",fechaTermino:"2024-11-17",PER_ID_RESPONSABLE:1,responsableNombre:"Juan P칠rez Gonz치lez",CUR_ESTADO:1,habilitado:!0},{CURS_ID:2,CUR_DESCRIPCION:"Capacitaci칩n en Primeros Auxilios",CUR_CODIGO:"CPA-2024-02",CUR_TIPO_CURSO:2,fechaInicio:"2024-12-01",fechaTermino:"2024-12-03",PER_ID_RESPONSABLE:2,responsableNombre:"Mar칤a Garc칤a Silva",CUR_ESTADO:2,habilitado:!0},{CURS_ID:3,CUR_DESCRIPCION:"Liderazgo y Trabajo en Equipo",CUR_CODIGO:"LTE-2024-03",CUR_TIPO_CURSO:4,fechaInicio:"2024-10-10",fechaTermino:"2024-10-12",PER_ID_RESPONSABLE:3,responsableNombre:"Carlos Rodr칤guez Mu침oz",CUR_ESTADO:3,habilitado:!1},{CURS_ID:4,CUR_DESCRIPCION:"Desarrollo de Habilidades Sociales",CUR_CODIGO:"DHS-2024-04",CUR_TIPO_CURSO:3,fechaInicio:"2024-11-20",fechaTermino:"2024-11-22",PER_ID_RESPONSABLE:4,responsableNombre:"Ana L칩pez Fern치ndez",CUR_ESTADO:1,habilitado:!0},{CURS_ID:5,CUR_DESCRIPCION:"Gesti칩n de Proyectos Scouts",CUR_CODIGO:"GPS-2024-05",CUR_TIPO_CURSO:2,fechaInicio:"2024-09-05",fechaTermino:"2024-09-07",PER_ID_RESPONSABLE:5,responsableNombre:"Pedro Mart칤nez D칤az",CUR_ESTADO:3,habilitado:!1}];t.splice(0,t.length,...e),A()}}function A(){const s=L.value.toLowerCase().trim();if(!s){h.value=t;return}h.value=t.filter(e=>e.nombre.toLowerCase().includes(s)||e.codigo.toLowerCase().includes(s))}ue(j);const O=m(!1),E=m(!1),$=m(-1);async function Q(){if(!l.nombre||!l.codigo||!l.responsable){alert("Por favor completa nombre, c칩digo y responsable");return}const s={CUR_DESCRIPCION:l.nombre,CUR_CODIGO:l.codigo,CUR_FECHA_SOLICITUD:new Date().toISOString().split("T")[0],PER_ID_RESPONSABLE:l.responsable,TCU_ID:1,CAR_ID_RESPONSABLE:1,COM_ID_LUGAR:1,CUR_ADMINISTRA:1,CUR_COTA_CON_ALMUERZO:0,CUR_COTA_SIN_ALMUERZO:0,CUR_MODALIDAD:1,CUR_TIPO_CURSO:1,CUR_LUGAR:"Lugar de ejemplo",CUR_ESTADO:1};try{if(E.value){const e=t[$.value].CURS_ID;await z.actualizarCurso(e,s)}else await z.agregarCurso(s);await j(),q()}catch(e){console.error("Error al guardar el curso:",e),alert("Hubo un error al guardar el curso. Revisa la consola para m치s detalles.")}}function W(s){const e=t[s];l.nombre=e.CUR_DESCRIPCION,l.codigo=e.CUR_CODIGO,e.CUR_FECHA_SOLICITUD?l.fechaInicio=new Date(e.CUR_FECHA_SOLICITUD).toISOString().split("T")[0]:l.fechaInicio="",l.fechaFin="",l.responsable=e.PER_ID_RESPONSABLE,l.jerarquias=[],E.value=!0,$.value=s,O.value=!0}function X(s){t[s].habilitado=!t[s].habilitado}function Y(){q()}function q(){l.nombre="",l.codigo="",l.fechaInicio="",l.fechaFin="",l.responsable=null,l.tipoCurso=null,l.comuna=null,l.modalidad=null,l.coordinadores=[],O.value=!1,E.value=!1,$.value=-1}function ee(s,e){return!s&&!e?"-":s&&e?`${B(s)} - ${B(e)}`:B(s||e)}function B(s){return s?new Date(s).toLocaleDateString("es-CL",{day:"2-digit",month:"short",year:"numeric"}):""}function oe(s){const e=_.value.find(a=>a.value===s);return e?e.label:"Sin tipo"}function J(s){return{1:{text:"Activo",class:"badge-success"},2:{text:"Pendiente",class:"badge-warning"},3:{text:"Finalizado",class:"badge-secondary"},4:{text:"Cancelado",class:"badge-danger"}}[s]||{text:"Desconocido",class:"badge-info"}}function ae(s){console.log("Gestionar participantes del curso:",s),alert("Funcionalidad en desarrollo")}function le(){if(!i.persona||!i.cargo){alert("Selecciona persona y cargo");return}l.coordinadores.push({PER_ID:i.persona,CAR_ID:i.cargo}),i.persona=null,i.cargo=null}function se(s){l.coordinadores.splice(s,1)}function ne(s){const e=u.value.find(a=>a.value===s);return e?e.label:"Desconocido"}function re(s){const e=S.value.find(a=>a.value===s);return e?e.label:"Desconocido"}return(s,e)=>(R(),g("div",be,[e[38]||(e[38]=o("header",{class:"page-header"},[o("h3",null,"Gesti칩n de Cursos")],-1)),o("section",ve,[o("div",fe,[o("div",ge,[e[16]||(e[16]=o("h4",null,"Gesti칩n de Cursos",-1)),r(f,{class:"btn-success",onClick:e[0]||(e[0]=a=>O.value=!O.value)},{default:b(()=>[...e[15]||(e[15]=[v("+ Nuevo Curso",-1)])]),_:1})]),o("div",Re,[o("div",_e,[r(y,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=a=>L.value=a),placeholder:"Buscar por nombre o c칩digo...",onKeydown:de(A,["enter"])},null,8,["modelValue"])]),o("div",Se,[r(f,{class:"btn-search",variant:"primary",onClick:A},{default:b(()=>[...e[17]||(e[17]=[v("游댍 Buscar",-1)])]),_:1})])]),o("table",Ie,[e[21]||(e[21]=o("thead",null,[o("tr",null,[o("th",null,"Nombre del Curso"),o("th",null,"C칩digo"),o("th",null,"Tipo"),o("th",null,"Fechas del Curso"),o("th",null,"Responsable"),o("th",null,"Estado"),o("th",null,"Acciones")])],-1)),o("tbody",null,[(R(!0),g(K,null,Z(x.value,(a,D)=>(R(),g("tr",{key:a.CURS_ID},[o("td",null,c(a.CUR_DESCRIPCION),1),o("td",null,c(a.CUR_CODIGO),1),o("td",null,c(oe(a.CUR_TIPO_CURSO)),1),o("td",null,c(ee(a.fechaInicio,a.fechaTermino)),1),o("td",null,c(a.responsableNombre),1),o("td",null,[o("span",{class:ce(["badge",J(a.CUR_ESTADO).class])},c(J(a.CUR_ESTADO).text),3)]),o("td",De,[r(f,{class:"btn-info",small:"",onClick:P=>ae(a.CURS_ID)},{default:b(()=>[...e[18]||(e[18]=[v("Participantes",-1)])]),_:1},8,["onClick"]),r(f,{class:"btn-warning",small:"",onClick:P=>W(D)},{default:b(()=>[...e[19]||(e[19]=[v("Editar",-1)])]),_:1},8,["onClick"]),r(f,{class:"btn-secondary",small:"",onClick:P=>X(D)},{default:b(()=>[v(c(a.habilitado?"Deshabilitar":"Habilitar"),1)]),_:2},1032,["onClick"])])]))),128)),x.value.length===0?(R(),g("tr",Ue,[...e[20]||(e[20]=[o("td",{colspan:"7",class:"no-results"},"No se encontraron cursos.",-1)])])):w("",!0)])]),T.value>1?(R(),g("div",Oe,[r(f,{onClick:e[2]||(e[2]=a=>M(I.value-1)),disabled:I.value===1},{default:b(()=>[...e[22]||(e[22]=[v("Anterior",-1)])]),_:1},8,["disabled"]),o("span",null,"P치gina "+c(I.value)+" de "+c(T.value),1),r(f,{onClick:e[3]||(e[3]=a=>M(I.value+1)),disabled:I.value===T.value},{default:b(()=>[...e[23]||(e[23]=[v("Siguiente",-1)])]),_:1},8,["disabled"])])):w("",!0),O.value?(R(),g("div",Ee,[o("h5",null,c(E.value?"Editar Curso":"Crear Nuevo Curso"),1),o("div",Pe,[o("div",ye,[e[24]||(e[24]=o("label",null,"Nombre del Curso:",-1)),r(y,{type:"text",placeholder:"Ej: Formaci칩n de Dirigentes",modelValue:l.nombre,"onUpdate:modelValue":e[4]||(e[4]=a=>l.nombre=a)},null,8,["modelValue"])]),o("div",he,[e[25]||(e[25]=o("label",null,"C칩digo:",-1)),r(y,{type:"text",placeholder:"Ej: FD-001",modelValue:l.codigo,"onUpdate:modelValue":e[5]||(e[5]=a=>l.codigo=a)},null,8,["modelValue"])]),o("div",Te,[e[26]||(e[26]=o("label",null,"Fecha Inicio:",-1)),r(y,{type:"date",modelValue:l.fechaInicio,"onUpdate:modelValue":e[6]||(e[6]=a=>l.fechaInicio=a)},null,8,["modelValue"])]),o("div",Ae,[e[27]||(e[27]=o("label",null,"Fecha Fin:",-1)),r(y,{type:"date",modelValue:l.fechaFin,"onUpdate:modelValue":e[7]||(e[7]=a=>l.fechaFin=a)},null,8,["modelValue"])]),o("div",Ne,[e[28]||(e[28]=o("label",null,"Responsable:",-1)),r(U,{modelValue:l.responsable,"onUpdate:modelValue":e[8]||(e[8]=a=>l.responsable=a),options:u.value,placeholder:"Seleccione un responsable"},null,8,["modelValue","options"])]),o("div",Ve,[e[29]||(e[29]=o("label",null,"Tipo de Curso:",-1)),r(U,{modelValue:l.tipoCurso,"onUpdate:modelValue":e[9]||(e[9]=a=>l.tipoCurso=a),options:_.value,placeholder:"Seleccione un tipo"},null,8,["modelValue","options"])]),o("div",Le,[e[30]||(e[30]=o("label",null,"Comuna (Lugar):",-1)),r(U,{modelValue:l.comuna,"onUpdate:modelValue":e[10]||(e[10]=a=>l.comuna=a),options:p.value,placeholder:"Seleccione una comuna"},null,8,["modelValue","options"])]),o("div",Fe,[e[31]||(e[31]=o("label",null,"Modalidad:",-1)),r(U,{modelValue:l.modalidad,"onUpdate:modelValue":e[11]||(e[11]=a=>l.modalidad=a),options:V,placeholder:"Seleccione modalidad"},null,8,["modelValue"])])]),o("div",$e,[e[32]||(e[32]=o("label",null,"Responsable:",-1)),r(U,{modelValue:l.responsable,"onUpdate:modelValue":e[12]||(e[12]=a=>l.responsable=a),options:u.value,placeholder:"Selecciona un responsable"},null,8,["modelValue","options"])]),o("div",Be,[e[36]||(e[36]=o("label",null,"Equipo del Curso (Jerarqu칤as):",-1)),o("div",ke,[r(U,{modelValue:i.persona,"onUpdate:modelValue":e[13]||(e[13]=a=>i.persona=a),options:u.value,placeholder:"Seleccionar Persona",class:"select-persona"},null,8,["modelValue","options"]),r(U,{modelValue:i.cargo,"onUpdate:modelValue":e[14]||(e[14]=a=>i.cargo=a),options:S.value,placeholder:"Seleccionar Cargo",class:"select-cargo"},null,8,["modelValue","options"]),r(f,{onClick:le,class:"btn-success"},{default:b(()=>[...e[33]||(e[33]=[v("A침adir al Equipo",-1)])]),_:1})]),l.coordinadores.length>0?(R(),g("table",we,[e[35]||(e[35]=o("thead",null,[o("tr",null,[o("th",null,"Nombre"),o("th",null,"Cargo"),o("th",null,"Acci칩n")])],-1)),o("tbody",null,[(R(!0),g(K,null,Z(l.coordinadores,(a,D)=>(R(),g("tr",{key:D},[o("td",null,c(ne(a.PER_ID)),1),o("td",null,c(re(a.CAR_ID)),1),o("td",null,[r(f,{onClick:P=>se(D),class:"btn-danger",small:""},{default:b(()=>[...e[34]||(e[34]=[v("Eliminar",-1)])]),_:1},8,["onClick"])])]))),128))])])):(R(),g("p",ze,"A칰n no se han a침adido miembros al equipo."))]),o("div",Ge,[r(f,{class:"btn-primary",onClick:Q},{default:b(()=>[v(c(E.value?"Actualizar":"Crear Curso"),1)]),_:1}),r(f,{class:"btn-secondary",onClick:Y},{default:b(()=>[...e[37]||(e[37]=[v("Cancelar",-1)])]),_:1})])])):w("",!0)])])]))}},Ze=ie(xe,[["__scopeId","data-v-4141163a"]]);export{Ze as default};
