import{_ as T,b as d,d as r,g as m,e as t,A as L,t as l,r as P,c as M,C as q,w as x,l as D,F as w,f as z,n as A,k as v,a as N,z as C,h as S,y as k,x as B}from"./index-BPA1--Y9.js";import{B as O}from"./BaseButton-DZplU3gx.js";import{B as R}from"./BaseAlert-FEMMck7S.js";import{N as V}from"./NotificationToast-DncncPU9.js";import{A as U}from"./AppIcons-CRrJo_Hq.js";const F={name:"DataCard",props:{title:{type:String,required:!0},value:{type:[String,Number],required:!0},description:{type:String,default:""}}},Q=["aria-label"],J={key:0,class:"icon","aria-hidden":"true"},K={class:"content"},W={class:"value"},j={class:"title"},G={key:0,class:"description"};function H(s,e,a,u,i,n){return r(),d("div",{class:"datacard",role:"region","aria-label":`Indicador: ${a.title}`,tabindex:"0"},[s.$slots.icon?(r(),d("div",J,[L(s.$slots,"icon",{},void 0)])):m("",!0),t("div",K,[t("span",W,l(a.value),1),t("span",j,l(a.title),1),a.description?(r(),d("p",G,l(a.description),1)):m("",!0)])],8,Q)}const X=T(F,[["render",H],["__scopeId","data-v-3043ebdf"]]),Y={class:"datatable"},Z={class:"datatable-search"},ee={class:"datatable-wrapper"},te={class:"datatable-table"},ae=["onClick"],se={key:0},ie={class:"actions"},ne=["onClick"],re=["onClick"],oe=["onClick"],ce=["onClick"],de=["onClick"],le={key:0},ue=["colspan"],pe={class:"datatable-pagination"},me=["disabled"],fe=["disabled"],he={__name:"DataTable",props:{columns:{type:Array,required:!0},rows:{type:Array,required:!0},pageSize:{type:Number,default:5}},setup(s){const e=s,a=P(""),u=P(null),i=P("asc"),n=P(1),f=M(()=>{let c=[...e.rows];if(a.value){const g=a.value.toLowerCase();c=c.filter(o=>Object.values(o).some(_=>String(_).toLowerCase().includes(g)))}return u.value&&c.sort((g,o)=>{const _=g[u.value],p=o[u.value];return _<p?i.value==="asc"?-1:1:_>p?i.value==="asc"?1:-1:0}),c}),h=M(()=>Math.max(1,Math.ceil(f.value.length/e.pageSize))),b=M(()=>{const c=(n.value-1)*e.pageSize;return f.value.slice(c,c+e.pageSize)});function y(c){u.value===c?i.value=i.value==="asc"?"desc":"asc":(u.value=c,i.value="asc")}function E(){n.value>1&&n.value--}function I(){n.value<h.value&&n.value++}return q([a,f],()=>{n.value=1}),(c,g)=>(r(),d("div",Y,[t("div",Z,[x(t("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=o=>a.value=o),placeholder:"Buscar..."},null,512),[[D,a.value]])]),t("div",ee,[t("table",te,[t("thead",null,[t("tr",null,[(r(!0),d(w,null,z(e.columns,(o,_)=>(r(),d("th",{key:o.key||_,onClick:p=>o.sortable!==!1&&y(o.key),class:A({sortable:o.sortable!==!1})},[v(l(o.label)+" ",1),u.value===o.key?(r(),d("span",se,l(i.value==="asc"?"‚ñ≤":"‚ñº"),1)):m("",!0)],10,ae))),128)),g[1]||(g[1]=t("th",null,"Acciones",-1))])]),t("tbody",null,[(r(!0),d(w,null,z(b.value,(o,_)=>(r(),d("tr",{key:o.id||_},[(r(!0),d(w,null,z(e.columns,p=>(r(),d("td",{key:p.key},l(o[p.key]),1))),128)),t("td",ie,[t("button",{onClick:p=>c.$emit("view",o)},"üëÅ Ver",8,ne),t("button",{onClick:p=>c.$emit("edit",o)},"‚úè Editar",8,re),t("button",{onClick:p=>c.$emit("delete",o)},"üóë Eliminar",8,oe),t("button",{onClick:p=>c.$emit("anular",o)},"‚ö†Ô∏è Anular",8,ce),t("button",{onClick:p=>c.$emit("refund",o)},"üí∏ Devolver",8,de)])]))),128)),b.value.length===0?(r(),d("tr",le,[t("td",{colspan:e.columns.length+1,class:"no-data"},"No hay datos",8,ue)])):m("",!0)])])]),t("div",pe,[t("button",{disabled:n.value===1,onClick:E},"‚óÄ Anterior",8,me),t("span",null,"P√°gina "+l(n.value)+" de "+l(h.value),1),t("button",{disabled:n.value===h.value||h.value===0,onClick:I},"Siguiente ‚ñ∂",8,fe)])]))}},ve=T(he,[["__scopeId","data-v-a13686a4"]]),ge=[{nombre:"Juan P√©rez",rut:"12345678-9",curso:"Curso B√°sico de Formaci√≥n",acreditado:!1,pagado:!0,per_id:1},{nombre:"Mar√≠a Gonz√°lez",rut:"98765432-1",curso:"T√©cnicas de Campamento",acreditado:!0,pagado:!0,per_id:2},{nombre:"Pedro Silva",rut:"11223344-5",curso:"Liderazgo Scout",acreditado:!1,pagado:!1,per_id:3},{nombre:"Ana Mart√≠nez",rut:"55667788-9",curso:"Curso B√°sico de Formaci√≥n",acreditado:!1,pagado:!0,per_id:4}];function _e(s){if(!s||!s.found)return null;const e=s.persona||{},a=s.curso||null;return{name:e.nombre||"Sin nombre",rut:e.rut||"",currentCourse:a?.descripcion||a?.codigo||"‚Äî",paymentStatus:s.paymentStatus||"Confirmado",acreditationStatus:s.acreditado?"Acreditado":"Pendiente",paymentConfirmed:(s.paymentStatus||"Confirmado")==="Confirmado",per_id:e.per_id,raw:s}}const $={async buscar(s){try{const e=await N("personas/acreditacion/manual/search",{method:"POST",body:JSON.stringify({term:s})});return _e(e)}catch(e){console.warn("B√∫squeda falla, usando mock:",e);const a=ge.find(u=>u.rut.includes(s)||u.nombre.toLowerCase().includes(s.toLowerCase()));return a?{name:a.nombre,rut:a.rut,currentCourse:a.curso,paymentStatus:a.pagado?"Confirmado":"Pendiente",acreditationStatus:a.acreditado?"Acreditado":"Pendiente",paymentConfirmed:a.pagado,per_id:a.per_id,raw:a}:null}},async acreditar({rut:s,per_id:e}){try{const a=await N("personas/acreditacion/manual/acreditar",{method:"POST",body:JSON.stringify({rut:s,per_id:e})});return a&&a.ok===!0}catch(a){return console.warn("Acreditaci√≥n falla, simulando √©xito:",a),!0}}},ye={name:"ManualAcreditation",components:{DataCard:X,DataTable:ve,BaseButton:O,BaseAlert:R,NotificationToast:V,AppIcons:U},data(){return{searchTerm:"",selectedParticipant:null,acreditationSuccess:!1,isMobile:window.innerWidth<=768,paymentSuccess:!1,paymentSuccessMessage:"",acreditationSuccessMessage:""}},computed:{canAcredit(){return this.selectedParticipant&&this.selectedParticipant.paymentStatus==="Confirmado"&&this.selectedParticipant.acreditationStatus==="Pendiente"},statusMessage(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"‚úÖ Este usuario ya fue acreditado":this.selectedParticipant.paymentStatus!=="Confirmado"?"‚ùå Pendiente de pago - No se puede acreditar":"‚úÖ Listo para acreditar":""},statusMessageClass(){return this.selectedParticipant?this.selectedParticipant.acreditationStatus==="Acreditado"?"status-message-success":this.selectedParticipant.paymentStatus!=="Confirmado"?"status-message-error":"status-message-info":""},paymentStatusClass(){return this.selectedParticipant?.paymentStatus==="Confirmado"?"status-confirmado":"status-pendiente"},acreditationStatusClass(){return this.selectedParticipant?.acreditationStatus==="Acreditado"?"status-acreditado":"status-pendiente"}},mounted(){window.addEventListener("resize",this.checkMobile)},beforeUnmount(){window.removeEventListener("resize",this.checkMobile)},methods:{checkMobile(){this.isMobile=window.innerWidth<=768},handleSearch(){const s=this.searchTerm.trim();if(!s){this.selectedParticipant=null;return}$.buscar(s).then(e=>{e?this.selectedParticipant=e:(this.selectedParticipant=null,this.acreditationSuccess=!1,this.paymentSuccess=!1)}).catch(e=>{console.error("Error buscando participante:",e),this.selectedParticipant=null})},acreditarParticipante(){if(!this.canAcredit||!this.selectedParticipant)return;const{rut:s,per_id:e}=this.selectedParticipant;$.acreditar({rut:s,per_id:e}).then(a=>{if(a){this.selectedParticipant.acreditationStatus="Acreditado";const u=`${this.selectedParticipant.name} acreditado correctamente`;this.acreditationSuccessMessage=u,this.acreditationSuccess=!0,setTimeout(()=>{this.acreditationSuccess=!1,this.acreditationSuccessMessage=""},3500)}else console.warn("No se pudo acreditar (respuesta no ok)")}).catch(a=>console.error("Error acreditando:",a))},handlePagar(){this.selectedParticipant.paymentStatus="Confirmado",this.selectedParticipant.paymentConfirmed=!0;const s=`‚úÖ ${this.selectedParticipant.name} marcado como pagado. Ahora puede ser acreditado.`;console.log(s),this.paymentSuccessMessage=s,this.paymentSuccess=!0,setTimeout(()=>{this.paymentSuccess=!1,this.paymentSuccessMessage=""},3500)},showQR(){alert(`üì± Mostrando QR de ${this.selectedParticipant.name}`)}}},Se={class:"manual-acreditation"},be={class:"search-section"},Ce={class:"search-box"},Pe={key:2,class:"participant-info"},ke={class:"info-grid"},Ae={class:"info-section"},Me={class:"info-item"},we={class:"info-item"},ze={class:"info-item"},Be={class:"info-section"},Te={class:"info-item"},Ne={class:"info-item"},$e={class:"action-buttons"},xe={key:2,class:"already-acredited"};function De(s,e,a,u,i,n){const f=B("AppIcons"),h=B("BaseButton"),b=B("NotificationToast");return r(),d("div",Se,[e[18]||(e[18]=t("div",{class:"acreditation-header"},[t("h1",null,"Acreditaci√≥n Manual")],-1)),t("div",be,[t("div",Ce,[x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=y=>i.searchTerm=y),type:"text",placeholder:"Buscar por RUT o nombre completo...",class:"search-input",onInput:e[1]||(e[1]=(...y)=>n.handleSearch&&n.handleSearch(...y)),"aria-label":"Buscar por RUT o nombre completo"},null,544),[[D,i.searchTerm]]),S(h,{onClick:n.handleSearch,variant:"primary",size:"md"},{default:k(()=>[S(f,{name:"search",size:16,style:{"margin-right":"8px"}}),e[4]||(e[4]=v(" Buscar ",-1))]),_:1},8,["onClick"])])]),i.acreditationSuccess?(r(),C(b,{key:0,message:i.acreditationSuccessMessage,onClose:e[2]||(e[2]=y=>i.acreditationSuccess=!1)},null,8,["message"])):m("",!0),i.paymentSuccess?(r(),C(b,{key:1,message:i.paymentSuccessMessage,onClose:e[3]||(e[3]=y=>i.paymentSuccess=!1)},null,8,["message"])):m("",!0),i.selectedParticipant?(r(),d("div",Pe,[e[17]||(e[17]=t("div",{class:"status-header"},[t("h2",null,"Informaci√≥n del Participante")],-1)),t("div",ke,[t("div",Ae,[e[8]||(e[8]=t("h3",null,"Datos Personales",-1)),t("div",Me,[e[5]||(e[5]=t("strong",null,"Nombre:",-1)),v(" "+l(i.selectedParticipant.name),1)]),t("div",we,[e[6]||(e[6]=t("strong",null,"RUT:",-1)),v(" "+l(i.selectedParticipant.rut),1)]),t("div",ze,[e[7]||(e[7]=t("strong",null,"Curso:",-1)),v(" "+l(i.selectedParticipant.currentCourse),1)])]),t("div",Be,[e[11]||(e[11]=t("h3",null,"Estado",-1)),t("div",Te,[e[9]||(e[9]=t("strong",null,"Pago:",-1)),t("span",{class:A(n.paymentStatusClass)},l(i.selectedParticipant.paymentStatus),3)]),t("div",Ne,[e[10]||(e[10]=t("strong",null,"Acreditaci√≥n:",-1)),t("span",{class:A(n.acreditationStatusClass)},l(i.selectedParticipant.acreditationStatus),3)]),n.statusMessage?(r(),d("div",{key:0,class:A(["status-message",n.statusMessageClass])},l(n.statusMessage),3)):m("",!0)])]),t("div",$e,[n.canAcredit?(r(),C(h,{key:0,onClick:n.acreditarParticipante,variant:"primary",size:"lg",class:"btn-acreditar"},{default:k(()=>[S(f,{name:"check",size:18}),e[12]||(e[12]=v(" Acreditar Participante ",-1))]),_:1},8,["onClick"])):i.selectedParticipant.paymentConfirmed?i.selectedParticipant.acreditationStatus==="Acreditado"?(r(),d("div",xe,[S(f,{name:"check",size:18}),e[14]||(e[14]=v()),e[15]||(e[15]=t("span",null,"Usuario ya acreditado",-1))])):m("",!0):(r(),C(h,{key:1,onClick:n.handlePagar,variant:"secondary",size:"lg",class:"btn-pagar"},{default:k(()=>[S(f,{name:"credit-card",size:18}),e[13]||(e[13]=v(" Marcar como Pagado ",-1))]),_:1},8,["onClick"])),i.isMobile&&i.selectedParticipant.acreditationStatus==="Acreditado"?(r(),C(h,{key:3,onClick:n.showQR,variant:"secondary",size:"md",class:"btn-qr"},{default:k(()=>[S(f,{name:"qrcode",size:16}),e[16]||(e[16]=v(" Ver QR ",-1))]),_:1},8,["onClick"])):m("",!0)])])):m("",!0)])}const Re=T(ye,[["render",De],["__scopeId","data-v-b5e8e125"]]);export{Re as default};
