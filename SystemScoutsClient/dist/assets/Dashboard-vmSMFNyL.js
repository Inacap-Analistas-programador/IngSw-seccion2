import{_ as Q,r as p,c as f,o as W,a as B,b as n,d as r,e as s,F as A,f as I,g as D,w as X,v as Y,n as l,h as g,t as a,i as ss,u as ts,j as $}from"./index-BpDPJ6tp.js";import{p as es}from"./personasService-p-Mp8mfR.js";import{A as y}from"./AppIcons-BmakeQ3O.js";const os={class:"layout-root"},as={class:"toast-container"},is={class:"alert-toast-icon"},ns={class:"alert-toast-content"},rs={class:"alert-toast-title"},ls={class:"alert-toast-message"},ds=["onClick"],cs={class:"layout-content"},us={class:"main"},vs={class:"control-panel"},ps={class:"tab-content"},ms={class:"semaforo-grid"},hs={class:"semaforo-data"},_s={class:"semaforo-value"},fs={class:"semaforo-data"},Cs={class:"semaforo-value"},gs={class:"semaforo-data"},ys={class:"semaforo-value"},bs={class:"modal-header"},ws={class:"modal-body"},ks={class:"cursos-list"},xs=["onClick"],Ps={class:"curso-item-info"},As={class:"curso-item-title"},Is={class:"curso-item-details"},Ms={class:"data-section"},Ns={class:"directivos-grid"},Ss={class:"directivo-header"},Ds={class:"directivo-title-group"},Rs={class:"directivo-stats"},Es={class:"directivo-stat"},Us={class:"directivo-stat-value"},zs={class:"directivo-stat"},Bs={class:"directivo-stat-value"},$s={class:"directivo-bar"},Os={key:0,class:"directivo-message"},Ts={key:1,class:"directivo-message warning"},Ls={key:2,class:"directivo-message success"},Fs={class:"data-section"},js={class:"table-container"},Vs={class:"data-table"},Hs={style:{width:"25%"}},Gs={class:"curso-name-wrapper"},qs={class:"curso-name"},Zs={class:"text-center",style:{width:"auto"}},Js={class:"inscritos-badge"},Ks={class:"text-right",style:{width:"auto"}},Qs={class:"amount paid"},Ws={class:"text-right",style:{width:"auto"}},Xs={class:"amount expected"},Ys={class:"text-right",style:{width:"auto"}},st={class:"amount pending"},tt={class:"text-center",style:{width:"auto"}},et={class:"progress-cell"},ot={class:"mini-progress-bar"},at={class:"progress-percent"},it={class:"text-center",style:{width:"10%"}},nt={key:0,class:"empty-row"},rt={__name:"Dashboard",setup(lt){const R=ts(),O=p("resumen"),b=p(!1),k=p([]),M=p(0),m=f(()=>[...k.value].sort((o,t)=>(o.title||"").localeCompare(t.title||"","es",{sensitivity:"base"})));function T(o,t){return o==="full"?`El curso "${t}" ha alcanzado su capacidad máxima.`:o==="near"?`El curso "${t}" está cerca de completar su capacidad.`:o==="bajo"?`El curso "${t}" tiene baja inscripción.`:""}function C(o){if(o==="inscritos"){const t=v.value.totalInscritos/(m.value.reduce((e,i)=>e+i.capacidad,0)||1);return t>=.85?"ok":t>=.5?"near":"full"}if(o==="pagos"){const t=v.value.ingresosPagados/(v.value.ingresosProyectados||1);return t>=.8?"ok":t>=.5?"near":"full"}return o==="cursos"?v.value.totalCursos>=3?"ok":"near":o==="alertas"?x.value.length===0?"ok":x.value.length<=2?"near":"full":"ok"}const L=p({}),F=p({}),E=p({1:4,2:7,3:0,4:1}),U=f(()=>m.value.map(o=>{const t=Number(o.valor||0),e=Math.max(0,Math.round((Number(o.inscritos)||0)*t)),i=L.value[o.id]||0,d=(F.value[o.id]||0)*t,c=i||d||0,u=Math.max(0,e-c),K=e>0?Math.max(0,Math.min(100,Math.round(c/e*100))):0;return{id:o.id,title:o.title,inscritos:o.inscritos,expected:e,paid:c,unpaid:u,percentPaid:K}})),z=f(()=>U.value.filter(o=>o.unpaid>0).sort((o,t)=>t.unpaid-o.unpaid));function N(o){try{return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(Number(o||0))}catch{return`$${Number(o||0).toLocaleString("es-CL")}`}}const v=f(()=>{const o=m.value.length,t=Number(M.value||0),e=m.value.reduce((c,u)=>c+(Number(u.inscritos)||0)*(Number(u.valor)||0),0),i=U.value.reduce((c,u)=>c+(Number(u.paid)||0),0),d=Math.max(0,e-i);return{totalCursos:o,totalInscritos:t,ingresosProyectados:e,ingresosPagados:i,ingresosPendientes:d}});f(()=>v.value.ingresosProyectados===0?0:Math.round(v.value.ingresosPagados/v.value.ingresosProyectados*100));const x=f(()=>{const o=[];return m.value.forEach(t=>{const e=Number(t.capacidad)||0,i=Number(t.inscritos)||0;if(!e)return;const d=i/e;d>=1?o.push({id:`${t.id}-full`,title:t.title,type:"full",label:"Completo"}):d>=.85?o.push({id:`${t.id}-near`,title:t.title,type:"near",label:"Casi lleno"}):d<=.25&&o.push({id:`${t.id}-bajo`,title:t.title,type:"bajo",label:"Baja inscripción"})}),o.slice(0,6)}),S=p([]),j=f(()=>x.value.filter(o=>!S.value.includes(o.id)));function V(o){S.value.push(o)}function H(){R.push("/gestionpersonas")}function G(o){R.push({path:"/cursos-capacitaciones",query:{edit:o}})}function q(){S.value=[]}function h(o){return E.value[o.id]!==void 0?E.value[o.id]:0}function _(o){return Math.max(2,Math.ceil(o.inscritos/10))}function Z(o){const t=h(o),e=_(o);return Math.min(100,t/e*100)}function w(o){const t=h(o),e=_(o);return t>=e?"ok":t>=e*.5?"near":"danger"}function P(o){const t=o.expected>0?o.paid/o.expected*100:0;return t>=80?"ok":t>=50?"near":"full"}function J(o){const t=P(o);return t==="ok"?"Al día":t==="near"?"Pendiente":"Crítico"}return W(()=>{(async()=>{try{const o=await B("cursos/cursos");Array.isArray(o)&&(k.value=o.map(t=>({id:t.CURS_ID||t.CUR_ID||t.id||t.ID,title:t.CUR_DESCRIPCION||t.CUR_CODIGO||t.CURS_ID||"Curso",inscritos:parseInt(t._inscritos_count||t.INSCRITOS||0)||0,capacidad:parseInt(t.CUR_COTA_CON_ALMUERZO||t.CUR_COTA_SIN_ALMUERZO||t.CUR_CANT_PARTICIPANTE||t.CAPACIDAD||0)||0,valor:0,estado:t.CUR_ESTADO||t.ESTADO||"Vigente"})))}catch(o){console.warn("Cursos no disponibles:",o)}try{const o=await B("cursos/cuotas");if(Array.isArray(o)){const t={};o.forEach(e=>{const i=e.CUR_ID||e.curso_id||e.cur_id||null;if(!i)return;const d=Number(e.CUU_VALOR||e.valor||0),c=e.CUU_FECHA||"",u=t[i];(!u||d>u.val||c&&u.date&&c>u.date)&&(t[i]={val:d,date:c})}),k.value=k.value.map(e=>({...e,valor:t[e.id]?.val||e.valor||0}))}}catch(o){console.warn("Cuotas no disponibles:",o)}try{const o=await es.listarBasic();M.value=Array.isArray(o)?o.length:0}catch(o){console.warn("Personas no disponibles:",o),M.value=0}})()}),(o,t)=>(r(),n("div",os,[s("div",as,[(r(!0),n(A,null,I(j.value,(e,i)=>(r(),n("div",{key:e.id,class:"alert-toast"},[s("div",is,[g(y,{name:"alert-circle",size:20})]),s("div",ns,[s("div",rs,a(e.title),1),s("div",ls,a(T(e.type,e.title)),1)]),s("button",{class:"alert-toast-close",onClick:d=>V(e.id)},[g(y,{name:"x",size:16})],8,ds)]))),128))]),s("div",cs,[s("main",us,[s("div",vs,[t[19]||(t[19]=s("header",{class:"control-header"},[s("h1",null,"Centro de Control"),s("p",{class:"control-subtitle"},"Sistema de Gestión de Cursos Scout")],-1)),D("",!0),X(s("div",ps,[s("div",ms,[s("div",{class:l(["semaforo-card",C("inscritos")]),onClick:H},[g(y,{name:"users",size:32,class:"semaforo-icon"}),s("div",hs,[s("div",_s,a(v.value.totalInscritos),1),t[4]||(t[4]=s("div",{class:"semaforo-label"},"Pre inscritos totales",-1))]),s("div",{class:l(["semaforo-indicator",C("inscritos")])},null,2)],2),s("div",{class:l(["semaforo-card",C("cursos")]),onClick:t[0]||(t[0]=e=>b.value=!b.value)},[g(y,{name:"book",size:32,class:"semaforo-icon"}),s("div",fs,[s("div",Cs,a(v.value.totalCursos),1),t[5]||(t[5]=s("div",{class:"semaforo-label"},"Cursos activos",-1))]),s("div",{class:l(["semaforo-indicator",C("cursos")])},null,2)],2),s("div",{class:l(["semaforo-card",C("alertas")]),onClick:q},[g(y,{name:"alert-circle",size:32,class:"semaforo-icon"}),s("div",gs,[s("div",ys,a(x.value.length),1),t[6]||(t[6]=s("div",{class:"semaforo-label"},"Alertas activas",-1))]),s("div",{class:l(["semaforo-indicator",C("alertas")])},null,2)],2)]),b.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=e=>b.value=!1)},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=ss(()=>{},["stop"]))},[s("div",bs,[t[7]||(t[7]=s("h3",null,"Cursos Activos",-1)),s("button",{class:"modal-close",onClick:t[1]||(t[1]=e=>b.value=!1)},[g(y,{name:"x",size:20})])]),s("div",ws,[s("div",ks,[(r(!0),n(A,null,I(m.value,e=>(r(),n("div",{key:e.id,class:"curso-item",onClick:i=>G(e.id)},[t[8]||(t[8]=s("div",{class:"curso-item-icon"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})])],-1)),s("div",Ps,[s("div",As,a(e.title),1),s("div",Is,a(e.inscritos)+"/"+a(e.capacidad)+" pre inscritos",1)]),t[9]||(t[9]=s("div",{class:"curso-item-arrow"},"→",-1))],8,xs))),128))])])])])):D("",!0),s("div",Ms,[t[14]||(t[14]=s("div",{class:"section-header"},[s("div",null,[s("h2",{class:"section-title"},"Formadores por Curso"),s("p",{class:"section-description"},"Se requiere 1 formador por cada 10 pre inscritos (mínimo 2 formadores)")])],-1)),s("div",Ns,[(r(!0),n(A,null,I(m.value,e=>(r(),n("div",{key:e.id,class:l(["directivo-card",w(e)])},[s("div",Ss,[s("div",Ds,[t[10]||(t[10]=s("svg",{class:"directivo-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),s("circle",{cx:"9",cy:"7",r:"4"}),s("path",{d:"M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75"})],-1)),s("h3",null,a(e.title),1)]),s("span",{class:l(["directivo-badge",w(e)])},a(h(e))+"/"+a(_(e)),3)]),s("div",Rs,[s("span",Es,[s("span",Us,a(h(e)),1),t[11]||(t[11]=s("span",{class:"directivo-stat-label"},"Actuales",-1))]),t[13]||(t[13]=s("span",{class:"directivo-stat-divider"},"→",-1)),s("span",zs,[s("span",Bs,a(_(e)),1),t[12]||(t[12]=s("span",{class:"directivo-stat-label"},"Requeridos",-1))])]),s("div",$s,[s("div",{class:l(["directivo-fill",w(e)]),style:$({width:Z(e)+"%"})},null,6)]),w(e)==="danger"?(r(),n("div",Os," ⚠️ Faltan "+a(_(e)-h(e))+" formadores ",1)):w(e)==="near"?(r(),n("div",Ts," ⚡ Necesita "+a(_(e)-h(e))+" formador"+a(_(e)-h(e)>1?"es":"")+" más ",1)):(r(),n("div",Ls," ✓ Personal completo "))],2))),128))])]),s("div",Fs,[t[18]||(t[18]=s("div",{class:"section-header"},[s("div",null,[s("h2",{class:"section-title"},"Cursos con Pagos Pendientes"),s("p",{class:"section-description"},"Resumen de recaudación y montos pendientes por curso")])],-1)),s("div",js,[s("table",Vs,[t[17]||(t[17]=s("thead",null,[s("tr",null,[s("th",{style:{width:"auto"}},"Curso"),s("th",{class:"text-center",style:{width:"auto"}},"PreInscritos"),s("th",{class:"text-center",style:{width:"auto"}},"Recaudado"),s("th",{class:"text-center",style:{width:"auto"}},"Esperado"),s("th",{class:"text-center",style:{width:"auto"}},"Pendiente"),s("th",{class:"text-center",style:{width:"auto"}},"Progreso"),s("th",{class:"text-center",style:{width:"auto"}},"Estado")])],-1)),s("tbody",null,[(r(!0),n(A,null,I(z.value,e=>(r(),n("tr",{key:e.title,class:l("row-"+P(e))},[s("td",Hs,[s("div",Gs,[t[15]||(t[15]=s("svg",{class:"curso-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"}),s("path",{d:"M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"})],-1)),s("span",qs,a(e.title),1)])]),s("td",Zs,[s("span",Js,a(e.inscritos),1)]),s("td",Ks,[s("span",Qs,a(N(e.paid)),1)]),s("td",Ws,[s("span",Xs,a(N(e.expected)),1)]),s("td",Ys,[s("span",st,a(N(e.unpaid)),1)]),s("td",tt,[s("div",et,[s("div",ot,[s("div",{class:l(["mini-progress-fill",P(e)]),style:$({width:e.percentPaid+"%"})},null,6)]),s("span",at,a(e.percentPaid)+"%",1)])]),s("td",it,[s("span",{class:l(["status-badge",P(e)])},a(J(e)),3)])],2))),128)),z.value.length===0?(r(),n("tr",nt,[...t[16]||(t[16]=[s("td",{colspan:"7",class:"text-center"},[s("div",{class:"empty-state"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",null,"¡Excelente! No hay pagos pendientes")])],-1)])])):D("",!0)])])])])],512),[[Y,O.value==="resumen"]])])])])]))}},vt=Q(rt,[["__scopeId","data-v-a0bf6e21"]]);export{vt as default};
